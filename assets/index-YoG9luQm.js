import{r as u,j as n,u as co,R as kt,L as lo}from"./index-4so3gm0l.js";import{c as ie,G as uo,H as fo,M as qt,J as po,K as Fe,L as ho,N as mo,O as Qt,Q as xo,T as go,U as vo,W as bo,X as Je,Y as yo,Z as jo,_ as wo,$ as Zt,a0 as Do,a1 as Io,a2 as Co,a3 as So,a4 as No,a5 as Ao,a6 as Mo,a7 as Ro,a8 as Eo,a9 as _o,aa as Po,ab as To,ac as _e,ad as ko,ae as Oo,af as Lo,w as C,ag as O,ah as W,ai as ft,j as F,u as $e,g as ge,P as T,aj as V,k as j,m as J,l as Fo,t as $o,a as b,ak as pt,al as ze,am as Jt,an as zo,ao as en,ap as z,B,aq as ht,ar as rt,as as mt,at as ve,au as tn,av as ot,aw as Go,E as xt,ax as nn,x as rn,v as H,ay as Vo,az as Bo,aA as Ho,aB as st,aC as Uo,V as on,aD as sn,aE as Ko,aF as at,aG as Wo,i as an,h as le,f as Ge,e as cn,R as Yo,A as Xo,aH as ln,n as un,aI as qo,o as dn,p as fn,q as pn,F as hn,D as mn,r as Qo,s as Zo,aJ as xn,C as Jo,aK as Ve,aL as je,b as es,I as ts,aM as ns,aN as rs,aO as os,aP as ss,aQ as as,aR as is,aS as Ot,aT as cs,aU as ls,z as us,y as ds,aV as fs,aW as ps,aX as hs,aY as ms,aZ as xs,a_ as gn,a$ as vn,b0 as gs,b1 as bn,b2 as yn,b3 as jn,b4 as vs,b5 as wn,b6 as bs,S as me,b7 as ys,b8 as js,b9 as ws,ba as Ds,bb as Is,bc as Cs,bd as Ss,be as Ns,bf as As,bg as Ms}from"./useGameState-wRbwF2Yq.js";import"./clsx-B-dksMZM.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Es=ie("arrow-up",Rs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ps=ie("check",_s);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ks=ie("circle",Ts);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Ls=ie("ellipsis",Os);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],$s=ie("loader-circle",Fs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],gt=ie("target",zs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gs=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],Vs=ie("undo-2",Gs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Hs=ie("x",Bs),Us=(e,t,r)=>{const o=t-e;return((r-e)%o+o)%o+e};function Dn(e,t){return uo(e)?e[Us(0,e.length,t)]:e}class Ks{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>t.finished))}getAll(t){return this.animations[0][t]}setAll(t,r){for(let o=0;o<this.animations.length;o++)this.animations[o][t]=r}attachTimeline(t){const r=this.animations.map(o=>o.attachTimeline(t));return()=>{r.forEach((o,s)=>{o&&o(),this.animations[s].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return Lt(this.animations,"duration")}get iterationDuration(){return Lt(this.animations,"iterationDuration")}runAll(t){this.animations.forEach(r=>r[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function Lt(e,t){let r=0;for(let o=0;o<e.length;o++){const s=e[o][t];s!==null&&s>r&&(r=s)}return r}class Ws extends Ks{then(t,r){return this.finished.finally(t).then(()=>{})}}function Ys(...e){const t=!Array.isArray(e[0]),r=t?0:-1,o=e[0+r],s=e[1+r],a=e[2+r],i=e[3+r],l=fo(s,a,i);return t?l(o):l}function Ft(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function Xs(...e){return t=>{let r=!1;const o=e.map(s=>{const a=Ft(s,t);return!r&&typeof a=="function"&&(r=!0),a});if(r)return()=>{for(let s=0;s<o.length;s++){const a=o[s];typeof a=="function"?a():Ft(e[s],null)}}}}function qs(...e){return u.useCallback(Xs(...e),e)}class Qs extends u.Component{getSnapshotBeforeUpdate(t){const r=this.props.childRef.current;if(r&&t.isPresent&&!this.props.isPresent){const o=r.offsetParent,s=po(o)&&o.offsetWidth||0,a=this.props.sizeRef.current;a.height=r.offsetHeight||0,a.width=r.offsetWidth||0,a.top=r.offsetTop,a.left=r.offsetLeft,a.right=s-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function Zs({children:e,isPresent:t,anchorX:r,root:o}){const s=u.useId(),a=u.useRef(null),i=u.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=u.useContext(qt),c=qs(a,e?.ref);return u.useInsertionEffect(()=>{const{width:d,height:p,top:f,left:h,right:x}=i.current;if(t||!a.current||!d||!p)return;const m=r==="left"?`left: ${h}`:`right: ${x}`;a.current.dataset.motionPopId=s;const g=document.createElement("style");l&&(g.nonce=l);const v=o??document.head;return v.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${p}px !important;
            ${m}px !important;
            top: ${f}px !important;
          }
        `),()=>{v.contains(g)&&v.removeChild(g)}},[t]),n.jsx(Qs,{isPresent:t,childRef:a,sizeRef:i,children:u.cloneElement(e,{ref:c})})}const Js=({children:e,initial:t,isPresent:r,onExitComplete:o,custom:s,presenceAffectsLayout:a,mode:i,anchorX:l,root:c})=>{const d=Fe(ea),p=u.useId();let f=!0,h=u.useMemo(()=>(f=!1,{id:p,initial:t,isPresent:r,custom:s,onExitComplete:x=>{d.set(x,!0);for(const m of d.values())if(!m)return;o&&o()},register:x=>(d.set(x,!1),()=>d.delete(x))}),[r,d,o]);return a&&f&&(h={...h}),u.useMemo(()=>{d.forEach((x,m)=>d.set(m,!1))},[r]),u.useEffect(()=>{!r&&!d.size&&o&&o()},[r]),i==="popLayout"&&(e=n.jsx(Zs,{isPresent:r,anchorX:l,root:c,children:e})),n.jsx(ho.Provider,{value:h,children:e})};function ea(){return new Map}const Me=e=>e.key||"";function $t(e){const t=[];return u.Children.forEach(e,r=>{u.isValidElement(r)&&t.push(r)}),t}const ce=({children:e,custom:t,initial:r=!0,onExitComplete:o,presenceAffectsLayout:s=!0,mode:a="sync",propagate:i=!1,anchorX:l="left",root:c})=>{const[d,p]=mo(i),f=u.useMemo(()=>$t(e),[e]),h=i&&!d?[]:f.map(Me),x=u.useRef(!0),m=u.useRef(f),g=Fe(()=>new Map),[v,y]=u.useState(f),[D,S]=u.useState(f);Qt(()=>{x.current=!1,m.current=f;for(let R=0;R<D.length;R++){const A=Me(D[R]);h.includes(A)?g.delete(A):g.get(A)!==!0&&g.set(A,!1)}},[D,h.length,h.join("-")]);const N=[];if(f!==v){let R=[...f];for(let A=0;A<D.length;A++){const M=D[A],w=Me(M);h.includes(w)||(R.splice(A,0,M),N.push(M))}return a==="wait"&&N.length&&(R=N),S($t(R)),y(f),null}const{forceRender:_}=u.useContext(xo);return n.jsx(n.Fragment,{children:D.map(R=>{const A=Me(R),M=i&&!d?!1:f===D||h.includes(A),w=()=>{if(g.has(A))g.set(A,!0);else return;let E=!0;g.forEach(P=>{P||(E=!1)}),E&&(_?.(),S(m.current),i&&p?.(),o&&o())};return n.jsx(Js,{isPresent:M,initial:!x.current||r?void 0:!1,custom:t,presenceAffectsLayout:s,mode:a,root:c,onExitComplete:M?void 0:w,anchorX:l,children:R},A)})})};function In(e){const t=Fe(()=>go(e)),{isStatic:r}=u.useContext(qt);if(r){const[,o]=u.useState(e);u.useEffect(()=>t.on("change",o),[])}return t}function Cn(e,t){const r=In(t()),o=()=>r.set(t());return o(),Qt(()=>{const s=()=>vo.preRender(o,!1,!0),a=e.map(i=>i.on("change",s));return()=>{a.forEach(i=>i()),bo(o)}}),r}function ta(e){Je.current=[],e();const t=Cn(Je.current,e);return Je.current=void 0,t}function na(e,t,r,o){if(typeof e=="function")return ta(e);const s=typeof t=="function"?t:Ys(t,r,o);return Array.isArray(e)?zt(e,s):zt([e],([a])=>s(a))}function zt(e,t){const r=Fe(()=>[]);return Cn(e,()=>{r.length=0;const o=e.length;for(let s=0;s<o;s++)r[s]=e[s].get();return t(r)})}function vt(e){return typeof e=="object"&&!Array.isArray(e)}function Sn(e,t,r,o){return typeof e=="string"&&vt(t)?yo(e,r,o):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function ra(e,t,r){return e*(t+1)}function Gt(e,t,r,o){return typeof t=="number"?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):t==="<"?r:t.startsWith("<")?Math.max(0,r+parseFloat(t.slice(1))):o.get(t)??e}function oa(e,t,r){for(let o=0;o<e.length;o++){const s=e[o];s.at>t&&s.at<r&&(wo(e,s),o--)}}function sa(e,t,r,o,s,a){oa(e,s,a);for(let i=0;i<t.length;i++)e.push({value:t[i],at:jo(s,a,o[i]),easing:Dn(r,i)})}function aa(e,t){for(let r=0;r<e.length;r++)e[r]=e[r]/(t+1)}function ia(e,t){return e.at===t.at?e.value===null?1:t.value===null?-1:0:e.at-t.at}const ca="easeInOut";function la(e,{defaultTransition:t={},...r}={},o,s){const a=t.duration||.3,i=new Map,l=new Map,c={},d=new Map;let p=0,f=0,h=0;for(let x=0;x<e.length;x++){const m=e[x];if(typeof m=="string"){d.set(m,f);continue}else if(!Array.isArray(m)){d.set(m.name,Gt(f,m.at,p,d));continue}let[g,v,y={}]=m;y.at!==void 0&&(f=Gt(f,y.at,p,d));let D=0;const S=(N,_,R,A=0,M=0)=>{const w=ua(N),{delay:E=0,times:P=Do(w),type:X="keyframes",repeat:ne,repeatType:be,repeatDelay:Ae=0,...K}=_;let{ease:q=t.ease||"easeOut",duration:L}=_;const I=typeof E=="function"?E(A,M):E,re=w.length,Q=So(X)?X:s?.[X||"keyframes"];if(re<=2&&Q){let se=100;if(re===2&&pa(w)){const ae=w[1]-w[0];se=Math.abs(ae)}const Z={...K};L!==void 0&&(Z.duration=No(L));const k=Io(Z,se,Q);q=k.ease,L=k.duration}L??(L=a);const oe=f+I;P.length===1&&P[0]===0&&(P[1]=1);const pe=P.length-w.length;if(pe>0&&Co(P,pe),w.length===1&&w.unshift(null),ne){L=ra(L,ne);const se=[...w],Z=[...P];q=Array.isArray(q)?[...q]:[q];const k=[...q];for(let ae=0;ae<ne;ae++){w.push(...se);for(let ye=0;ye<se.length;ye++)P.push(Z[ye]+(ae+1)),q.push(ye===0?"linear":Dn(k,ye-1))}aa(P,ne)}const he=oe+L;sa(R,w,q,P,oe,he),D=Math.max(I+L,D),h=Math.max(he,h)};if(Zt(g)){const N=Vt(g,l);S(v,y,Bt("default",N))}else{const N=Sn(g,v,o,c),_=N.length;for(let R=0;R<_;R++){v=v,y=y;const A=N[R],M=Vt(A,l);for(const w in v)S(v[w],da(y,w),Bt(w,M),R,_)}}p=f,f+=D}return l.forEach((x,m)=>{for(const g in x){const v=x[g];v.sort(ia);const y=[],D=[],S=[];for(let _=0;_<v.length;_++){const{at:R,value:A,easing:M}=v[_];y.push(A),D.push(Ao(0,h,R)),S.push(M||"easeOut")}D[0]!==0&&(D.unshift(0),y.unshift(y[0]),S.unshift(ca)),D[D.length-1]!==1&&(D.push(1),y.push(null)),i.has(m)||i.set(m,{keyframes:{},transition:{}});const N=i.get(m);N.keyframes[g]=y,N.transition[g]={...t,duration:h,ease:S,times:D,...r}}}),i}function Vt(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function Bt(e,t){return t[e]||(t[e]=[]),t[e]}function ua(e){return Array.isArray(e)?e:[e]}function da(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const fa=e=>typeof e=="number",pa=e=>e.every(fa);function ha(e,t){return e in t}class ma extends Mo{constructor(){super(...arguments),this.type="object"}readValueFromInstance(t,r){if(ha(r,t)){const o=t[r];if(typeof o=="string"||typeof o=="number")return o}}getBaseTargetFromProps(){}removeValueFromRenderState(t,r){delete r.output[t]}measureInstanceViewportBox(){return Ro()}build(t,r){Object.assign(t.output,r)}renderInstance(t,{output:r}){Object.assign(t,r)}sortInstanceNodePosition(){return 0}}function xa(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},r=Eo(e)&&!_o(e)?new Po(t):new To(t);r.mount(e),_e.set(e,r)}function ga(e){const t={presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}},r=new ma(t);r.mount(e),_e.set(e,r)}function va(e,t){return Zt(e)||typeof e=="number"||typeof e=="string"&&!vt(t)}function Nn(e,t,r,o){const s=[];if(va(e,t))s.push(ko(e,vt(t)&&t.default||t,r&&(r.default||r)));else{const a=Sn(e,t,o),i=a.length;for(let l=0;l<i;l++){const c=a[l],d=c instanceof Element?xa:ga;_e.has(c)||d(c);const p=_e.get(c),f={...r};"delay"in f&&typeof f.delay=="function"&&(f.delay=f.delay(l,i)),s.push(...Oo(p,{...t,transition:f},{}))}}return s}function ba(e,t,r){const o=[];return la(e,t,r,{spring:Lo}).forEach(({keyframes:a,transition:i},l)=>{o.push(...Nn(l,a,i))}),o}function ya(e){return Array.isArray(e)&&e.some(Array.isArray)}function ja(e){function t(r,o,s){let a=[],i;if(ya(r))a=ba(r,o,e);else{const{onComplete:c,...d}=s||{};typeof c=="function"&&(i=c),a=Nn(r,o,d,e)}const l=new Ws(a);return i&&l.finished.then(i),l}return t}const wa=ja();function An(e,t,r,o){const a=e.combat?.phase==="planning",i=!a&&!!t?.targetIDs.includes(r??void 0),l=!a&&!!t?.positions.find(c=>c.playerID===o.playerID&&c.index===o.index);return i||l}function Da({actorID:e}){const t=C(l=>l.state),r=e?W(t,e):void 0,o=In(0),s=u.useMemo(()=>{if(!r)return 0;const[l,c]=ft(r);return Math.max(0,Math.min(1,l/c))},[r?.state.damage,r?.stats.health]),a=u.useMemo(()=>Math.random()*32,[s]);u.useEffect(()=>{const c=Math.max(4,8*s+Math.random()*3),d=wa(o,[0,Math.PI*2],{duration:c,ease:"linear",repeat:1/0});return()=>d.stop()},[s]);const i=na(o,l=>{const c=typeof window<"u"?window.innerWidth:1200,p=(typeof window<"u"?window.innerHeight:200)/2,h=p*.9*Math.pow(s,1),x=2*s,m=Math.max(200,Math.floor(c/6));let g="";for(let v=0;v<=m;v++){const y=v/m*c,D=p+h*Math.sin(y/c*Math.PI*2*x+l);g+=`${v===0?"M":"L"}${y.toFixed(2)},${D.toFixed(2)}`}return g});return n.jsxs(O.svg,{className:"absolute top-0 h-full w-full pointer-events-none",initial:{opacity:0},animate:{opacity:Math.max(.05,1-s-.4)},exit:{opacity:0},style:{left:a},"aria-hidden":!0,children:[n.jsxs("defs",{children:[n.jsxs("linearGradient",{id:`vital-grad-${e}`,x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[n.jsx("stop",{offset:"0%",stopColor:"rgba(255,255,255,0.0)"}),n.jsx("stop",{offset:"15%",stopColor:`rgba(${Math.round(255*(1-s))}, ${Math.round(255*s)}, ${Math.round(180*s)}, 0.6)`}),n.jsx("stop",{offset:"85%",stopColor:`rgba(${Math.round(255*(1-s))}, ${Math.round(255*s)}, ${Math.round(180*s)}, 0.6)`}),n.jsx("stop",{offset:"100%",stopColor:"rgba(255,255,255,0.0)"})]}),n.jsxs("filter",{id:`vital-glow-${e}`,x:"-50%",y:"-50%",width:"200%",height:"200%",children:[n.jsx("feGaussianBlur",{stdDeviation:"20",result:"blur"}),n.jsxs("feMerge",{children:[n.jsx("feMergeNode",{in:"blur"}),n.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),n.jsx(O.path,{d:i,stroke:`url(#vital-grad-${e})`,strokeWidth:3,fill:"none",filter:`url(#vital-glow-${e})`})]})}function Ia({player:e}){const t=e.activeActorIDs,r=C(o=>o.state);return n.jsx(ce,{mode:"wait",children:n.jsx(O.div,{className:"absolute z-0 inset-0 pointer-events-none",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:t.map((o,s)=>n.jsx(Da,{actorID:o},(o??"")+s))},r.encounter.ID)})}function Ca(e,t){return u.useReducer((r,o)=>t[r][o]??r,e)}var bt="ScrollArea",[Mn]=ge(bt),[Sa,U]=Mn(bt),Rn=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:o="hover",dir:s,scrollHideDelay:a=600,...i}=e,[l,c]=u.useState(null),[d,p]=u.useState(null),[f,h]=u.useState(null),[x,m]=u.useState(null),[g,v]=u.useState(null),[y,D]=u.useState(0),[S,N]=u.useState(0),[_,R]=u.useState(!1),[A,M]=u.useState(!1),w=F(t,P=>c(P)),E=$e(s);return n.jsx(Sa,{scope:r,type:o,dir:E,scrollHideDelay:a,scrollArea:l,viewport:d,onViewportChange:p,content:f,onContentChange:h,scrollbarX:x,onScrollbarXChange:m,scrollbarXEnabled:_,onScrollbarXEnabledChange:R,scrollbarY:g,onScrollbarYChange:v,scrollbarYEnabled:A,onScrollbarYEnabledChange:M,onCornerWidthChange:D,onCornerHeightChange:N,children:n.jsx(T.div,{dir:E,...i,ref:w,style:{position:"relative","--radix-scroll-area-corner-width":y+"px","--radix-scroll-area-corner-height":S+"px",...e.style}})})});Rn.displayName=bt;var En="ScrollAreaViewport",_n=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:o,nonce:s,...a}=e,i=U(En,r),l=u.useRef(null),c=F(t,l,i.onViewportChange);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),n.jsx(T.div,{"data-radix-scroll-area-viewport":"",...a,ref:c,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...e.style},children:n.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:o})})]})});_n.displayName=En;var te="ScrollAreaScrollbar",Pn=u.forwardRef((e,t)=>{const{forceMount:r,...o}=e,s=U(te,e.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:i}=s,l=e.orientation==="horizontal";return u.useEffect(()=>(l?a(!0):i(!0),()=>{l?a(!1):i(!1)}),[l,a,i]),s.type==="hover"?n.jsx(Na,{...o,ref:t,forceMount:r}):s.type==="scroll"?n.jsx(Aa,{...o,ref:t,forceMount:r}):s.type==="auto"?n.jsx(Tn,{...o,ref:t,forceMount:r}):s.type==="always"?n.jsx(yt,{...o,ref:t}):null});Pn.displayName=te;var Na=u.forwardRef((e,t)=>{const{forceMount:r,...o}=e,s=U(te,e.__scopeScrollArea),[a,i]=u.useState(!1);return u.useEffect(()=>{const l=s.scrollArea;let c=0;if(l){const d=()=>{window.clearTimeout(c),i(!0)},p=()=>{c=window.setTimeout(()=>i(!1),s.scrollHideDelay)};return l.addEventListener("pointerenter",d),l.addEventListener("pointerleave",p),()=>{window.clearTimeout(c),l.removeEventListener("pointerenter",d),l.removeEventListener("pointerleave",p)}}},[s.scrollArea,s.scrollHideDelay]),n.jsx(V,{present:r||a,children:n.jsx(Tn,{"data-state":a?"visible":"hidden",...o,ref:t})})}),Aa=u.forwardRef((e,t)=>{const{forceMount:r,...o}=e,s=U(te,e.__scopeScrollArea),a=e.orientation==="horizontal",i=He(()=>c("SCROLL_END"),100),[l,c]=Ca("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return u.useEffect(()=>{if(l==="idle"){const d=window.setTimeout(()=>c("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(d)}},[l,s.scrollHideDelay,c]),u.useEffect(()=>{const d=s.viewport,p=a?"scrollLeft":"scrollTop";if(d){let f=d[p];const h=()=>{const x=d[p];f!==x&&(c("SCROLL"),i()),f=x};return d.addEventListener("scroll",h),()=>d.removeEventListener("scroll",h)}},[s.viewport,a,c,i]),n.jsx(V,{present:r||l!=="hidden",children:n.jsx(yt,{"data-state":l==="hidden"?"hidden":"visible",...o,ref:t,onPointerEnter:j(e.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:j(e.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),Tn=u.forwardRef((e,t)=>{const r=U(te,e.__scopeScrollArea),{forceMount:o,...s}=e,[a,i]=u.useState(!1),l=e.orientation==="horizontal",c=He(()=>{if(r.viewport){const d=r.viewport.offsetWidth<r.viewport.scrollWidth,p=r.viewport.offsetHeight<r.viewport.scrollHeight;i(l?d:p)}},10);return xe(r.viewport,c),xe(r.content,c),n.jsx(V,{present:o||a,children:n.jsx(yt,{"data-state":a?"visible":"hidden",...s,ref:t})})}),yt=u.forwardRef((e,t)=>{const{orientation:r="vertical",...o}=e,s=U(te,e.__scopeScrollArea),a=u.useRef(null),i=u.useRef(0),[l,c]=u.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=$n(l.viewport,l.content),p={...o,sizes:l,onSizesChange:c,hasThumb:d>0&&d<1,onThumbChange:h=>a.current=h,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:h=>i.current=h};function f(h,x){return Ta(h,i.current,l,x)}return r==="horizontal"?n.jsx(Ma,{...p,ref:t,onThumbPositionChange:()=>{if(s.viewport&&a.current){const h=s.viewport.scrollLeft,x=Ht(h,l,s.dir);a.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:h=>{s.viewport&&(s.viewport.scrollLeft=h)},onDragScroll:h=>{s.viewport&&(s.viewport.scrollLeft=f(h,s.dir))}}):r==="vertical"?n.jsx(Ra,{...p,ref:t,onThumbPositionChange:()=>{if(s.viewport&&a.current){const h=s.viewport.scrollTop,x=Ht(h,l);a.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:h=>{s.viewport&&(s.viewport.scrollTop=h)},onDragScroll:h=>{s.viewport&&(s.viewport.scrollTop=f(h))}}):null}),Ma=u.forwardRef((e,t)=>{const{sizes:r,onSizesChange:o,...s}=e,a=U(te,e.__scopeScrollArea),[i,l]=u.useState(),c=u.useRef(null),d=F(t,c,a.onScrollbarXChange);return u.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),n.jsx(On,{"data-orientation":"horizontal",...s,ref:d,sizes:r,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Be(r)+"px",...e.style},onThumbPointerDown:p=>e.onThumbPointerDown(p.x),onDragScroll:p=>e.onDragScroll(p.x),onWheelScroll:(p,f)=>{if(a.viewport){const h=a.viewport.scrollLeft+p.deltaX;e.onWheelScroll(h),Gn(h,f)&&p.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&o({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:Te(i.paddingLeft),paddingEnd:Te(i.paddingRight)}})}})}),Ra=u.forwardRef((e,t)=>{const{sizes:r,onSizesChange:o,...s}=e,a=U(te,e.__scopeScrollArea),[i,l]=u.useState(),c=u.useRef(null),d=F(t,c,a.onScrollbarYChange);return u.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),n.jsx(On,{"data-orientation":"vertical",...s,ref:d,sizes:r,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Be(r)+"px",...e.style},onThumbPointerDown:p=>e.onThumbPointerDown(p.y),onDragScroll:p=>e.onDragScroll(p.y),onWheelScroll:(p,f)=>{if(a.viewport){const h=a.viewport.scrollTop+p.deltaY;e.onWheelScroll(h),Gn(h,f)&&p.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&o({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:Te(i.paddingTop),paddingEnd:Te(i.paddingBottom)}})}})}),[Ea,kn]=Mn(te),On=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:o,hasThumb:s,onThumbChange:a,onThumbPointerUp:i,onThumbPointerDown:l,onThumbPositionChange:c,onDragScroll:d,onWheelScroll:p,onResize:f,...h}=e,x=U(te,r),[m,g]=u.useState(null),v=F(t,w=>g(w)),y=u.useRef(null),D=u.useRef(""),S=x.viewport,N=o.content-o.viewport,_=J(p),R=J(c),A=He(f,10);function M(w){if(y.current){const E=w.clientX-y.current.left,P=w.clientY-y.current.top;d({x:E,y:P})}}return u.useEffect(()=>{const w=E=>{const P=E.target;m?.contains(P)&&_(E,N)};return document.addEventListener("wheel",w,{passive:!1}),()=>document.removeEventListener("wheel",w,{passive:!1})},[S,m,N,_]),u.useEffect(R,[o,R]),xe(m,A),xe(x.content,A),n.jsx(Ea,{scope:r,scrollbar:m,hasThumb:s,onThumbChange:J(a),onThumbPointerUp:J(i),onThumbPositionChange:R,onThumbPointerDown:J(l),children:n.jsx(T.div,{...h,ref:v,style:{position:"absolute",...h.style},onPointerDown:j(e.onPointerDown,w=>{w.button===0&&(w.target.setPointerCapture(w.pointerId),y.current=m.getBoundingClientRect(),D.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),M(w))}),onPointerMove:j(e.onPointerMove,M),onPointerUp:j(e.onPointerUp,w=>{const E=w.target;E.hasPointerCapture(w.pointerId)&&E.releasePointerCapture(w.pointerId),document.body.style.webkitUserSelect=D.current,x.viewport&&(x.viewport.style.scrollBehavior=""),y.current=null})})})}),Pe="ScrollAreaThumb",Ln=u.forwardRef((e,t)=>{const{forceMount:r,...o}=e,s=kn(Pe,e.__scopeScrollArea);return n.jsx(V,{present:r||s.hasThumb,children:n.jsx(_a,{ref:t,...o})})}),_a=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:o,...s}=e,a=U(Pe,r),i=kn(Pe,r),{onThumbPositionChange:l}=i,c=F(t,f=>i.onThumbChange(f)),d=u.useRef(void 0),p=He(()=>{d.current&&(d.current(),d.current=void 0)},100);return u.useEffect(()=>{const f=a.viewport;if(f){const h=()=>{if(p(),!d.current){const x=ka(f,l);d.current=x,l()}};return l(),f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[a.viewport,p,l]),n.jsx(T.div,{"data-state":i.hasThumb?"visible":"hidden",...s,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:j(e.onPointerDownCapture,f=>{const x=f.target.getBoundingClientRect(),m=f.clientX-x.left,g=f.clientY-x.top;i.onThumbPointerDown({x:m,y:g})}),onPointerUp:j(e.onPointerUp,i.onThumbPointerUp)})});Ln.displayName=Pe;var jt="ScrollAreaCorner",Fn=u.forwardRef((e,t)=>{const r=U(jt,e.__scopeScrollArea),o=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&o?n.jsx(Pa,{...e,ref:t}):null});Fn.displayName=jt;var Pa=u.forwardRef((e,t)=>{const{__scopeScrollArea:r,...o}=e,s=U(jt,r),[a,i]=u.useState(0),[l,c]=u.useState(0),d=!!(a&&l);return xe(s.scrollbarX,()=>{const p=s.scrollbarX?.offsetHeight||0;s.onCornerHeightChange(p),c(p)}),xe(s.scrollbarY,()=>{const p=s.scrollbarY?.offsetWidth||0;s.onCornerWidthChange(p),i(p)}),d?n.jsx(T.div,{...o,ref:t,style:{width:a,height:l,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function Te(e){return e?parseInt(e,10):0}function $n(e,t){const r=e/t;return isNaN(r)?0:r}function Be(e){const t=$n(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=(e.scrollbar.size-r)*t;return Math.max(o,18)}function Ta(e,t,r,o="ltr"){const s=Be(r),a=s/2,i=t||a,l=s-i,c=r.scrollbar.paddingStart+i,d=r.scrollbar.size-r.scrollbar.paddingEnd-l,p=r.content-r.viewport,f=o==="ltr"?[0,p]:[p*-1,0];return zn([c,d],f)(e)}function Ht(e,t,r="ltr"){const o=Be(t),s=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=t.scrollbar.size-s,i=t.content-t.viewport,l=a-o,c=r==="ltr"?[0,i]:[i*-1,0],d=$o(e,c);return zn([0,i],[0,l])(d)}function zn(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const o=(t[1]-t[0])/(e[1]-e[0]);return t[0]+o*(r-e[0])}}function Gn(e,t){return e>0&&e<t}var ka=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},o=0;return(function s(){const a={left:e.scrollLeft,top:e.scrollTop},i=r.left!==a.left,l=r.top!==a.top;(i||l)&&t(),r=a,o=window.requestAnimationFrame(s)})(),()=>window.cancelAnimationFrame(o)};function He(e,t){const r=J(e),o=u.useRef(0);return u.useEffect(()=>()=>window.clearTimeout(o.current),[]),u.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(r,t)},[r,t])}function xe(e,t){const r=J(t);Fo(()=>{let o=0;if(e){const s=new ResizeObserver(()=>{cancelAnimationFrame(o),o=window.requestAnimationFrame(r)});return s.observe(e),()=>{window.cancelAnimationFrame(o),s.unobserve(e)}}},[e,r])}var Oa=Rn,La=_n,Fa=Fn;function wt({className:e,children:t,...r}){return n.jsxs(Oa,{"data-slot":"scroll-area",className:b("relative",e),...r,children:[n.jsx(La,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:t}),n.jsx($a,{}),n.jsx(Fa,{})]})}function $a({className:e,orientation:t="vertical",...r}){return n.jsx(Pn,{"data-slot":"scroll-area-scrollbar",orientation:t,className:b("flex touch-none p-px transition-colors select-none",t==="vertical"&&"h-full w-3 border-l border-l-transparent",t==="horizontal"&&"h-3 flex-col border-t border-t-transparent",e),...r,children:n.jsx(Ln,{"data-slot":"scroll-area-thumb",className:"bg-foreground/20 relative flex-1 rounded-full"})})}function za({action:e,context:t,active:r,onActiveChange:o}){const s=C(c=>c.state),a=pt(s,t.sourceID),i=t&&!ze(e,s,t),l=Jt[e.ID];return n.jsx(zo,{onClick:()=>o(!r),size:"xs",variant:r?"action-active":"action",className:b("cursor-default rounded-sm",{"opacity-50 pointer-events-none !cursor-not-allowed":i}),children:l?n.jsx(en,{active:r,renderer:l,cooldown:a?.cooldowns[e.ID],showImage:!1}):n.jsx("span",{className:b("text-xl title",{"text-muted-foreground":!r}),children:e.name})})}function et({state:e,action:t,target:r,type:o,allied:s,context:a,onContextChange:i}){const l=t.targets.max(e,a),c=t.targets.validate(e,a),d=Ue(a)===l;return n.jsxs(n.Fragment,{children:[o==="targetID"&&n.jsx(Ga,{target:r,disabled:d&&c,context:a,allied:s,onContextChange:p=>i({...a,...p})}),o==="position"&&n.jsx(Va,{state:e,target:r,disabled:d&&c,allied:s,context:a,onContextChange:p=>i({...a,...p})})]})}function Ga({target:e,context:t,disabled:r,allied:o,onContextChange:s}){const a=t.targetIDs.includes(e.ID),i=z(l=>l.set);return n.jsx(B,{size:"sm",variant:a?o?"slate-active":"stone-active":o?"slate":"stone",disabled:r&&!a,onClick:()=>{s(a?{targetIDs:t.targetIDs.filter(l=>l!==e.ID)}:{targetIDs:[...t.targetIDs,e.ID]})},onMouseEnter:()=>{i({hoverActorID:e.ID})},onMouseLeave:()=>{i({hoverActorID:void 0})},children:e.name})}function Va({state:e,target:t,disabled:r,allied:o,context:s,onContextChange:a}){const i=z(d=>d.set),l=ht(e,t.ID),c=l!==void 0&&s.positions.some(d=>rt(d,l));return n.jsx(B,{size:"sm",variant:c?o?"slate-active":"stone-active":o?"slate":"stone",disabled:r&&!c,onClick:()=>{l&&(c&&a({positions:s.positions.filter(d=>!rt(d,l))}),c||a({positions:[...s.positions,l]}))},onMouseEnter:()=>{i({hoverActorID:t.ID})},onMouseLeave:()=>{i({hoverActorID:void 0})},children:t.name})}function tt({state:e,action:t,target:r,type:o,index:s,allied:a,context:i,onContextChange:l,next:c}){const d=t.targets.max(e,i),p=Ue(i)===d;if(o==="targetID")return n.jsx(Ba,{allied:a,target:r,disabled:!0,index:s,context:i,onContextChange:f=>{l({...i,...f}),p||c()}});if(o==="position")return n.jsx(Ha,{state:e,allied:a,target:r,disabled:!0,index:s,context:i,onContextChange:f=>{l({...i,...f}),p||c()}})}function Ba({target:e,index:t,disabled:r,allied:o,context:s,onContextChange:a}){const i=z(d=>d.set),c=s.targetIDs[t]===e.ID;return n.jsxs(B,{size:"sm",variant:c?o?"slate-active":"stone-active":o?"slate":"stone",disabled:r&&c,onClick:()=>{if(c)return;const d=[...s.targetIDs];d[t]=e.ID,a({targetIDs:d})},onMouseEnter:()=>{i({hoverActorID:e.ID})},onMouseLeave:()=>{i({hoverActorID:void 0})},children:[c&&n.jsx(gt,{}),e.name]})}function Ha({state:e,target:t,disabled:r,allied:o,index:s,context:a,onContextChange:i}){const l=z(f=>f.set),c=ht(e,t.ID),d=a.positions[s],p=rt(c,d);return n.jsxs(B,{size:"sm",variant:p?o?"slate-active":"stone-active":o?"slate":"stone",disabled:r&&p,onClick:()=>{if(!c||p)return;const f=[...a.positions];f[s]=c,i({positions:f})},onMouseEnter:()=>{l({hoverActorID:t.ID})},onMouseLeave:()=>{l({hoverActorID:void 0})},children:[p&&n.jsx(gt,{}),t.name]})}const Ua=mt("flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-sm has-[>[data-slot=button-group]]:gap-2",{variants:{orientation:{horizontal:"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none",vertical:"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none"}},defaultVariants:{orientation:"horizontal"}});function Vn({className:e,orientation:t,...r}){return n.jsx("div",{role:"group","data-slot":"button-group","data-orientation":t,className:b(Ua({orientation:t}),e),...r})}function Ka({state:e,action:t,context:r,index:o,onIndexChange:s}){const a=t.targets.max(e,r),i=Ue(r)===a,l=Array.from({length:a});return n.jsx(Vn,{className:b("rounded-sm ring ring-black border border-ring/50 bg-muted",{"border-ring":i}),children:l.map((c,d)=>n.jsx(B,{className:"rounded-sm",variant:d===o?"default":r.positions[d]?"secondary":"ghost",size:"icon-sm",onClick:()=>s(d),children:r.positions[d]?n.jsx(gt,{}):n.jsx(ks,{className:"opacity-20"})},d))})}function Ue(e){return e.positions.filter(t=>!!t).length+e.targetIDs.filter(t=>!!t).length}function Wa({action:e,context:t,onContextChange:r,state:o}){const s=H(),[a,i]=u.useState(0),l=e.targets.max(o,t),c=e.targets.get(o,t),d=new Set(c.map(f=>f.target.playerID));function p(){i(f=>(f+1)%l)}return u.useEffect(()=>{i(0)},[t.sourceID,e.ID]),n.jsxs(n.Fragment,{children:[n.jsx(Ka,{state:o,action:e,context:t,index:a,onIndexChange:i}),d.size>1&&c.length>4?n.jsx("div",{className:"flex flex-col w-full justify-around gap-2",children:n.jsx("div",{className:"flex flex-col gap-1",children:n.jsxs("div",{className:"flex flex-wrap gap-2 w-full justify-center",children:[c.filter(f=>f.target.playerID!==t.playerID).map(({target:f,type:h})=>n.jsx(tt,{state:o,action:e,target:f,type:h,allied:f.playerID===s,index:a,context:t,onContextChange:r,next:p},f.ID)),c.filter(f=>f.target.playerID===t.playerID).map(({target:f,type:h})=>n.jsx(tt,{state:o,action:e,target:f,type:h,allied:f.playerID===s,index:a,context:t,onContextChange:r,next:p},f.ID))]})})}):n.jsx("div",{className:"flex justify-center flex-wrap gap-2 w-full",children:e.targets.get(o,t).map(({target:f,type:h})=>n.jsx(tt,{state:o,action:e,target:f,type:h,allied:f.playerID===s,index:a,context:t,onContextChange:r,next:p},f.ID))})]})}function Ya({action:e,state:t,context:r,onContextChange:o}){const s=H(),a=e.targets.get(t,r);return new Set(a.map(l=>l.target.playerID)).size>1&&a.length>4?n.jsx("div",{className:"flex flex-col w-full justify-around pt-4 gap-2",children:n.jsx("div",{className:"flex flex-col gap-1",children:n.jsxs("div",{className:"flex flex-wrap gap-2 w-full justify-center",children:[a.filter(l=>l.target.playerID!==r.playerID).map(({target:l,type:c})=>n.jsx(et,{state:t,action:e,target:l,type:c,allied:l.playerID===s,context:r,onContextChange:o},l.ID)),a.filter(l=>l.target.playerID===r.playerID).map(({target:l,type:c})=>n.jsx(et,{state:t,action:e,target:l,type:c,allied:l.playerID===s,context:r,onContextChange:o},l.ID))]})})}):n.jsx("div",{className:"flex justify-center flex-wrap gap-2 w-full",children:a.map(({target:l,type:c})=>n.jsx(et,{state:t,action:e,target:l,type:c,allied:l.playerID===s,context:r,onContextChange:o},l.ID))})}function Bn({playerID:e,action:t,sourceID:r,context:o,contextTitle:s,onContextChange:a,onContextConfirm:i,...l}){const c=C(m=>m.state);u.useEffect(()=>{a(ve({playerID:e,sourceID:r}))},[r,t.ID]);const d=t.targets.max(c,o),p=t.targets.unique?Math.min(d,t.targets.get(c,o).length):d,f=t.targets.validate(c,o),h=Ue(o),x=d===h;return n.jsxs(tn,{...l,className:"bg-transparent border-none ring-0 shadow-none gap-6",children:[n.jsxs("div",{className:"gap-0 text-center text-shadow-lg rounded-xs bg-background border ring ring-black py-2 self-center px-6 w-fit",style:{boxShadow:"0px 4px 16px rgba(0,0,0,0.8)"},children:[n.jsx(ot,{className:"text-xl inline",children:s||n.jsxs(n.Fragment,{children:["Select Targets for ",t.name]})}),n.jsx(Go,{className:"text-xs",children:d>0?n.jsxs("span",{children:[h," of ",p," Targets selected."]}):n.jsx("span",{children:"No selection required."})})]}),n.jsx(xt,{className:"px-8",children:n.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[!t.targets.unique&&n.jsx(Wa,{action:t,state:c,context:o,onContextChange:a}),t.targets.unique&&n.jsx(Ya,{action:t,state:c,context:o,onContextChange:a})]})}),n.jsx(nn,{className:"justify-end items-center gap-4",children:n.jsxs(B,{disabled:!f,className:b({"!opacity-0":!f}),variant:x?"default":"secondary",onClick:()=>i(o),children:["Confirm ",p>1&&f&&`(${h}/${p})`,n.jsx(rn,{})]})})]})}function Ke({playerID:e,source:t,actions:r,activeActionID:o,contextTitle:s,onActiveActionIDChange:a,onActionConfirm:i,children:l}){const[c,d]=u.useState(ve({playerID:e})),p=r.find(f=>f.ID===o);return n.jsxs(O.div,{className:"w-192 flex flex-col gap-4",initial:{scale:1,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:[l,n.jsxs("div",{className:b("flex flex-col gap-2 items-center"),children:[n.jsx(wt,{className:"flex-1 max-h-100 hidden",children:n.jsx("div",{className:"flex flex-col gap-1 px-px",children:r.map(f=>n.jsx(za,{action:f,context:c,active:f.ID===o,onActiveChange:()=>{a(f.ID)}},f.ID))})}),p&&n.jsx("div",{className:"flex-1",children:n.jsx(Bn,{playerID:e,action:p,sourceID:t?.ID,context:c,contextTitle:s,onContextChange:d,onContextConfirm:f=>{i(p,f)}})})]})]})}function Xa(){const{state:e,resolvePrompt:t}=C(s=>s),r=H(),o=e.promptQueue[0];if(o&&o.context.playerID===r){const s=o.action,a=o.context,i=W(e,a.sourceID);return n.jsx(Ke,{playerID:a.playerID,source:i,actions:[s],activeActionID:s.ID,contextTitle:"Choose Next Fighters",onActiveActionIDChange:()=>{},onActionConfirm:(l,c)=>{t(c)}},o.ID)}return n.jsx("div",{className:"w-172"})}function qa({action:e,context:t,active:r,disabled:o,onClick:s,className:a,...i}){const l=C(h=>h.state),c=pt(l,t.sourceID),d=z(h=>h.set),p=u.useRef(null),f=Jt[e.ID];return u.useLayoutEffect(()=>{r&&d({activeActionRef:p})},[r]),n.jsx(O.button,{ref:p,disabled:o,onMouseDown:s,className:b("cursor-default user-select-none flex flex-col justify-start text-left !w-55 h-71 bg-neutral-950 border-2 border-neutral-700 ring ring-black p-0 rounded-sm",{"hover:z-30 hover:shadow-[0px_16px_32px_16px_rgba(0,_0,_0,_0.2)]":!o},{"z-20 bg-neutral-900 border-neutral-700":r},"disabled:opacity-50",a),...i,children:f?n.jsx(en,{active:r,showImage:!0,renderer:f,cooldown:c?.cooldowns[e.ID]}):n.jsx("span",{className:"title text-xl p-2",children:e.name})})}function Qa({context:e,actions:t,activeActionID:r,onActiveActionIDChange:o}){const s=C(l=>l.state),a=t.length,i=0;return n.jsx(O.div,{initial:{y:"200%"},animate:{y:"0"},exit:{y:"200%"},transition:{type:"spring",damping:25,stiffness:220},className:"flex absolute left-0 right-0 justify-center -space-x-22 -mb-30 -z-0",children:t.map((l,c)=>{const d=c-(a-1)/2,p=i*(1-Math.cos(d*(Math.PI/180))),f=l.ID===r,h=!ze(l,s,e);return n.jsx(qa,{context:e,action:l,active:l.ID===r,disabled:h,onClick:()=>o(l.ID),style:{transformOrigin:"bottom center"},animate:{y:p,translateY:f?-20:0,zIndex:f?99:c,rotate:d,scale:f?1.1:1,boxShadow:`0px 12px ${f?16:8}px black`},transition:{duration:.2,ease:"easeOut"},whileHover:h?{}:{scale:1.1,y:p,rotate:0,zIndex:100,translateY:-40}},l.ID)})})}function Za(){const{state:e,pushAction:t}=C(d=>d),{activeActionID:r,activeContext:o,setActiveContext:s,set:a}=z(d=>d),i=W(e,o.sourceID);if(!i)return null;const l=i.actions.concat(Vo),c=l.find(d=>d.ID===r);return n.jsxs("div",{className:"h-full flex flex-col justify-end gap-10",children:[n.jsxs("h1",{className:"title text-center text-4xl text-muted-foreground py-4 hidden",children:["What will ",i.name," do?"]}),c&&n.jsx("div",{className:"flex-1 flex flex-col items-center justify-center mb-48",children:n.jsx(Bn,{className:"min-w-120",playerID:i.playerID,action:c,sourceID:i.ID,context:o,onContextChange:s,onContextConfirm:d=>{t(c,d),a({activeActionID:void 0})}})}),n.jsx(ce,{children:n.jsx(Qa,{context:o,actions:l,activeActionID:r,onActiveActionIDChange:d=>a({activeActionID:d})},i.ID)})]})}function Ja({current:e}){const{state:t,resolvePrompt:r}=C(d=>d),o=H(),s=t.promptQueue[0],a=W(t,s?.context.sourceID),i=W(t,e?.context.sourceID),l=s&&s.context.playerID===o,c=!l&&e&&i;return n.jsxs(ce,{mode:"wait",children:[l&&n.jsx(ei,{action:s.action,context:s.context,source:a,onActionConfirm:d=>r(d)},s.ID),c&&n.jsx(ti,{action:e.action,context:e.context,source:i},e.ID)]})}function ei({context:e,source:t,action:r,onActionConfirm:o}){return n.jsx(Ke,{playerID:e.playerID,source:t,actions:[r],activeActionID:r.ID,contextTitle:"Choose Next Fighters",onActiveActionIDChange:()=>{},onActionConfirm:(s,a)=>{o(a)}})}function ti({action:e,source:t}){return n.jsxs(O.div,{className:"w-full text-center self-center justify-self-center m-auto z-30 py-20",transition:{duration:.4},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{background:"radial-gradient(ellipse at center,rgba(0, 0, 0, 0.73) 0%, rgba(0, 0, 0, 0.55) 5%, rgba(0, 0, 0, 0) 40%)"},children:[n.jsxs("div",{className:"text-center text-muted-foreground",children:[n.jsx("span",{className:"title text-xl text-white",children:t.name})," uses"]}),n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"absolute w-80 h-full top-0 left-46 z-0"}),n.jsx("h1",{className:"text-7xl font-black text-center z-10 relative text-shadow-lg title",children:e.name})]})]})}function ni(){const{state:e,resolvePrompt:t}=C(s=>s),r=H(),o=e.promptQueue[0];if(o&&o.context.playerID===r){const s=o.action,a=o.context,i=W(e,a.sourceID);return n.jsx(Ke,{playerID:a.playerID,source:i,actions:[s],activeActionID:s.ID,contextTitle:"Choose Next Fighters",onActiveActionIDChange:()=>{},onActionConfirm:(l,c)=>{t(c)}},o.ID)}return n.jsx("div",{className:"w-172"})}function ri(){const{state:e,resolvePrompt:t}=C(s=>s),r=H(),o=e.promptQueue[0];if(o&&o.context.playerID===r){const s=o.action,a=o.context,i=W(e,a.sourceID);return n.jsx(Ke,{playerID:a.playerID,source:i,actions:[s],activeActionID:s.ID,contextTitle:"Choose Starting Fighters",onActiveActionIDChange:()=>{},onActionConfirm:(l,c)=>{t(c)}},o.ID)}return null}function oi(){const{state:e,deleteCombat:t}=C(i=>i),r=H(),o=e.players.find(i=>i.ID===r),s=e.players.find(i=>i.ID!==r),a=Bo(e,o);return n.jsxs(tn,{className:"w-90 m-auto",transition:{duration:.4},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[n.jsx(Ho,{className:"text-center",children:a?n.jsx(ot,{children:"You Lose."}):n.jsx(ot,{children:"Victory!"})}),!a&&n.jsxs(xt,{children:[n.jsx("p",{children:"Rewards:"}),n.jsxs("span",{className:"inline-flex items-center",children:[s.credits," ",n.jsx(st,{})]}),n.jsx("ul",{children:s.items.map(i=>n.jsx("li",{children:i.name},i.ID))})]}),n.jsx(nn,{className:"justify-end",children:!a&&n.jsxs(B,{onClick:()=>{t()},children:["Continue",n.jsx(rn,{})]})})]})}function si(e,t){switch(e){case"action":return 1500;case"trigger":return t==="main"?500:100;default:return 100}}function Dt(){const e=C(s=>s.next),t=C(s=>s.state),r=Uo(t),o=t.combat.phase;u.useEffect(()=>{const s=setInterval(()=>{e()},si(r,o));return()=>clearInterval(s)},[r,o])}function ai(){switch(C(t=>t.state.combat?.phase)){case"start":return n.jsx(ii,{});case"planning":return n.jsx(ci,{});case"main":return n.jsx(li,{});case"end":case"pre":return n.jsx(ui,{});default:return null}}function ii(){return Dt(),null}function ci(){const e=C(o=>o.state),t=z(o=>o.resetActive),r=e.actionQueue.map(o=>o.ID).length;return u.useEffect(()=>{t(e)},[r]),null}function li(){return Dt(),null}function ui(){return Dt(),null}function di({current:e}){const r=C(o=>o.state).combat.phase;return r?n.jsxs(n.Fragment,{children:[n.jsx(ai,{}),n.jsxs(on,{children:[r==="start"&&n.jsx(Xa,{}),r==="planning"&&n.jsx(Za,{}),r==="main"&&n.jsx(Ja,{current:e}),r==="end"&&n.jsx(ni,{}),r==="pre"&&n.jsx(ri,{}),r==="post"&&n.jsx(oi,{})]})]}):null}function fi({start:e,end:t,source:r,target:o,...s}){let a;const i=t.x-e.x,l=t.y-e.y,c=Math.sqrt(i*i+l*l),d=r==="ally"&&o==="ally";let p=d?c/4:c/3*(o==="ally"?-1:1);if(c===0)return null;if(d){const f=-l/(c/2),h=i/(c/2),x=e.x+f*p,m=e.y+h*p-20,g=t.x+f*p,v=t.y+h*p;a=`M ${e.x},${e.y} C ${x},${m} ${g},${v} ${t.x},${t.y}`}else a=`M ${e.x},${e.y} C ${e.x},${e.y-p} ${t.x},${t.y+p} ${t.x},${t.y}`;return n.jsx("g",{children:n.jsx("path",{d:a,strokeWidth:"2",fill:"none",strokeDasharray:"5, 5",...s,children:n.jsx("animate",{attributeName:"stroke-dashoffset",from:"1000",to:"0",dur:"15s",repeatCount:"indefinite"})})})}function pi({sourceActor:e,sourceRef:t,state:r,targetID:o}){const s=H(),a=r.actors.find(S=>S.ID===o),i=r.players.find(S=>S.ID===a.playerID),c=z(S=>S.activeRefs)[i.ID],d=Object.values(c).find((S,N)=>N===i.activeActorIDs.indexOf(o));if(!d||!d.current||!t||!t.current)return console.log("missing ref",o,c),null;const p=d.current.getBoundingClientRect();if(!p)return console.log("no target position"),null;const f=W(r,o);if(!f)return console.log("no target actor"),null;const h=e.playerID===s,x=f.playerID===s,m=t.current.getBoundingClientRect(),g=m.x+m.width/2,v=h?m.y+4:m.y+m.height*1,y=p.x+p.width/2,D=x?p.y+8:p.y+p.height*1-4;return n.jsxs("svg",{className:b("absolute inset-0 pointer-events-none h-screen w-screen",{"z-10":e.playerID===f.playerID}),children:[n.jsx("defs",{children:n.jsx("filter",{id:"shadow",children:n.jsx("feDropShadow",{dx:"3",dy:"3",stdDeviation:"1","flood-color":"black","flood-opacity":"0.9"})})}),n.jsx(fi,{start:{x:g,y:v},end:{x:y,y:D},stroke:h?"var(--color-ally)":"var(--color-enemy)",source:h?"ally":"enemy",target:x?"ally":"enemy",filter:"url(#shadow)"})]})}function Hn({current:e,sourceRef:t}){const r=z(c=>c.activeRefs),o=C(c=>c.state),s=o.players.find(c=>c.ID===e.context.playerID),a=r[e.context.playerID],i=sn(o,e.context);if(t=t??Object.values(a).find((c,d)=>d===s.activeActorIDs.indexOf(e.context.sourceID)),!t)return null;const l=W(o,i.sourceID);return l?n.jsx(n.Fragment,{children:i.targetIDs.map((c,d)=>c&&n.jsx(pi,{sourceActor:l,sourceRef:t,state:o,targetID:c},i.sourceID+c+d))}):null}function hi(){const e=z(c=>c),t=C(c=>c.state),{actors:r,combat:o}=t;if(!e.activeContext)return null;const s=sn(t,e.activeContext),a=r.find(c=>c.ID===s.sourceID),i=a?.actions.find(c=>c.ID===e.activeActionID),l=new Set(s.targetIDs.concat(e.hoverActorID).filter(c=>!!c));return!o||o.phase!=="planning"||!i||!a?null:n.jsx(Hn,{sourceRef:e.activeActionRef,current:{ID:"staging",action:i,context:{...s,targetIDs:Array.from(l)}}})}function mi({sourceID:e,textOnly:t}){const r=C(s=>s.state),o=pt(r,e);return o?t?n.jsxs("span",{className:"pr-2 float-left",children:[Ko(o),":"]}):n.jsxs("div",{className:b("size-10 float-left mr-3 relative mb-4"),children:[n.jsx("img",{src:o.image,className:"actor-portrait min-w-18 min-h-18 absolute -top-1 -left-4"}),n.jsx("div",{className:"absolute -bottom-3 title text-md rounded-xs flex justify-center left-0 right-0 h-4 leading-3 text-center bg-black border ring ring-black",style:{textShadow:"1px 1px 1px black"},children:o.name})]}):n.jsx("span",{className:"pr-2 float-left",children:"???:"})}function Un({className:e,message:t,textOnly:r,...o}){const{context:s}=t;return n.jsxs("span",{className:b({"text-muted-foreground":t.type==="narration","text-foreground":t.type==="dialogue"},e),...o,children:[!!s.sourceID&&n.jsx(mi,{sourceID:s.sourceID,textOnly:r}),t.text]})}const xi=ve({playerID:Wo.getState().playerID});function gi({className:e,...t}){const r=C(c=>c.state),o=r.messageLog,s=at(r),i=r.encounter.nodes.find(c=>c.ID===s.activeNodeID)?.messages(r,xi).map(c=>c.ID)??[],l=u.useRef(null);return co(()=>{l.current&&l.current.scrollIntoView({behavior:"auto"})},[o.length]),n.jsx(wt,{className:b("max-h-50 px-3 pt-4",e),...t,children:n.jsxs("ul",{className:"text-xs text-muted-foreground pt-2",children:[o.filter(c=>!i.includes(c.ID)).map((c,d)=>n.jsx("li",{className:"hover:bg-muted/50",style:{opacity:c.depth>0?.7:1,paddingLeft:c.depth*16},children:n.jsx(Un,{message:c,textOnly:!0})},d+c.ID)),n.jsx("div",{ref:l})]})})}var nt="rovingFocusGroup.onEntryFocus",vi={bubbles:!1,cancelable:!0},Ce="RovingFocusGroup",[it,Kn,bi]=an(Ce),[yi,We]=ge(Ce,[bi]),[ji,wi]=yi(Ce),Wn=u.forwardRef((e,t)=>n.jsx(it.Provider,{scope:e.__scopeRovingFocusGroup,children:n.jsx(it.Slot,{scope:e.__scopeRovingFocusGroup,children:n.jsx(Di,{...e,ref:t})})}));Wn.displayName=Ce;var Di=u.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:o,loop:s=!1,dir:a,currentTabStopId:i,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:d,preventScrollOnEntryFocus:p=!1,...f}=e,h=u.useRef(null),x=F(t,h),m=$e(a),[g,v]=Ge({prop:i,defaultProp:l??null,onChange:c,caller:Ce}),[y,D]=u.useState(!1),S=J(d),N=Kn(r),_=u.useRef(!1),[R,A]=u.useState(0);return u.useEffect(()=>{const M=h.current;if(M)return M.addEventListener(nt,S),()=>M.removeEventListener(nt,S)},[S]),n.jsx(ji,{scope:r,orientation:o,dir:m,loop:s,currentTabStopId:g,onItemFocus:u.useCallback(M=>v(M),[v]),onItemShiftTab:u.useCallback(()=>D(!0),[]),onFocusableItemAdd:u.useCallback(()=>A(M=>M+1),[]),onFocusableItemRemove:u.useCallback(()=>A(M=>M-1),[]),children:n.jsx(T.div,{tabIndex:y||R===0?-1:0,"data-orientation":o,...f,ref:x,style:{outline:"none",...e.style},onMouseDown:j(e.onMouseDown,()=>{_.current=!0}),onFocus:j(e.onFocus,M=>{const w=!_.current;if(M.target===M.currentTarget&&w&&!y){const E=new CustomEvent(nt,vi);if(M.currentTarget.dispatchEvent(E),!E.defaultPrevented){const P=N().filter(K=>K.focusable),X=P.find(K=>K.active),ne=P.find(K=>K.id===g),Ae=[X,ne,...P].filter(Boolean).map(K=>K.ref.current);qn(Ae,p)}}_.current=!1}),onBlur:j(e.onBlur,()=>D(!1))})})}),Yn="RovingFocusGroupItem",Xn=u.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:o=!0,active:s=!1,tabStopId:a,children:i,...l}=e,c=le(),d=a||c,p=wi(Yn,r),f=p.currentTabStopId===d,h=Kn(r),{onFocusableItemAdd:x,onFocusableItemRemove:m,currentTabStopId:g}=p;return u.useEffect(()=>{if(o)return x(),()=>m()},[o,x,m]),n.jsx(it.ItemSlot,{scope:r,id:d,focusable:o,active:s,children:n.jsx(T.span,{tabIndex:f?0:-1,"data-orientation":p.orientation,...l,ref:t,onMouseDown:j(e.onMouseDown,v=>{o?p.onItemFocus(d):v.preventDefault()}),onFocus:j(e.onFocus,()=>p.onItemFocus(d)),onKeyDown:j(e.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){p.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const y=Si(v,p.orientation,p.dir);if(y!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let S=h().filter(N=>N.focusable).map(N=>N.ref.current);if(y==="last")S.reverse();else if(y==="prev"||y==="next"){y==="prev"&&S.reverse();const N=S.indexOf(v.currentTarget);S=p.loop?Ni(S,N+1):S.slice(N+1)}setTimeout(()=>qn(S))}}),children:typeof i=="function"?i({isCurrentTabStop:f,hasTabStop:g!=null}):i})})});Xn.displayName=Yn;var Ii={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Ci(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Si(e,t,r){const o=Ci(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return Ii[o]}function qn(e,t=!1){const r=document.activeElement;for(const o of e)if(o===r||(o.focus({preventScroll:t}),document.activeElement!==r))return}function Ni(e,t){return e.map((r,o)=>e[(t+o)%e.length])}var Qn=Wn,Zn=Xn,ct=["Enter"," "],Ai=["ArrowDown","PageUp","Home"],Jn=["ArrowUp","PageDown","End"],Mi=[...Ai,...Jn],Ri={ltr:[...ct,"ArrowRight"],rtl:[...ct,"ArrowLeft"]},Ei={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Se="Menu",[De,_i,Pi]=an(Se),[de,er]=ge(Se,[Pi,cn,We]),Ye=cn(),tr=We(),[Ti,fe]=de(Se),[ki,Ne]=de(Se),nr=e=>{const{__scopeMenu:t,open:r=!1,children:o,dir:s,onOpenChange:a,modal:i=!0}=e,l=Ye(t),[c,d]=u.useState(null),p=u.useRef(!1),f=J(a),h=$e(s);return u.useEffect(()=>{const x=()=>{p.current=!0,document.addEventListener("pointerdown",m,{capture:!0,once:!0}),document.addEventListener("pointermove",m,{capture:!0,once:!0})},m=()=>p.current=!1;return document.addEventListener("keydown",x,{capture:!0}),()=>{document.removeEventListener("keydown",x,{capture:!0}),document.removeEventListener("pointerdown",m,{capture:!0}),document.removeEventListener("pointermove",m,{capture:!0})}},[]),n.jsx(Yo,{...l,children:n.jsx(Ti,{scope:t,open:r,onOpenChange:f,content:c,onContentChange:d,children:n.jsx(ki,{scope:t,onClose:u.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:p,dir:h,modal:i,children:o})})})};nr.displayName=Se;var Oi="MenuAnchor",It=u.forwardRef((e,t)=>{const{__scopeMenu:r,...o}=e,s=Ye(r);return n.jsx(Xo,{...s,...o,ref:t})});It.displayName=Oi;var Ct="MenuPortal",[Li,rr]=de(Ct,{forceMount:void 0}),or=e=>{const{__scopeMenu:t,forceMount:r,children:o,container:s}=e,a=fe(Ct,t);return n.jsx(Li,{scope:t,forceMount:r,children:n.jsx(V,{present:r||a.open,children:n.jsx(ln,{asChild:!0,container:s,children:o})})})};or.displayName=Ct;var G="MenuContent",[Fi,St]=de(G),sr=u.forwardRef((e,t)=>{const r=rr(G,e.__scopeMenu),{forceMount:o=r.forceMount,...s}=e,a=fe(G,e.__scopeMenu),i=Ne(G,e.__scopeMenu);return n.jsx(De.Provider,{scope:e.__scopeMenu,children:n.jsx(V,{present:o||a.open,children:n.jsx(De.Slot,{scope:e.__scopeMenu,children:i.modal?n.jsx($i,{...s,ref:t}):n.jsx(zi,{...s,ref:t})})})})}),$i=u.forwardRef((e,t)=>{const r=fe(G,e.__scopeMenu),o=u.useRef(null),s=F(t,o);return u.useEffect(()=>{const a=o.current;if(a)return un(a)},[]),n.jsx(Nt,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:j(e.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),zi=u.forwardRef((e,t)=>{const r=fe(G,e.__scopeMenu);return n.jsx(Nt,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),Gi=pn("MenuContent.ScrollLock"),Nt=u.forwardRef((e,t)=>{const{__scopeMenu:r,loop:o=!1,trapFocus:s,onOpenAutoFocus:a,onCloseAutoFocus:i,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:f,onInteractOutside:h,onDismiss:x,disableOutsideScroll:m,...g}=e,v=fe(G,r),y=Ne(G,r),D=Ye(r),S=tr(r),N=_i(r),[_,R]=u.useState(null),A=u.useRef(null),M=F(t,A,v.onContentChange),w=u.useRef(0),E=u.useRef(""),P=u.useRef(0),X=u.useRef(null),ne=u.useRef("right"),be=u.useRef(0),Ae=m?fn:u.Fragment,K=m?{as:Gi,allowPinchZoom:!0}:void 0,q=I=>{const re=E.current+I,Q=N().filter(k=>!k.disabled),oe=document.activeElement,pe=Q.find(k=>k.ref.current===oe)?.textValue,he=Q.map(k=>k.textValue),se=Ji(he,re,pe),Z=Q.find(k=>k.textValue===se)?.ref.current;(function k(ae){E.current=ae,window.clearTimeout(w.current),ae!==""&&(w.current=window.setTimeout(()=>k(""),1e3))})(re),Z&&setTimeout(()=>Z.focus())};u.useEffect(()=>()=>window.clearTimeout(w.current),[]),dn();const L=u.useCallback(I=>ne.current===X.current?.side&&tc(I,X.current?.area),[]);return n.jsx(Fi,{scope:r,searchRef:E,onItemEnter:u.useCallback(I=>{L(I)&&I.preventDefault()},[L]),onItemLeave:u.useCallback(I=>{L(I)||(A.current?.focus(),R(null))},[L]),onTriggerLeave:u.useCallback(I=>{L(I)&&I.preventDefault()},[L]),pointerGraceTimerRef:P,onPointerGraceIntentChange:u.useCallback(I=>{X.current=I},[]),children:n.jsx(Ae,{...K,children:n.jsx(hn,{asChild:!0,trapped:s,onMountAutoFocus:j(a,I=>{I.preventDefault(),A.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:n.jsx(mn,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:f,onInteractOutside:h,onDismiss:x,children:n.jsx(Qn,{asChild:!0,...S,dir:y.dir,orientation:"vertical",loop:o,currentTabStopId:_,onCurrentTabStopIdChange:R,onEntryFocus:j(c,I=>{y.isUsingKeyboardRef.current||I.preventDefault()}),preventScrollOnEntryFocus:!0,children:n.jsx(Qo,{role:"menu","aria-orientation":"vertical","data-state":jr(v.open),"data-radix-menu-content":"",dir:y.dir,...D,...g,ref:M,style:{outline:"none",...g.style},onKeyDown:j(g.onKeyDown,I=>{const Q=I.target.closest("[data-radix-menu-content]")===I.currentTarget,oe=I.ctrlKey||I.altKey||I.metaKey,pe=I.key.length===1;Q&&(I.key==="Tab"&&I.preventDefault(),!oe&&pe&&q(I.key));const he=A.current;if(I.target!==he||!Mi.includes(I.key))return;I.preventDefault();const Z=N().filter(k=>!k.disabled).map(k=>k.ref.current);Jn.includes(I.key)&&Z.reverse(),Qi(Z)}),onBlur:j(e.onBlur,I=>{I.currentTarget.contains(I.target)||(window.clearTimeout(w.current),E.current="")}),onPointerMove:j(e.onPointerMove,Ie(I=>{const re=I.target,Q=be.current!==I.clientX;if(I.currentTarget.contains(re)&&Q){const oe=I.clientX>be.current?"right":"left";ne.current=oe,be.current=I.clientX}}))})})})})})})});sr.displayName=G;var Vi="MenuGroup",At=u.forwardRef((e,t)=>{const{__scopeMenu:r,...o}=e;return n.jsx(T.div,{role:"group",...o,ref:t})});At.displayName=Vi;var Bi="MenuLabel",ar=u.forwardRef((e,t)=>{const{__scopeMenu:r,...o}=e;return n.jsx(T.div,{...o,ref:t})});ar.displayName=Bi;var ke="MenuItem",Ut="menu.itemSelect",Xe=u.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:o,...s}=e,a=u.useRef(null),i=Ne(ke,e.__scopeMenu),l=St(ke,e.__scopeMenu),c=F(t,a),d=u.useRef(!1),p=()=>{const f=a.current;if(!r&&f){const h=new CustomEvent(Ut,{bubbles:!0,cancelable:!0});f.addEventListener(Ut,x=>o?.(x),{once:!0}),qo(f,h),h.defaultPrevented?d.current=!1:i.onClose()}};return n.jsx(ir,{...s,ref:c,disabled:r,onClick:j(e.onClick,p),onPointerDown:f=>{e.onPointerDown?.(f),d.current=!0},onPointerUp:j(e.onPointerUp,f=>{d.current||f.currentTarget?.click()}),onKeyDown:j(e.onKeyDown,f=>{const h=l.searchRef.current!=="";r||h&&f.key===" "||ct.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});Xe.displayName=ke;var ir=u.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:o=!1,textValue:s,...a}=e,i=St(ke,r),l=tr(r),c=u.useRef(null),d=F(t,c),[p,f]=u.useState(!1),[h,x]=u.useState("");return u.useEffect(()=>{const m=c.current;m&&x((m.textContent??"").trim())},[a.children]),n.jsx(De.ItemSlot,{scope:r,disabled:o,textValue:s??h,children:n.jsx(Zn,{asChild:!0,...l,focusable:!o,children:n.jsx(T.div,{role:"menuitem","data-highlighted":p?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...a,ref:d,onPointerMove:j(e.onPointerMove,Ie(m=>{o?i.onItemLeave(m):(i.onItemEnter(m),m.defaultPrevented||m.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:j(e.onPointerLeave,Ie(m=>i.onItemLeave(m))),onFocus:j(e.onFocus,()=>f(!0)),onBlur:j(e.onBlur,()=>f(!1))})})})}),Hi="MenuCheckboxItem",cr=u.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:o,...s}=e;return n.jsx(pr,{scope:e.__scopeMenu,checked:r,children:n.jsx(Xe,{role:"menuitemcheckbox","aria-checked":Oe(r)?"mixed":r,...s,ref:t,"data-state":Rt(r),onSelect:j(s.onSelect,()=>o?.(Oe(r)?!0:!r),{checkForDefaultPrevented:!1})})})});cr.displayName=Hi;var lr="MenuRadioGroup",[Ui,Ki]=de(lr,{value:void 0,onValueChange:()=>{}}),ur=u.forwardRef((e,t)=>{const{value:r,onValueChange:o,...s}=e,a=J(o);return n.jsx(Ui,{scope:e.__scopeMenu,value:r,onValueChange:a,children:n.jsx(At,{...s,ref:t})})});ur.displayName=lr;var dr="MenuRadioItem",fr=u.forwardRef((e,t)=>{const{value:r,...o}=e,s=Ki(dr,e.__scopeMenu),a=r===s.value;return n.jsx(pr,{scope:e.__scopeMenu,checked:a,children:n.jsx(Xe,{role:"menuitemradio","aria-checked":a,...o,ref:t,"data-state":Rt(a),onSelect:j(o.onSelect,()=>s.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});fr.displayName=dr;var Mt="MenuItemIndicator",[pr,Wi]=de(Mt,{checked:!1}),hr=u.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:o,...s}=e,a=Wi(Mt,r);return n.jsx(V,{present:o||Oe(a.checked)||a.checked===!0,children:n.jsx(T.span,{...s,ref:t,"data-state":Rt(a.checked)})})});hr.displayName=Mt;var Yi="MenuSeparator",mr=u.forwardRef((e,t)=>{const{__scopeMenu:r,...o}=e;return n.jsx(T.div,{role:"separator","aria-orientation":"horizontal",...o,ref:t})});mr.displayName=Yi;var Xi="MenuArrow",xr=u.forwardRef((e,t)=>{const{__scopeMenu:r,...o}=e,s=Ye(r);return n.jsx(Zo,{...s,...o,ref:t})});xr.displayName=Xi;var qi="MenuSub",[au,gr]=de(qi),we="MenuSubTrigger",vr=u.forwardRef((e,t)=>{const r=fe(we,e.__scopeMenu),o=Ne(we,e.__scopeMenu),s=gr(we,e.__scopeMenu),a=St(we,e.__scopeMenu),i=u.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=a,d={__scopeMenu:e.__scopeMenu},p=u.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return u.useEffect(()=>p,[p]),u.useEffect(()=>{const f=l.current;return()=>{window.clearTimeout(f),c(null)}},[l,c]),n.jsx(It,{asChild:!0,...d,children:n.jsx(ir,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":s.contentId,"data-state":jr(r.open),...e,ref:xn(t,s.onTriggerChange),onClick:f=>{e.onClick?.(f),!(e.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:j(e.onPointerMove,Ie(f=>{a.onItemEnter(f),!f.defaultPrevented&&!e.disabled&&!r.open&&!i.current&&(a.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),p()},100))})),onPointerLeave:j(e.onPointerLeave,Ie(f=>{p();const h=r.content?.getBoundingClientRect();if(h){const x=r.content?.dataset.side,m=x==="right",g=m?-5:5,v=h[m?"left":"right"],y=h[m?"right":"left"];a.onPointerGraceIntentChange({area:[{x:f.clientX+g,y:f.clientY},{x:v,y:h.top},{x:y,y:h.top},{x:y,y:h.bottom},{x:v,y:h.bottom}],side:x}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.onPointerGraceIntentChange(null),300)}else{if(a.onTriggerLeave(f),f.defaultPrevented)return;a.onPointerGraceIntentChange(null)}})),onKeyDown:j(e.onKeyDown,f=>{const h=a.searchRef.current!=="";e.disabled||h&&f.key===" "||Ri[o.dir].includes(f.key)&&(r.onOpenChange(!0),r.content?.focus(),f.preventDefault())})})})});vr.displayName=we;var br="MenuSubContent",yr=u.forwardRef((e,t)=>{const r=rr(G,e.__scopeMenu),{forceMount:o=r.forceMount,...s}=e,a=fe(G,e.__scopeMenu),i=Ne(G,e.__scopeMenu),l=gr(br,e.__scopeMenu),c=u.useRef(null),d=F(t,c);return n.jsx(De.Provider,{scope:e.__scopeMenu,children:n.jsx(V,{present:o||a.open,children:n.jsx(De.Slot,{scope:e.__scopeMenu,children:n.jsx(Nt,{id:l.contentId,"aria-labelledby":l.triggerId,...s,ref:d,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:p=>{i.isUsingKeyboardRef.current&&c.current?.focus(),p.preventDefault()},onCloseAutoFocus:p=>p.preventDefault(),onFocusOutside:j(e.onFocusOutside,p=>{p.target!==l.trigger&&a.onOpenChange(!1)}),onEscapeKeyDown:j(e.onEscapeKeyDown,p=>{i.onClose(),p.preventDefault()}),onKeyDown:j(e.onKeyDown,p=>{const f=p.currentTarget.contains(p.target),h=Ei[i.dir].includes(p.key);f&&h&&(a.onOpenChange(!1),l.trigger?.focus(),p.preventDefault())})})})})})});yr.displayName=br;function jr(e){return e?"open":"closed"}function Oe(e){return e==="indeterminate"}function Rt(e){return Oe(e)?"indeterminate":e?"checked":"unchecked"}function Qi(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function Zi(e,t){return e.map((r,o)=>e[(t+o)%e.length])}function Ji(e,t,r){const s=t.length>1&&Array.from(t).every(d=>d===t[0])?t[0]:t,a=r?e.indexOf(r):-1;let i=Zi(e,Math.max(a,0));s.length===1&&(i=i.filter(d=>d!==r));const c=i.find(d=>d.toLowerCase().startsWith(s.toLowerCase()));return c!==r?c:void 0}function ec(e,t){const{x:r,y:o}=e;let s=!1;for(let a=0,i=t.length-1;a<t.length;i=a++){const l=t[a],c=t[i],d=l.x,p=l.y,f=c.x,h=c.y;p>o!=h>o&&r<(f-d)*(o-p)/(h-p)+d&&(s=!s)}return s}function tc(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return ec(r,t)}function Ie(e){return t=>t.pointerType==="mouse"?e(t):void 0}var nc=nr,rc=It,oc=or,sc=sr,ac=At,ic=ar,cc=Xe,lc=cr,uc=ur,dc=fr,fc=hr,pc=mr,hc=xr,mc=vr,xc=yr,qe="DropdownMenu",[gc]=ge(qe,[er]),$=er(),[vc,wr]=gc(qe),Dr=e=>{const{__scopeDropdownMenu:t,children:r,dir:o,open:s,defaultOpen:a,onOpenChange:i,modal:l=!0}=e,c=$(t),d=u.useRef(null),[p,f]=Ge({prop:s,defaultProp:a??!1,onChange:i,caller:qe});return n.jsx(vc,{scope:t,triggerId:le(),triggerRef:d,contentId:le(),open:p,onOpenChange:f,onOpenToggle:u.useCallback(()=>f(h=>!h),[f]),modal:l,children:n.jsx(nc,{...c,open:p,onOpenChange:f,dir:o,modal:l,children:r})})};Dr.displayName=qe;var Ir="DropdownMenuTrigger",Cr=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:o=!1,...s}=e,a=wr(Ir,r),i=$(r);return n.jsx(rc,{asChild:!0,...i,children:n.jsx(T.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":o?"":void 0,disabled:o,...s,ref:xn(t,a.triggerRef),onPointerDown:j(e.onPointerDown,l=>{!o&&l.button===0&&l.ctrlKey===!1&&(a.onOpenToggle(),a.open||l.preventDefault())}),onKeyDown:j(e.onKeyDown,l=>{o||(["Enter"," "].includes(l.key)&&a.onOpenToggle(),l.key==="ArrowDown"&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});Cr.displayName=Ir;var bc="DropdownMenuPortal",Sr=e=>{const{__scopeDropdownMenu:t,...r}=e,o=$(t);return n.jsx(oc,{...o,...r})};Sr.displayName=bc;var Nr="DropdownMenuContent",Ar=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=wr(Nr,r),a=$(r),i=u.useRef(!1);return n.jsx(sc,{id:s.contentId,"aria-labelledby":s.triggerId,...a,...o,ref:t,onCloseAutoFocus:j(e.onCloseAutoFocus,l=>{i.current||s.triggerRef.current?.focus(),i.current=!1,l.preventDefault()}),onInteractOutside:j(e.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,p=c.button===2||d;(!s.modal||p)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Ar.displayName=Nr;var yc="DropdownMenuGroup",Mr=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(ac,{...s,...o,ref:t})});Mr.displayName=yc;var jc="DropdownMenuLabel",wc=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(ic,{...s,...o,ref:t})});wc.displayName=jc;var Dc="DropdownMenuItem",Rr=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(cc,{...s,...o,ref:t})});Rr.displayName=Dc;var Ic="DropdownMenuCheckboxItem",Cc=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(lc,{...s,...o,ref:t})});Cc.displayName=Ic;var Sc="DropdownMenuRadioGroup",Nc=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(uc,{...s,...o,ref:t})});Nc.displayName=Sc;var Ac="DropdownMenuRadioItem",Mc=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(dc,{...s,...o,ref:t})});Mc.displayName=Ac;var Rc="DropdownMenuItemIndicator",Ec=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(fc,{...s,...o,ref:t})});Ec.displayName=Rc;var _c="DropdownMenuSeparator",Pc=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(pc,{...s,...o,ref:t})});Pc.displayName=_c;var Tc="DropdownMenuArrow",kc=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(hc,{...s,...o,ref:t})});kc.displayName=Tc;var Oc="DropdownMenuSubTrigger",Lc=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(mc,{...s,...o,ref:t})});Lc.displayName=Oc;var Fc="DropdownMenuSubContent",$c=u.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...o}=e,s=$(r);return n.jsx(xc,{...s,...o,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});$c.displayName=Fc;var zc=Dr,Gc=Cr,Vc=Sr,Bc=Ar,Hc=Mr,Uc=Rr;function Kc({...e}){return n.jsx(zc,{"data-slot":"dropdown-menu",...e})}function Wc({...e}){return n.jsx(Gc,{"data-slot":"dropdown-menu-trigger",...e})}function Yc({className:e,sideOffset:t=4,...r}){return n.jsx(Vc,{children:n.jsx(Bc,{"data-slot":"dropdown-menu-content",sideOffset:t,className:b("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-xs border p-1 shadow-md","ring ring-black",e),...r})})}function Xc({...e}){return n.jsx(Hc,{"data-slot":"dropdown-menu-group",...e})}function qc({className:e,inset:t,variant:r="default",...o}){return n.jsx(Uc,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":r,className:b("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...o})}function lt({value:e,variant:t="secondary",size:r="xs",className:o,children:s,...a}){return n.jsxs(B,{variant:t,size:r,className:b("text-muted-foreground hover:bg-ring/50 hover:text-foreground/70 border border-white/5 ring ring-black/30",{"!opacity-100":!!e},o),...a,children:[s,!a.disabled&&n.jsx(Jo,{})]})}function ut({placeholder:e,disabled:t,options:r,onValueChange:o,...s}){const a=H(),i=r.find(l=>l.ID===s.value);return u.useEffect(()=>{r.length===1&&!i&&!t&&o(r[0].ID)},[r.length,t]),n.jsxs(Kc,{children:[n.jsx(Wc,{asChild:!0,children:n.jsx(lt,{className:b("data-[state=open]:text-foreground",{"text-foreground hover:text-foreground":i,"bg-slate-700 hover:bg-slate-700/80":i?.playerID===a,"bg-stone-700 hover:bg-stone-700/80":i&&i?.playerID!==a}),value:i?.ID,disabled:t||r.length===0,children:i?.name||e})}),n.jsx(Yc,{children:n.jsx(Xc,{children:r.map(l=>n.jsxs(qc,{className:b({"dark:hover:bg-slate-800 border border-transparent hover:border-slate-700":l.playerID===a,"dark:bg-slate-900 dark:border-slate-800":l.playerID===a&&l.ID===s.value,"dark:hover:bg-stone-800":l.playerID&&l.playerID!==a,"":l.playerID&&l.playerID!==a&&l.ID===s.value}),onSelect:()=>{l.ID===s.value?o(void 0):o(l.ID)},children:[l.ID===s.value&&n.jsx(Ps,{}),l.name]},l.ID))})})]})}function Qc({className:e,disabled:t,...r}){return n.jsx(ts,{className:b("h-8 border-none rounded-xs dark:bg-input/60",{"dark:hover:bg-input":!t},e),...r})}function Zc({option:e,onConfirm:t}){const r=C(h=>h.state),[o,s]=u.useState(e.context),a=!ze(e.action,r,o),i=Ve(r),l=e.action.sources(r,o),c=e.action.targets.get(r,o),d=e.action.targets.max(r,o),p=e.action.targets.validate(r,o);function f(h){return c.map(x=>x.target).filter(x=>!o.targetIDs.includes(x.ID)||o.targetIDs[h]===x.ID)}return e.disable==="hide"&&a?null:n.jsxs(Qc,{className:b("group",{"opacity-50":a||i}),disabled:a||i,children:[e.icons&&n.jsx(je,{className:b("pr-2 opacity-50 flex items-center gap-2"),children:e.icons}),l.length>0&&n.jsx(je,{children:n.jsx(ut,{placeholder:"Source",disabled:a||i,options:l,value:o.sourceID,onValueChange:h=>s(x=>({...x,sourceID:h??""}))})}),n.jsx(je,{className:b("pr-2",{"group-hover:text-foreground/70":!(a||i)}),children:e.text}),d>0&&c.length>0&&n.jsx(je,{className:"gap-2",children:Array.from({length:d}).map((h,x)=>n.jsx(ut,{placeholder:"Select",disabled:a||i,options:f(x),value:o.targetIDs[x],onValueChange:m=>s(g=>({...g,targetIDs:[...g.targetIDs.slice(0,x),m,...g.targetIDs.slice(x+1)]}))},x))}),n.jsx("div",{className:"flex-1"}),p&&!(a||i)&&n.jsx(je,{align:"inline-end",children:n.jsx(es,{className:"cursor-pointer rounded-full opacity-70 hover:opacity-100",size:"icon-xs",variant:"default",onClick:()=>{t(o),s(e.context)},children:n.jsx(Es,{})})})]})}function Jc({className:e,...t}){return n.jsx(Vn,{orientation:"vertical",className:b("flex flex-col gap-0 w-full border rounded-sm ring ring-black"),...t})}function el({messages:e}){return n.jsx(O.ul,{className:"space-y-2 border-t border-border/50 py-4 px-2 flex-1 overflow-y-auto",children:e.map((t,r)=>n.jsx(O.li,{className:"max-w-4/5 leading-1.5",initial:{opacity:0},animate:{opacity:1},transition:{delay:r/4},children:n.jsx(Un,{className:"text-sm",message:t,textOnly:!1})},t.ID))})}function tl({className:e,...t}){return n.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:n.jsx("table",{"data-slot":"table",className:b("w-full caption-bottom text-sm",e),...t})})}function nl({className:e,...t}){return n.jsx("thead",{"data-slot":"table-header",className:b("[&_tr]:border-b",e),...t})}function rl({className:e,...t}){return n.jsx("tbody",{"data-slot":"table-body",className:b("[&_tr:last-child]:border-0",e),...t})}function Kt({className:e,...t}){return n.jsx("tr",{"data-slot":"table-row",className:b("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...t})}function Re({className:e,...t}){return n.jsx("th",{"data-slot":"table-head",className:b("text-foreground/40 h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}function Ee({className:e,...t}){return n.jsx("td",{"data-slot":"table-cell",className:b("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}function ol({className:e,...t}){return n.jsx("caption",{"data-slot":"table-caption",className:b("text-muted-foreground mt-4 text-sm",e),...t})}function Er({items:e,actionHeader:t,actions:r}){const o=ns(e);return n.jsxs(tl,{children:[n.jsx(nl,{children:n.jsxs(Kt,{className:"pointer-events-none",children:[n.jsx(Re,{}),n.jsx(Re,{children:"Name"}),n.jsx(Re,{children:"Description"}),n.jsx(Re,{className:"flex items-center justify-end",children:t??n.jsx(Ls,{})})]})}),n.jsx(rl,{children:Object.entries(o).map(([s,a])=>[e.find(i=>i.name===s),a]).map(([s,a])=>n.jsxs(Kt,{children:[n.jsx(Ee,{children:a}),n.jsx(Ee,{children:s.name}),n.jsx(Ee,{children:"The quick brown fox jumps over the lazy dog."}),n.jsx(Ee,{className:"flex justify-end gap-1",children:r(s)})]},s.ID))}),e.length===0&&n.jsx(ol,{children:"No items available."})]})}function sl(e){return{ID:rs(),name:"Purchase Item",priority:0,cooldown:()=>0,validate:(t,r)=>{const o=at(t),s=t.players.find(i=>i.ID===r.playerID),a=Ot(t,o.activeNodeID,e);return!s||!a?!1:s.credits>a.value},targets:{unique:!0,max:()=>0,get:()=>[],validate:()=>!0},sources:()=>[],resolve:(t,r)=>{const o=at(t);return[os(r,e),ss(r,[as({text:is(Ot(t,o.activeNodeID,e)," purchased.")})])]}}}function al(){const{state:e,resolveActionItem:t}=C(l=>l),r=H(),o=e.players.find(l=>l.ID===r),s=ve({playerID:r}),a=cs(e),i=Ve(e);return!a||!o?null:n.jsxs(xt,{className:"flex flex-1 flex-col gap-2 justify-between z-0 overflow-hidden",children:[n.jsx(gi,{}),n.jsxs("div",{className:"flex flex-1 flex-col justify-between overflow-hidden gap-4",children:[n.jsx(el,{messages:a.messages(e,s)}),a.type==="shop"&&n.jsx(Er,{items:a.items,actionHeader:n.jsxs(n.Fragment,{children:["Buy (",o.credits," ",n.jsx(st,{}),")"]}),actions:l=>{const c=sl(l.ID);return n.jsxs(B,{size:"xs",variant:"secondary",className:"cursor-pointer",disabled:i||!ze(c,e,s),onClick:()=>t(c,s),children:[l.value,n.jsx(st,{className:"opacity-40"})]})}}),n.jsx(Jc,{children:a.options(e,s).map((l,c)=>n.jsx(Zc,{index:c+1,option:l,onConfirm:d=>{const p=ls(l,d);t(p.action,p.context)}},l.ID))})]})]})}function il(){const{state:e}=C(t=>t);if(!e.combat)return n.jsx(cl,{})}function cl(){const e=C(o=>o.state),t=C(o=>o.next),r=Ve(e);return u.useEffect(()=>{if(!r)return;const o=setInterval(()=>{t()},100);return()=>clearInterval(o)},[r]),null}const ll="/bmt-cmbt/assets/Devastated%20Landscape1-kF47amtk.png";function ul(){const{state:e}=C(a=>a),o=!(e.combat?.phase==="planning")&&Ve(e),s=Object.values(e.pastEncounters).filter(a=>a.ID!==e.encounter.ID);return u.useEffect(()=>{},[e]),n.jsxs(n.Fragment,{children:[n.jsx(il,{}),n.jsx(on,{children:n.jsx(ce,{mode:"wait",onExitComplete:()=>{},children:n.jsxs(O.div,{className:"flex justify-center relative",transition:{duration:.4},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[n.jsx(us,{className:"absolute top-4 left-0",children:e.encounter.name}),n.jsxs(ds,{className:"gap-0 relative overflow-hidden mt-8",style:{imageRendering:"pixelated",backgroundImage:`url(${ll})`,backgroundSize:"cover",backgroundPosition:"bottom"},children:[n.jsx("div",{className:"absolute inset-0 z-0",style:{background:"linear-gradient(0deg,rgba(0, 0, 0, 0.95) 33%, rgba(0, 0, 0, 0.99) 100%)"}}),n.jsx("div",{className:"flex items-start justify-between",children:n.jsx(fs,{className:"absolute top-2 right-2 z-30",children:s.length>0&&n.jsx(B,{variant:"ghost",disabled:o,children:n.jsx("span",{className:"text-muted-foreground",children:"Travel"})})})}),n.jsx(al,{})]})]},e.encounter.ID)})})]})}function dl({className:e,...t}){return n.jsx("div",{className:b("relative h-6 bg-black/60 ring ring-black",e),style:{borderStyle:"inset"},...t})}function fl({children:e,value:t,...r}){const[o,s]=kt.useState(t);return kt.useEffect(()=>{const a=setTimeout(()=>s(t),700);return()=>clearTimeout(a)},[t]),n.jsxs(dl,{...r,children:[n.jsx(O.div,{className:b("bg-red-800/80 absolute top-0 h-full border-white/10 z-10 ring ring-black",{border:t>0}),initial:{width:`${t}%`},animate:{width:`${t}%`}}),n.jsx(O.div,{className:b("bg-white/80 absolute top-0 h-full border-white/20 z-0 ring ring-black",{border:t>0}),initial:{width:`${o}%`},animate:{width:`${o}%`}}),n.jsx("div",{className:"absolute inset-0 flex flex-row justify-end inset",children:e})]})}function _r({showHealthNumbers:e,health:t,maxHealth:r,children:o}){const s=r===0?0:t*100/r;return n.jsx(fl,{value:s,children:e&&n.jsx("div",{className:"absolute top-0.5 right-1 z-10 leading-4 title text-xl text-foreground text-shadow-md",children:o||n.jsxs(n.Fragment,{children:[Math.max(t,0),"/",r]})})})}function pl({actor:e,...t}){const r=C(a=>a.state),o=C(a=>a.filterAction),s=r.actionQueue.find(a=>a.context.sourceID===e.ID);return s?n.jsx(B,{size:"icon-xs",variant:"destructive",onClick:()=>o(s.context.sourceID),...t,children:n.jsx(Vs,{className:"size-4"})}):null}const hl=mt("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function ee({className:e,variant:t,asChild:r=!1,...o}){const s=r?ps:"span";return n.jsx(s,{"data-slot":"badge",className:b(hl({variant:t}),e),...o})}function Pr({count:e,effectID:t,...r}){const o=ms[t];return n.jsx(hs,{effectID:t,side:"bottom",asChild:!0,...r,children:n.jsxs(ee,{variant:"outline",className:"bg-background border-input text-muted-foreground p-1 [&>svg]:size-4 ring ring-black rounded-xs",children:[o?n.jsx(o.Icon,{}):n.jsx(xs,{}),e>1?`(${e})`:""]})})}const ml=mt("flex disabled:pointer-events-none outline-none p-1 px-2 rounded-sm transition-all border border-transparent",{variants:{variant:{ally:"rounded-tl-xl! bg-slate-700 hover:bg-slate-700/80 text-foreground border-slate-600! ring ring-black","ally-active":"bg-slate-300 text-slate-950 border border-white ring ring-black",enemy:"bg-transparent","enemy-active":"bg-stone-300 text-stone-950 ring ring-black",targeted:"bg-yellow-600/90 text-white ring ring-black"},defaultVariants:{variant:"ally"}}});function Tr({className:e,variant:t,...r}){return n.jsx(O.button,{className:ml({variant:t,className:e}),style:{boxShadow:t==="ally"||t==="ally-active"||t==="targeted"?"8px 0px 16px rgba(0,0,0,0.4)":void 0},...r})}function xl({actorID:e,active:t,index:r,targeted:o,disabled:s,status:a,onClick:i,...l}){const c=C(D=>D.state),{hoverActorID:d,setActiveRefs:p}=z(D=>({hoverActorID:D.hoverActorID,setActiveRefs:D.setActiveRefs})),f=u.useRef(null),[h,x]=u.useState(0),m=W(c,e),[g,v]=ft(m),y=m.state.alive?g:0;return s=s||m.state.stunned===1,o=o||d===e,u.useLayoutEffect(()=>{f.current!==null&&p(m.playerID,r,f)},[m.playerID,r,f]),n.jsxs(O.div,{initial:{y:"100%",opacity:0},animate:{y:"0%",opacity:1},exit:{y:"100%",opacity:0},className:"group flex flex-col justify-end w-64 absolute bottom-0","data-state":h>0?"open":"closed",...l,children:[n.jsx("div",{className:"flex transition-all justify-between h-6 translate-y-2 group-hover:-translate-y-1.5 group-data-[state=open]:-translate-y-1.5 z-10",children:n.jsx("div",{className:"flex -space-x-3 group-hover:space-x-1 group-data-[state=open]:space-x-1 transition-all flex-wrap",children:n.jsx(ce,{children:Object.entries(m.applied).map(([D,S])=>n.jsx(O.div,{layout:!0,initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},className:"z-30",children:n.jsx(Pr,{effectID:D,count:S,side:"top",onOpenChange:N=>{x(_=>_+(N?1:-1))}})},D))})})}),c.combat?.phase==="planning"&&n.jsx(pl,{actor:m,className:"absolute top-8 right-2 opacity-100 z-10"}),n.jsxs(Tr,{variant:o?"targeted":t?"ally-active":"ally",disabled:s,onClick:()=>i(m),className:b("flex pl-10 relative",{"opacity-50":s&&!t}),children:[n.jsx("div",{className:"absolute -left-8 -top-3 size-25 overflow-hidden z-0",ref:f,children:n.jsx("img",{src:gs[m.image],className:"actor-portrait"})}),n.jsx(ee,{className:"absolute -left-2 -bottom-2 bg-slate-900 border-slate-700 rounded-xs ring ring-black title text-xl h-6",variant:"outline",children:n.jsx("div",{className:"-mt-1.5",children:"Lv. 1"})}),n.jsx("div",{className:"flex-1 z-10",children:n.jsxs(gn,{className:"gap-0",children:[n.jsx(vn,{className:"text-xl title pl-2",style:{textShadow:t?void 0:"1px 1px 1px black"},children:m.name}),n.jsx(_r,{showHealthNumbers:!0,health:y,maxHealth:v,className:"-mt-0.5 h-6",children:g<=0&&m.state.alive&&n.jsx("span",{className:"text-destructive-foreground uppercase",children:"Death's Door"})}),n.jsx("span",{className:"text-xs h-4",children:"resource bars here"})]})})]})]})}function gl({actorID:e,active:t,index:r,targeted:o,...s}){const a=C(g=>g.state),{hoverActorID:i,setActiveRefs:l}=z(g=>({hoverActorID:g.hoverActorID,setActiveRefs:g.setActiveRefs})),c=u.useRef(null);o=o||i===e;const d=W(a,e),[p,f]=ft(d),h=d.state.alive?p:0,[x,m]=u.useState(0);return u.useLayoutEffect(()=>{c.current!==null&&l(d.playerID,r,c)},[d.playerID,r,c]),n.jsxs(O.div,{ref:c,initial:{y:"-100%",opacity:0},animate:{y:"0%",opacity:1},exit:{y:"-100%",opacity:0},className:"group flex flex-col w-48 h-14 absolute top-0","data-state":x>0?"open":"closed",...s,children:[n.jsx(Tr,{variant:o?"targeted":t?"enemy-active":"enemy",className:"h-14 py-1 px-2 pointer-events-none border border-stone-950 rounded-xs",children:n.jsxs(gn,{className:"gap-0",children:[n.jsx(vn,{className:"text-base title",style:{textShadow:t?"-1px 1px 1px rgba(255,255,255,0.8)":"1px 1px 1px black"},children:d.name}),n.jsx(_r,{showHealthNumbers:!1,health:h,maxHealth:f})]})}),n.jsx("div",{className:"flex transition-all justify-between h-6 -translate-y-2 group-hover:translate-y-1 group-data-[state=open]:translate-y-1 z-10",children:n.jsx("div",{className:"flex -space-x-3 group-hover:space-x-1 group-data-[state=open]:space-x-1 transition-all flex-wrap",children:n.jsx(ce,{children:Object.entries(d.applied).map(([g,v])=>n.jsx(O.div,{layout:!0,initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},children:n.jsx(Pr,{effectID:g,count:v,onOpenChange:y=>{m(D=>D+(y?1:-1))}})},g))})})})]})}function vl({encounter:e,current:t}){const r=C(c=>c.state),o=r.actors.filter(c=>c.playerID===e?.ID),s=o.filter(c=>c.state.alive),a=C(c=>c.state.combat?.phase),i=a==="planning",l=!!a&&a!=="pre"&&a!=="post";return n.jsxs("div",{className:"w-full flex flex-row justify-end items-start h-20 max-w-[1440px] px-4 gap-2",children:[!!a&&n.jsxs("div",{className:"flex flex-col gap-0 items-end mt-3",children:[n.jsx("div",{className:"grid grid-cols-3 gap-1 text-stone-300/40",children:o.map(c=>c.state.alive?n.jsx(bn,{},c.ID):n.jsx(yn,{},c.ID))}),s.length>0&&n.jsxs("div",{className:"text-lg text-muted-foreground/50 title",children:[s.length," enemies left"]})]}),e?.activeActorIDs.map((c,d)=>n.jsxs("div",{className:"relative h-20 w-48",children:[n.jsx("div",{className:b("rounded bg-background opacity-40 z-0 transition-all","h-14 w-full mb-6 flex items-center justify-center border border-foreground/10 border-dashed text-stone-300/30",{"opacity-0":!!c})}),n.jsx(ce,{children:c&&n.jsx(gl,{actorID:c,active:l&&!i&&r.promptQueue.length===0&&t?.context.sourceID===c,index:d,targeted:An(r,t?.context,c,jn(e.ID,d))},c)})]},d))]})}function bl({player:e,current:t}){const r=C(c=>c.state),{activeContext:o,set:s}=z(c=>c),a=r.combat?.phase,i=a==="planning",l=!!a&&a!=="pre"&&a!=="post";return n.jsx("div",{className:"flex items-end justify-end gap-8 overflow-y-clip pb-2",children:e.activeActorIDs.map((c,d)=>n.jsxs("div",{className:"relative w-64 h-32 flex flex-col justify-end",children:[n.jsx("div",{className:b("rounded-xs h-19 mt-8 w-64 transition-all"," bg-background/60 border border-background/80",{"opacity-0":!!c})}),n.jsx(ce,{children:c&&n.jsx(xl,{actorID:c,index:d,status:i?"select action":"...",active:l&&(i&&o.sourceID===c||!i&&t?.context.sourceID===c),targeted:An(r,t?.context,c,jn(e.ID,d)),disabled:!i||!!r.actionQueue.find(p=>p.context.sourceID===c),onClick:p=>{s({activeActionID:vs(p,r)?.ID,activeContext:ve({playerID:p.playerID,sourceID:p.ID})})}},c)})]},d))})}function yl({className:e,...t}){const r=C(s=>s.state.combatLog),o=u.useRef(null);return u.useEffect(()=>{o.current&&o.current.scrollIntoView({behavior:"smooth"})},[r.length]),n.jsx(wt,{className:b("h-100 text-sm",e),...t,children:n.jsxs("ul",{className:"text-muted-foreground",children:[r.map((s,a)=>n.jsx("li",{style:{opacity:s.depth>0?.7:1,paddingLeft:s.depth*16},children:s.text},a)),n.jsx("div",{ref:o})]})})}var Qe="Tabs",[jl]=ge(Qe,[We]),kr=We(),[wl,Et]=jl(Qe),Or=u.forwardRef((e,t)=>{const{__scopeTabs:r,value:o,onValueChange:s,defaultValue:a,orientation:i="horizontal",dir:l,activationMode:c="automatic",...d}=e,p=$e(l),[f,h]=Ge({prop:o,onChange:s,defaultProp:a??"",caller:Qe});return n.jsx(wl,{scope:r,baseId:le(),value:f,onValueChange:h,orientation:i,dir:p,activationMode:c,children:n.jsx(T.div,{dir:p,"data-orientation":i,...d,ref:t})})});Or.displayName=Qe;var Lr="TabsList",Fr=u.forwardRef((e,t)=>{const{__scopeTabs:r,loop:o=!0,...s}=e,a=Et(Lr,r),i=kr(r);return n.jsx(Qn,{asChild:!0,...i,orientation:a.orientation,dir:a.dir,loop:o,children:n.jsx(T.div,{role:"tablist","aria-orientation":a.orientation,...s,ref:t})})});Fr.displayName=Lr;var $r="TabsTrigger",zr=u.forwardRef((e,t)=>{const{__scopeTabs:r,value:o,disabled:s=!1,...a}=e,i=Et($r,r),l=kr(r),c=Br(i.baseId,o),d=Hr(i.baseId,o),p=o===i.value;return n.jsx(Zn,{asChild:!0,...l,focusable:!s,active:p,children:n.jsx(T.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":d,"data-state":p?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:c,...a,ref:t,onMouseDown:j(e.onMouseDown,f=>{!s&&f.button===0&&f.ctrlKey===!1?i.onValueChange(o):f.preventDefault()}),onKeyDown:j(e.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&i.onValueChange(o)}),onFocus:j(e.onFocus,()=>{const f=i.activationMode!=="manual";!p&&!s&&f&&i.onValueChange(o)})})})});zr.displayName=$r;var Gr="TabsContent",Vr=u.forwardRef((e,t)=>{const{__scopeTabs:r,value:o,forceMount:s,children:a,...i}=e,l=Et(Gr,r),c=Br(l.baseId,o),d=Hr(l.baseId,o),p=o===l.value,f=u.useRef(p);return u.useEffect(()=>{const h=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(h)},[]),n.jsx(V,{present:s||p,children:({present:h})=>n.jsx(T.div,{"data-state":p?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":c,hidden:!h,id:d,tabIndex:0,...i,ref:t,style:{...e.style,animationDuration:f.current?"0s":void 0},children:h&&a})})});Vr.displayName=Gr;function Br(e,t){return`${e}-trigger-${t}`}function Hr(e,t){return`${e}-content-${t}`}var Dl=Or,Il=Fr,Cl=zr,Sl=Vr;function Nl({className:e,...t}){return n.jsx(Dl,{"data-slot":"tabs",className:b("flex flex-col gap-2",e),...t})}function Al({className:e,...t}){return n.jsx(Il,{"data-slot":"tabs-list",className:b("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",e),...t})}function Wt({className:e,...t}){return n.jsx(Cl,{"data-slot":"tabs-trigger",className:b("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-foreground/20 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...t})}function Yt({className:e,...t}){return n.jsx(Sl,{"data-slot":"tabs-content",className:b("flex-1 outline-none",e),...t})}function Ml(e){return wn({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 10C14.2091 10 16 8.20914 16 6 16 3.79086 14.2091 2 12 2 9.79086 2 8 3.79086 8 6 8 8.20914 9.79086 10 12 10ZM5.5 13C6.88071 13 8 11.8807 8 10.5 8 9.11929 6.88071 8 5.5 8 4.11929 8 3 9.11929 3 10.5 3 11.8807 4.11929 13 5.5 13ZM21 10.5C21 11.8807 19.8807 13 18.5 13 17.1193 13 16 11.8807 16 10.5 16 9.11929 17.1193 8 18.5 8 19.8807 8 21 9.11929 21 10.5ZM12 11C14.7614 11 17 13.2386 17 16V22H7V16C7 13.2386 9.23858 11 12 11ZM5 15.9999C5 15.307 5.10067 14.6376 5.28818 14.0056L5.11864 14.0204C3.36503 14.2104 2 15.6958 2 17.4999V21.9999H5V15.9999ZM22 21.9999V17.4999C22 15.6378 20.5459 14.1153 18.7118 14.0056 18.8993 14.6376 19 15.307 19 15.9999V21.9999H22Z"},child:[]}]})(e)}function Rl(e){return wn({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 0a2 2 0 0 0-2 2H3.5a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h4v.5a.5.5 0 0 0 1 0V7h4a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H10a2 2 0 0 0-2-2m1 2a1 1 0 0 0-2 0zm-4 9v2h6v-2h-1v.5a.5.5 0 0 1-1 0V11z"},child:[]},{tag:"path",attr:{d:"M14 7.599A3 3 0 0 1 12.5 8H9.415a1.5 1.5 0 0 1-2.83 0H3.5A3 3 0 0 1 2 7.599V14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM4 10.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5z"},child:[]}]})(e)}var Ze="Dialog",[Ur]=ge(Ze),[El,Y]=Ur(Ze),dt=e=>{const{__scopeDialog:t,children:r,open:o,defaultOpen:s,onOpenChange:a,modal:i=!0}=e,l=u.useRef(null),c=u.useRef(null),[d,p]=Ge({prop:o,defaultProp:s??!1,onChange:a,caller:Ze});return n.jsx(El,{scope:t,triggerRef:l,contentRef:c,contentId:le(),titleId:le(),descriptionId:le(),open:d,onOpenChange:p,onOpenToggle:u.useCallback(()=>p(f=>!f),[p]),modal:i,children:r})};dt.displayName=Ze;var Kr="DialogTrigger",Wr=u.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,s=Y(Kr,r),a=F(t,s.triggerRef);return n.jsx(T.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Tt(s.open),...o,ref:a,onClick:j(e.onClick,s.onOpenToggle)})});Wr.displayName=Kr;var _t="DialogPortal",[_l,Yr]=Ur(_t,{forceMount:void 0}),Xr=e=>{const{__scopeDialog:t,forceMount:r,children:o,container:s}=e,a=Y(_t,t);return n.jsx(_l,{scope:t,forceMount:r,children:u.Children.map(o,i=>n.jsx(V,{present:r||a.open,children:n.jsx(ln,{asChild:!0,container:s,children:i})}))})};Xr.displayName=_t;var Le="DialogOverlay",qr=u.forwardRef((e,t)=>{const r=Yr(Le,e.__scopeDialog),{forceMount:o=r.forceMount,...s}=e,a=Y(Le,e.__scopeDialog);return a.modal?n.jsx(V,{present:o||a.open,children:n.jsx(Tl,{...s,ref:t})}):null});qr.displayName=Le;var Pl=pn("DialogOverlay.RemoveScroll"),Tl=u.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,s=Y(Le,r);return n.jsx(fn,{as:Pl,allowPinchZoom:!0,shards:[s.contentRef],children:n.jsx(T.div,{"data-state":Tt(s.open),...o,ref:t,style:{pointerEvents:"auto",...o.style}})})}),ue="DialogContent",Qr=u.forwardRef((e,t)=>{const r=Yr(ue,e.__scopeDialog),{forceMount:o=r.forceMount,...s}=e,a=Y(ue,e.__scopeDialog);return n.jsx(V,{present:o||a.open,children:a.modal?n.jsx(kl,{...s,ref:t}):n.jsx(Ol,{...s,ref:t})})});Qr.displayName=ue;var kl=u.forwardRef((e,t)=>{const r=Y(ue,e.__scopeDialog),o=u.useRef(null),s=F(t,r.contentRef,o);return u.useEffect(()=>{const a=o.current;if(a)return un(a)},[]),n.jsx(Zr,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:j(e.onCloseAutoFocus,a=>{a.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:j(e.onPointerDownOutside,a=>{const i=a.detail.originalEvent,l=i.button===0&&i.ctrlKey===!0;(i.button===2||l)&&a.preventDefault()}),onFocusOutside:j(e.onFocusOutside,a=>a.preventDefault())})}),Ol=u.forwardRef((e,t)=>{const r=Y(ue,e.__scopeDialog),o=u.useRef(!1),s=u.useRef(!1);return n.jsx(Zr,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{e.onCloseAutoFocus?.(a),a.defaultPrevented||(o.current||r.triggerRef.current?.focus(),a.preventDefault()),o.current=!1,s.current=!1},onInteractOutside:a=>{e.onInteractOutside?.(a),a.defaultPrevented||(o.current=!0,a.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=a.target;r.triggerRef.current?.contains(i)&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&s.current&&a.preventDefault()}})}),Zr=u.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:o,onOpenAutoFocus:s,onCloseAutoFocus:a,...i}=e,l=Y(ue,r),c=u.useRef(null),d=F(t,c);return dn(),n.jsxs(n.Fragment,{children:[n.jsx(hn,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:s,onUnmountAutoFocus:a,children:n.jsx(mn,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":Tt(l.open),...i,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),n.jsxs(n.Fragment,{children:[n.jsx(Fl,{titleId:l.titleId}),n.jsx(zl,{contentRef:c,descriptionId:l.descriptionId})]})]})}),Pt="DialogTitle",Jr=u.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,s=Y(Pt,r);return n.jsx(T.h2,{id:s.titleId,...o,ref:t})});Jr.displayName=Pt;var eo="DialogDescription",Ll=u.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,s=Y(eo,r);return n.jsx(T.p,{id:s.descriptionId,...o,ref:t})});Ll.displayName=eo;var to="DialogClose",no=u.forwardRef((e,t)=>{const{__scopeDialog:r,...o}=e,s=Y(to,r);return n.jsx(T.button,{type:"button",...o,ref:t,onClick:j(e.onClick,()=>s.onOpenChange(!1))})});no.displayName=to;function Tt(e){return e?"open":"closed"}var ro="DialogTitleWarning",[iu,oo]=bs(ro,{contentName:ue,titleName:Pt,docsSlug:"dialog"}),Fl=({titleId:e})=>{const t=oo(ro),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return u.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},$l="DialogDescriptionWarning",zl=({contentRef:e,descriptionId:t})=>{const o=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${oo($l).contentName}}.`;return u.useEffect(()=>{const s=e.current?.getAttribute("aria-describedby");t&&s&&(document.getElementById(t)||console.warn(o))},[o,e,t]),null},Gl=Wr,Vl=Xr,Bl=qr,Hl=Qr,Ul=Jr,Kl=no;function Xt({...e}){return n.jsx(Gl,{"data-slot":"dialog-trigger",...e})}function Wl({...e}){return n.jsx(Vl,{"data-slot":"dialog-portal",...e})}function Yl({className:e,...t}){return n.jsx(Bl,{"data-slot":"dialog-overlay",className:b("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...t})}function so({className:e,children:t,showCloseButton:r=!0,...o}){return n.jsxs(Wl,{"data-slot":"dialog-portal",children:[n.jsx(Yl,{}),n.jsxs(Hl,{"data-slot":"dialog-content",className:b("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-xs border p-6 shadow-lg duration-200 sm:max-w-lg","ring ring-black",e),...o,children:[t,r&&n.jsxs(Kl,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[n.jsx(Hs,{}),n.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function ao({className:e,...t}){return n.jsx("div",{"data-slot":"dialog-header",className:b("flex flex-col gap-2 text-center sm:text-left",e),...t})}function io({className:e,...t}){return n.jsx(Ul,{"data-slot":"dialog-title",className:b("text-2xl leading-none font-semibold title",e),...t})}function Xl({actor:e}){return n.jsx(so,{children:n.jsx(ao,{children:n.jsx(io,{children:e.name})})})}function ql({onOpenChange:e}){const t=C(i=>i.state),r=C(i=>i.resolveActionItem),o=H(),s=t.players.find(i=>i.ID===o),a=ve({playerID:o});return s?n.jsxs(so,{className:"w-180 !max-w-180",children:[n.jsx(ao,{children:n.jsx(io,{children:"Items"})}),n.jsx(Er,{items:s.items,actionHeader:n.jsx(n.Fragment,{children:"Equip/Use"}),actions:i=>n.jsxs(n.Fragment,{children:[i.use&&n.jsx(lt,{children:"Use"}),i.consumable&&!t.combat&&n.jsx(ut,{disabled:!1,placeholder:"Use",options:i.consumable.targets.get(t,a).map(l=>l.target),value:void 0,onValueChange:l=>{e?.(!1),r(i.consumable,{...a,sourceID:l??"",targetIDs:[l]})}}),i.actions&&n.jsx(lt,{children:"Equip"})]})})]}):null}const Ql=[ws,Ds,Is];function Zl({player:e,current:t}){const{state:r}=C(c=>c),{activePlayerTab:o,set:s}=z(c=>c),a=r.actors.filter(c=>c.playerID===e.ID),[i,l]=u.useState(!1);return n.jsxs("div",{className:"flex justify-start gap-6 mb-3 w-full max-w-[1440px]",children:[n.jsxs("div",{children:[n.jsx(bl,{player:e,current:t}),n.jsxs("div",{className:"flex items-center justify-center text-center title text-lg h-5 leading-5 text-muted-foreground gap-6 px-3 mt-1",children:[n.jsx(me,{className:"flex-1"}),"Active Party",n.jsx(me,{className:"flex-1"})]})]}),n.jsxs(Nl,{orientation:"vertical",className:"flex-row items-center rounded-xs gap-1",value:o,onValueChange:c=>s({activePlayerTab:c}),children:[n.jsxs(Al,{className:"flex flex-col items-center justify-around bg-transparent h-full gap-2 z-10",children:[n.jsx(Wt,{value:"combat-log",className:"bg-muted rounded-sm ring border !border-foreground/10 ring-black hover:bg-ring dark:data-[state=active]:bg-ring",children:n.jsx(ys,{})}),n.jsx(Wt,{value:"party",className:"bg-muted rounded-sm ring border !border-foreground/10 ring-black hover:bg-ring dark:data-[state=active]:bg-ring",children:n.jsx(Ml,{})}),n.jsx("div",{className:"flex-1"}),n.jsxs(dt,{open:i,onOpenChange:l,children:[n.jsx(Xt,{className:"px-2 py-1.5 bg-muted text-muted-foreground rounded-sm ring border !border-foreground/10 ring-black hover:bg-ring/50",children:n.jsx(Rl,{})}),n.jsx(ql,{open:i,onOpenChange:l})]})]}),n.jsxs("div",{className:"relative h-32 w-62 xl:w-80",children:[n.jsx(Yt,{value:"combat-log",className:"h-full",children:n.jsx(yl,{className:"h-full w-full rounded-xs p-2 bg-black/90 border ring ring-black text-xs"})}),n.jsx(Yt,{value:"party",className:"h-full",children:n.jsxs("div",{className:"grid grid-cols-2 grid-rows-3 h-full gap-1",children:[a.map(c=>{const d=js(r,c.ID),p=ht(r,c.ID),f=Ql[p?.index??-1]??bn;return n.jsxs(dt,{children:[n.jsx(Xt,{asChild:!0,children:n.jsxs(B,{className:b("!rounded-sm justify-baseline","opacity-100 hover:opacity-90 h-full"),variant:c.state.alive?"slate":"destructive",children:[d?n.jsx(f,{}):c.state.alive?n.jsx(Cs,{}):n.jsx(yn,{}),n.jsxs("div",{className:"text-left",children:[n.jsx("div",{className:"-mb-1 font-semibold",children:c.name}),n.jsx("div",{className:"-mt-1 text-foreground/40 text-xs",children:c.class?.name??"N/A"})]})]})}),n.jsx(Xl,{actor:c})]},c.ID)}),Array.from({length:6-a.length}).map((c,d)=>n.jsx("div",{className:"h-full w-full bg-black/20"},d))]})})]})]})]})}const Jl=["pre","start","planning","main","end","post"];function eu(){const e=C(o=>o.state),t=C(o=>o.nextPhase),r=Ss();return n.jsxs(n.Fragment,{children:[n.jsxs(ee,{variant:"secondary",children:["Turn ",e.combat?.turn]}),n.jsx(me,{orientation:"vertical"}),Jl.filter(o=>o!=="pre"&&o!=="post").map(o=>n.jsx(ee,{variant:o===r?"secondary":"outline",className:b({"text-muted-foreground":o!==r}),children:o},o)),r==="planning"&&n.jsxs(n.Fragment,{children:[n.jsx(me,{orientation:"vertical"}),n.jsx(ee,{children:e.actionQueue.length})]}),n.jsx(me,{orientation:"vertical"}),n.jsx(ee,{onClick:()=>t(),children:n.jsx(Ns,{})})]})}function tu({className:e,...t}){return n.jsx($s,{role:"status","aria-label":"Loading",className:b("size-4 animate-spin",e),...t})}function nu(){const e=C(t=>t.state);return n.jsxs("div",{className:"flex items-center justify-start gap-2 p-1 px-3 w-full",children:[n.jsxs(ee,{variant:"outline",children:["Effects: ",e.effects.length]}),n.jsx(ee,{variant:e.combat?"outline":"secondary",className:b({"text-muted-foreground":e.combat}),children:"Dialog"}),n.jsx(ee,{variant:e.combat?"secondary":"outline",className:b({"text-muted-foreground":!e.combat}),children:"Combat"}),e.combat&&n.jsxs(n.Fragment,{children:[n.jsx(me,{orientation:"vertical"}),n.jsx(eu,{})]}),As(e)==="running"&&n.jsx(tu,{}),n.jsx("div",{className:"flex-1"}),n.jsx(ee,{variant:"outline",asChild:!0,children:n.jsx(lo,{to:"/crew",children:"edit party"})})]})}function cu(){const e=C(i=>i.state.players),t=C(i=>i.state.combat),r=Ms(),o=H(),s=e.find(i=>i.ID===o),a=e.find(i=>i.ID!==o);return n.jsxs("div",{className:"h-screen w-screen flex flex-col items-center overflow-hidden relative",style:{background:"radial-gradient(ellipse at center, transparent 75%, rgba(0, 0, 0, 1) 100%)"},children:[n.jsx(Ia,{player:s}),r&&t?.phase==="main"&&n.jsx(Hn,{current:r}),n.jsx(hi,{}),n.jsx(nu,{}),n.jsxs("div",{className:"flex-1 flex flex-col justify-between relative z-10",children:[n.jsx(vl,{encounter:a,current:r}),t&&n.jsx(di,{current:r}),!t&&n.jsx(ul,{}),n.jsx(Zl,{player:s,current:r})]})]})}export{cu as component};
