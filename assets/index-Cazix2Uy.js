import{r as u,j as t,u as Ur,R as Rt,L as Kr}from"./index-1BOsunnY.js";import{c as Q,M as Wr,G as Yr,H as Ft,J as Xr,K as qr,L as Qr,N as Zr,j as P,u as Ae,g as le,P as M,O as G,k as b,m as K,l as Jr,t as eo,a as g,w as y,Q as st,T as Me,U as $t,W as to,X as zt,Y as F,B,Z as at,_ as qe,$ as it,a0 as ue,a1 as Gt,a2 as Qe,a3 as no,E as ct,a4 as Bt,x as Ht,v as H,a5 as L,a6 as Y,a7 as ro,a8 as oo,a9 as so,aa as Ze,ab as ao,V as Vt,ac as Ut,ad as io,ae as Je,af as co,i as Kt,h as J,f as Ee,e as Wt,R as lo,A as uo,ag as Yt,n as Xt,ah as fo,o as qt,p as Qt,q as Zt,F as Jt,D as en,r as po,s as xo,ai as tn,C as ho,aj as Pe,ak as pe,b as mo,I as go,al as vo,am as bo,an as yo,ao as jo,ap as wo,aq as Io,ar as _t,as as Do,at as Co,z as No,y as So,au as Ro,av as _o,aw as Ao,ax as Mo,ay as Eo,az as nn,aA as rn,aB as on,aC as Po,aD as sn,aE as an,aF as cn,aG as To,aH as ln,aI as ko,S as ie,aJ as Oo,aK as Lo,aL as Fo,aM as $o,aN as zo,aO as Go,aP as Bo,aQ as Ho,aR as Vo,aS as Uo}from"./useGameState-wcpIMSi5.js";import"./clsx-B-dksMZM.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Wo=Q("arrow-up",Ko);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yo=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Xo=Q("check",Yo);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qo=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Qo=Q("circle",qo);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zo=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Jo=Q("ellipsis",Zo);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ts=Q("loader-circle",es);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],lt=Q("target",ns);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]],os=Q("undo-2",rs);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],as=Q("x",ss);function At(e,n){if(typeof e=="function")return e(n);e!=null&&(e.current=n)}function is(...e){return n=>{let r=!1;const o=e.map(s=>{const a=At(s,n);return!r&&typeof a=="function"&&(r=!0),a});if(r)return()=>{for(let s=0;s<o.length;s++){const a=o[s];typeof a=="function"?a():At(e[s],null)}}}}function cs(...e){return u.useCallback(is(...e),e)}class ls extends u.Component{getSnapshotBeforeUpdate(n){const r=this.props.childRef.current;if(r&&n.isPresent&&!this.props.isPresent){const o=r.offsetParent,s=Yr(o)&&o.offsetWidth||0,a=this.props.sizeRef.current;a.height=r.offsetHeight||0,a.width=r.offsetWidth||0,a.top=r.offsetTop,a.left=r.offsetLeft,a.right=s-a.width-a.left}return null}componentDidUpdate(){}render(){return this.props.children}}function us({children:e,isPresent:n,anchorX:r,root:o}){const s=u.useId(),a=u.useRef(null),i=u.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:l}=u.useContext(Wr),c=cs(a,e?.ref);return u.useInsertionEffect(()=>{const{width:d,height:p,top:f,left:x,right:h}=i.current;if(n||!a.current||!d||!p)return;const m=r==="left"?`left: ${x}`:`right: ${h}`;a.current.dataset.motionPopId=s;const v=document.createElement("style");l&&(v.nonce=l);const j=o??document.head;return j.appendChild(v),v.sheet&&v.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${p}px !important;
            ${m}px !important;
            top: ${f}px !important;
          }
        `),()=>{j.contains(v)&&j.removeChild(v)}},[n]),t.jsx(ls,{isPresent:n,childRef:a,sizeRef:i,children:u.cloneElement(e,{ref:c})})}const ds=({children:e,initial:n,isPresent:r,onExitComplete:o,custom:s,presenceAffectsLayout:a,mode:i,anchorX:l,root:c})=>{const d=Ft(fs),p=u.useId();let f=!0,x=u.useMemo(()=>(f=!1,{id:p,initial:n,isPresent:r,custom:s,onExitComplete:h=>{d.set(h,!0);for(const m of d.values())if(!m)return;o&&o()},register:h=>(d.set(h,!1),()=>d.delete(h))}),[r,d,o]);return a&&f&&(x={...x}),u.useMemo(()=>{d.forEach((h,m)=>d.set(m,!1))},[r]),u.useEffect(()=>{!r&&!d.size&&o&&o()},[r]),i==="popLayout"&&(e=t.jsx(us,{isPresent:r,anchorX:l,root:c,children:e})),t.jsx(Xr.Provider,{value:x,children:e})};function fs(){return new Map}const we=e=>e.key||"";function Mt(e){const n=[];return u.Children.forEach(e,r=>{u.isValidElement(r)&&n.push(r)}),n}const te=({children:e,custom:n,initial:r=!0,onExitComplete:o,presenceAffectsLayout:s=!0,mode:a="sync",propagate:i=!1,anchorX:l="left",root:c})=>{const[d,p]=qr(i),f=u.useMemo(()=>Mt(e),[e]),x=i&&!d?[]:f.map(we),h=u.useRef(!0),m=u.useRef(f),v=Ft(()=>new Map),[j,I]=u.useState(f),[D,C]=u.useState(f);Qr(()=>{h.current=!1,m.current=f;for(let E=0;E<D.length;E++){const S=we(D[E]);x.includes(S)?v.delete(S):v.get(S)!==!0&&v.set(S,!1)}},[D,x.length,x.join("-")]);const _=[];if(f!==j){let E=[...f];for(let S=0;S<D.length;S++){const R=D[S],N=we(R);x.includes(N)||(E.splice(S,0,R),_.push(R))}return a==="wait"&&_.length&&(E=_),C(Mt(E)),I(f),null}const{forceRender:k}=u.useContext(Zr);return t.jsx(t.Fragment,{children:D.map(E=>{const S=we(E),R=i&&!d?!1:f===D||x.includes(S),N=()=>{if(v.has(S))v.set(S,!0);else return;let A=!0;v.forEach(O=>{O||(A=!1)}),A&&(k?.(),C(m.current),i&&p?.(),o&&o())};return t.jsx(ds,{isPresent:R,initial:!h.current||r?void 0:!1,custom:n,presenceAffectsLayout:s,mode:a,root:c,onExitComplete:R?void 0:N,anchorX:l,children:E},S)})})};function un(e,n,r,o){const a=e.combat?.phase==="planning",i=!a&&!!n?.targetIDs.includes(r??void 0),l=!a&&!!n?.positions.find(c=>c.playerID===o.playerID&&c.index===o.index);return i||l}function ps(e,n){return u.useReducer((r,o)=>n[r][o]??r,e)}var ut="ScrollArea",[dn]=le(ut),[xs,V]=dn(ut),fn=u.forwardRef((e,n)=>{const{__scopeScrollArea:r,type:o="hover",dir:s,scrollHideDelay:a=600,...i}=e,[l,c]=u.useState(null),[d,p]=u.useState(null),[f,x]=u.useState(null),[h,m]=u.useState(null),[v,j]=u.useState(null),[I,D]=u.useState(0),[C,_]=u.useState(0),[k,E]=u.useState(!1),[S,R]=u.useState(!1),N=P(n,O=>c(O)),A=Ae(s);return t.jsx(xs,{scope:r,type:o,dir:A,scrollHideDelay:a,scrollArea:l,viewport:d,onViewportChange:p,content:f,onContentChange:x,scrollbarX:h,onScrollbarXChange:m,scrollbarXEnabled:k,onScrollbarXEnabledChange:E,scrollbarY:v,onScrollbarYChange:j,scrollbarYEnabled:S,onScrollbarYEnabledChange:R,onCornerWidthChange:D,onCornerHeightChange:_,children:t.jsx(M.div,{dir:A,...i,ref:N,style:{position:"relative","--radix-scroll-area-corner-width":I+"px","--radix-scroll-area-corner-height":C+"px",...e.style}})})});fn.displayName=ut;var pn="ScrollAreaViewport",xn=u.forwardRef((e,n)=>{const{__scopeScrollArea:r,children:o,nonce:s,...a}=e,i=V(pn,r),l=u.useRef(null),c=P(n,l,i.onViewportChange);return t.jsxs(t.Fragment,{children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:s}),t.jsx(M.div,{"data-radix-scroll-area-viewport":"",...a,ref:c,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...e.style},children:t.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:o})})]})});xn.displayName=pn;var X="ScrollAreaScrollbar",hn=u.forwardRef((e,n)=>{const{forceMount:r,...o}=e,s=V(X,e.__scopeScrollArea),{onScrollbarXEnabledChange:a,onScrollbarYEnabledChange:i}=s,l=e.orientation==="horizontal";return u.useEffect(()=>(l?a(!0):i(!0),()=>{l?a(!1):i(!1)}),[l,a,i]),s.type==="hover"?t.jsx(hs,{...o,ref:n,forceMount:r}):s.type==="scroll"?t.jsx(ms,{...o,ref:n,forceMount:r}):s.type==="auto"?t.jsx(mn,{...o,ref:n,forceMount:r}):s.type==="always"?t.jsx(dt,{...o,ref:n}):null});hn.displayName=X;var hs=u.forwardRef((e,n)=>{const{forceMount:r,...o}=e,s=V(X,e.__scopeScrollArea),[a,i]=u.useState(!1);return u.useEffect(()=>{const l=s.scrollArea;let c=0;if(l){const d=()=>{window.clearTimeout(c),i(!0)},p=()=>{c=window.setTimeout(()=>i(!1),s.scrollHideDelay)};return l.addEventListener("pointerenter",d),l.addEventListener("pointerleave",p),()=>{window.clearTimeout(c),l.removeEventListener("pointerenter",d),l.removeEventListener("pointerleave",p)}}},[s.scrollArea,s.scrollHideDelay]),t.jsx(G,{present:r||a,children:t.jsx(mn,{"data-state":a?"visible":"hidden",...o,ref:n})})}),ms=u.forwardRef((e,n)=>{const{forceMount:r,...o}=e,s=V(X,e.__scopeScrollArea),a=e.orientation==="horizontal",i=ke(()=>c("SCROLL_END"),100),[l,c]=ps("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return u.useEffect(()=>{if(l==="idle"){const d=window.setTimeout(()=>c("HIDE"),s.scrollHideDelay);return()=>window.clearTimeout(d)}},[l,s.scrollHideDelay,c]),u.useEffect(()=>{const d=s.viewport,p=a?"scrollLeft":"scrollTop";if(d){let f=d[p];const x=()=>{const h=d[p];f!==h&&(c("SCROLL"),i()),f=h};return d.addEventListener("scroll",x),()=>d.removeEventListener("scroll",x)}},[s.viewport,a,c,i]),t.jsx(G,{present:r||l!=="hidden",children:t.jsx(dt,{"data-state":l==="hidden"?"hidden":"visible",...o,ref:n,onPointerEnter:b(e.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:b(e.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),mn=u.forwardRef((e,n)=>{const r=V(X,e.__scopeScrollArea),{forceMount:o,...s}=e,[a,i]=u.useState(!1),l=e.orientation==="horizontal",c=ke(()=>{if(r.viewport){const d=r.viewport.offsetWidth<r.viewport.scrollWidth,p=r.viewport.offsetHeight<r.viewport.scrollHeight;i(l?d:p)}},10);return ce(r.viewport,c),ce(r.content,c),t.jsx(G,{present:o||a,children:t.jsx(dt,{"data-state":a?"visible":"hidden",...s,ref:n})})}),dt=u.forwardRef((e,n)=>{const{orientation:r="vertical",...o}=e,s=V(X,e.__scopeScrollArea),a=u.useRef(null),i=u.useRef(0),[l,c]=u.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=jn(l.viewport,l.content),p={...o,sizes:l,onSizesChange:c,hasThumb:d>0&&d<1,onThumbChange:x=>a.current=x,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:x=>i.current=x};function f(x,h){return ws(x,i.current,l,h)}return r==="horizontal"?t.jsx(gs,{...p,ref:n,onThumbPositionChange:()=>{if(s.viewport&&a.current){const x=s.viewport.scrollLeft,h=Et(x,l,s.dir);a.current.style.transform=`translate3d(${h}px, 0, 0)`}},onWheelScroll:x=>{s.viewport&&(s.viewport.scrollLeft=x)},onDragScroll:x=>{s.viewport&&(s.viewport.scrollLeft=f(x,s.dir))}}):r==="vertical"?t.jsx(vs,{...p,ref:n,onThumbPositionChange:()=>{if(s.viewport&&a.current){const x=s.viewport.scrollTop,h=Et(x,l);a.current.style.transform=`translate3d(0, ${h}px, 0)`}},onWheelScroll:x=>{s.viewport&&(s.viewport.scrollTop=x)},onDragScroll:x=>{s.viewport&&(s.viewport.scrollTop=f(x))}}):null}),gs=u.forwardRef((e,n)=>{const{sizes:r,onSizesChange:o,...s}=e,a=V(X,e.__scopeScrollArea),[i,l]=u.useState(),c=u.useRef(null),d=P(n,c,a.onScrollbarXChange);return u.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),t.jsx(vn,{"data-orientation":"horizontal",...s,ref:d,sizes:r,style:{bottom:0,left:a.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:a.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Te(r)+"px",...e.style},onThumbPointerDown:p=>e.onThumbPointerDown(p.x),onDragScroll:p=>e.onDragScroll(p.x),onWheelScroll:(p,f)=>{if(a.viewport){const x=a.viewport.scrollLeft+p.deltaX;e.onWheelScroll(x),In(x,f)&&p.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&o({content:a.viewport.scrollWidth,viewport:a.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:Ne(i.paddingLeft),paddingEnd:Ne(i.paddingRight)}})}})}),vs=u.forwardRef((e,n)=>{const{sizes:r,onSizesChange:o,...s}=e,a=V(X,e.__scopeScrollArea),[i,l]=u.useState(),c=u.useRef(null),d=P(n,c,a.onScrollbarYChange);return u.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),t.jsx(vn,{"data-orientation":"vertical",...s,ref:d,sizes:r,style:{top:0,right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Te(r)+"px",...e.style},onThumbPointerDown:p=>e.onThumbPointerDown(p.y),onDragScroll:p=>e.onDragScroll(p.y),onWheelScroll:(p,f)=>{if(a.viewport){const x=a.viewport.scrollTop+p.deltaY;e.onWheelScroll(x),In(x,f)&&p.preventDefault()}},onResize:()=>{c.current&&a.viewport&&i&&o({content:a.viewport.scrollHeight,viewport:a.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:Ne(i.paddingTop),paddingEnd:Ne(i.paddingBottom)}})}})}),[bs,gn]=dn(X),vn=u.forwardRef((e,n)=>{const{__scopeScrollArea:r,sizes:o,hasThumb:s,onThumbChange:a,onThumbPointerUp:i,onThumbPointerDown:l,onThumbPositionChange:c,onDragScroll:d,onWheelScroll:p,onResize:f,...x}=e,h=V(X,r),[m,v]=u.useState(null),j=P(n,N=>v(N)),I=u.useRef(null),D=u.useRef(""),C=h.viewport,_=o.content-o.viewport,k=K(p),E=K(c),S=ke(f,10);function R(N){if(I.current){const A=N.clientX-I.current.left,O=N.clientY-I.current.top;d({x:A,y:O})}}return u.useEffect(()=>{const N=A=>{const O=A.target;m?.contains(O)&&k(A,_)};return document.addEventListener("wheel",N,{passive:!1}),()=>document.removeEventListener("wheel",N,{passive:!1})},[C,m,_,k]),u.useEffect(E,[o,E]),ce(m,S),ce(h.content,S),t.jsx(bs,{scope:r,scrollbar:m,hasThumb:s,onThumbChange:K(a),onThumbPointerUp:K(i),onThumbPositionChange:E,onThumbPointerDown:K(l),children:t.jsx(M.div,{...x,ref:j,style:{position:"absolute",...x.style},onPointerDown:b(e.onPointerDown,N=>{N.button===0&&(N.target.setPointerCapture(N.pointerId),I.current=m.getBoundingClientRect(),D.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",h.viewport&&(h.viewport.style.scrollBehavior="auto"),R(N))}),onPointerMove:b(e.onPointerMove,R),onPointerUp:b(e.onPointerUp,N=>{const A=N.target;A.hasPointerCapture(N.pointerId)&&A.releasePointerCapture(N.pointerId),document.body.style.webkitUserSelect=D.current,h.viewport&&(h.viewport.style.scrollBehavior=""),I.current=null})})})}),Ce="ScrollAreaThumb",bn=u.forwardRef((e,n)=>{const{forceMount:r,...o}=e,s=gn(Ce,e.__scopeScrollArea);return t.jsx(G,{present:r||s.hasThumb,children:t.jsx(ys,{ref:n,...o})})}),ys=u.forwardRef((e,n)=>{const{__scopeScrollArea:r,style:o,...s}=e,a=V(Ce,r),i=gn(Ce,r),{onThumbPositionChange:l}=i,c=P(n,f=>i.onThumbChange(f)),d=u.useRef(void 0),p=ke(()=>{d.current&&(d.current(),d.current=void 0)},100);return u.useEffect(()=>{const f=a.viewport;if(f){const x=()=>{if(p(),!d.current){const h=Is(f,l);d.current=h,l()}};return l(),f.addEventListener("scroll",x),()=>f.removeEventListener("scroll",x)}},[a.viewport,p,l]),t.jsx(M.div,{"data-state":i.hasThumb?"visible":"hidden",...s,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...o},onPointerDownCapture:b(e.onPointerDownCapture,f=>{const h=f.target.getBoundingClientRect(),m=f.clientX-h.left,v=f.clientY-h.top;i.onThumbPointerDown({x:m,y:v})}),onPointerUp:b(e.onPointerUp,i.onThumbPointerUp)})});bn.displayName=Ce;var ft="ScrollAreaCorner",yn=u.forwardRef((e,n)=>{const r=V(ft,e.__scopeScrollArea),o=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&o?t.jsx(js,{...e,ref:n}):null});yn.displayName=ft;var js=u.forwardRef((e,n)=>{const{__scopeScrollArea:r,...o}=e,s=V(ft,r),[a,i]=u.useState(0),[l,c]=u.useState(0),d=!!(a&&l);return ce(s.scrollbarX,()=>{const p=s.scrollbarX?.offsetHeight||0;s.onCornerHeightChange(p),c(p)}),ce(s.scrollbarY,()=>{const p=s.scrollbarY?.offsetWidth||0;s.onCornerWidthChange(p),i(p)}),d?t.jsx(M.div,{...o,ref:n,style:{width:a,height:l,position:"absolute",right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function Ne(e){return e?parseInt(e,10):0}function jn(e,n){const r=e/n;return isNaN(r)?0:r}function Te(e){const n=jn(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=(e.scrollbar.size-r)*n;return Math.max(o,18)}function ws(e,n,r,o="ltr"){const s=Te(r),a=s/2,i=n||a,l=s-i,c=r.scrollbar.paddingStart+i,d=r.scrollbar.size-r.scrollbar.paddingEnd-l,p=r.content-r.viewport,f=o==="ltr"?[0,p]:[p*-1,0];return wn([c,d],f)(e)}function Et(e,n,r="ltr"){const o=Te(n),s=n.scrollbar.paddingStart+n.scrollbar.paddingEnd,a=n.scrollbar.size-s,i=n.content-n.viewport,l=a-o,c=r==="ltr"?[0,i]:[i*-1,0],d=eo(e,c);return wn([0,i],[0,l])(d)}function wn(e,n){return r=>{if(e[0]===e[1]||n[0]===n[1])return n[0];const o=(n[1]-n[0])/(e[1]-e[0]);return n[0]+o*(r-e[0])}}function In(e,n){return e>0&&e<n}var Is=(e,n=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},o=0;return(function s(){const a={left:e.scrollLeft,top:e.scrollTop},i=r.left!==a.left,l=r.top!==a.top;(i||l)&&n(),r=a,o=window.requestAnimationFrame(s)})(),()=>window.cancelAnimationFrame(o)};function ke(e,n){const r=K(e),o=u.useRef(0);return u.useEffect(()=>()=>window.clearTimeout(o.current),[]),u.useCallback(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(r,n)},[r,n])}function ce(e,n){const r=K(n);Jr(()=>{let o=0;if(e){const s=new ResizeObserver(()=>{cancelAnimationFrame(o),o=window.requestAnimationFrame(r)});return s.observe(e),()=>{window.cancelAnimationFrame(o),s.unobserve(e)}}},[e,r])}var Ds=fn,Cs=xn,Ns=yn;function pt({className:e,children:n,...r}){return t.jsxs(Ds,{"data-slot":"scroll-area",className:g("relative",e),...r,children:[t.jsx(Cs,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:n}),t.jsx(Ss,{}),t.jsx(Ns,{})]})}function Ss({className:e,orientation:n="vertical",...r}){return t.jsx(hn,{"data-slot":"scroll-area-scrollbar",orientation:n,className:g("flex touch-none p-px transition-colors select-none",n==="vertical"&&"h-full w-3 border-l border-l-transparent",n==="horizontal"&&"h-3 flex-col border-t border-t-transparent",e),...r,children:t.jsx(bn,{"data-slot":"scroll-area-thumb",className:"bg-foreground/20 relative flex-1 rounded-full"})})}function Rs({action:e,context:n,active:r,onActiveChange:o}){const s=y(c=>c.state),a=st(s,n.sourceID),i=n&&!Me(e,s,n),l=$t[e.ID];return t.jsx(to,{onClick:()=>o(!r),size:"xs",variant:r?"action-active":"action",className:g("cursor-default rounded-sm",{"opacity-50 pointer-events-none !cursor-not-allowed":i}),children:l?t.jsx(zt,{active:r,renderer:l,cooldown:a?.cooldowns[e.ID],showImage:!1}):t.jsx("span",{className:g("text-xl title",{"text-muted-foreground":!r}),children:e.name})})}function We({state:e,action:n,target:r,type:o,allied:s,context:a,onContextChange:i}){const l=n.targets.max(e,a),c=n.targets.validate(e,a),d=Oe(a)===l;return t.jsxs(t.Fragment,{children:[o==="targetID"&&t.jsx(_s,{target:r,disabled:d&&c,context:a,allied:s,onContextChange:p=>i({...a,...p})}),o==="position"&&t.jsx(As,{state:e,target:r,disabled:d&&c,allied:s,context:a,onContextChange:p=>i({...a,...p})})]})}function _s({target:e,context:n,disabled:r,allied:o,onContextChange:s}){const a=n.targetIDs.includes(e.ID),i=F(l=>l.set);return t.jsx(B,{size:"sm",variant:a?o?"slate-active":"stone-active":o?"slate":"stone",disabled:r&&!a,onClick:()=>{s(a?{targetIDs:n.targetIDs.filter(l=>l!==e.ID)}:{targetIDs:[...n.targetIDs,e.ID]})},onMouseEnter:()=>{i({hoverActorID:e.ID})},onMouseLeave:()=>{i({hoverActorID:void 0})},children:e.name})}function As({state:e,target:n,disabled:r,allied:o,context:s,onContextChange:a}){const i=F(d=>d.set),l=at(e,n.ID),c=l!==void 0&&s.positions.some(d=>qe(d,l));return t.jsx(B,{size:"sm",variant:c?o?"slate-active":"stone-active":o?"slate":"stone",disabled:r&&!c,onClick:()=>{l&&(c&&a({positions:s.positions.filter(d=>!qe(d,l))}),c||a({positions:[...s.positions,l]}))},onMouseEnter:()=>{i({hoverActorID:n.ID})},onMouseLeave:()=>{i({hoverActorID:void 0})},children:n.name})}function Ye({state:e,action:n,target:r,type:o,index:s,allied:a,context:i,onContextChange:l,next:c}){const d=n.targets.max(e,i),p=Oe(i)===d;if(o==="targetID")return t.jsx(Ms,{allied:a,target:r,disabled:!0,index:s,context:i,onContextChange:f=>{l({...i,...f}),p||c()}});if(o==="position")return t.jsx(Es,{state:e,allied:a,target:r,disabled:!0,index:s,context:i,onContextChange:f=>{l({...i,...f}),p||c()}})}function Ms({target:e,index:n,disabled:r,allied:o,context:s,onContextChange:a}){const i=F(d=>d.set),c=s.targetIDs[n]===e.ID;return t.jsxs(B,{size:"sm",variant:c?o?"slate-active":"stone-active":o?"slate":"stone",disabled:r&&c,onClick:()=>{if(c)return;const d=[...s.targetIDs];d[n]=e.ID,a({targetIDs:d})},onMouseEnter:()=>{i({hoverActorID:e.ID})},onMouseLeave:()=>{i({hoverActorID:void 0})},children:[c&&t.jsx(lt,{}),e.name]})}function Es({state:e,target:n,disabled:r,allied:o,index:s,context:a,onContextChange:i}){const l=F(f=>f.set),c=at(e,n.ID),d=a.positions[s],p=qe(c,d);return t.jsxs(B,{size:"sm",variant:p?o?"slate-active":"stone-active":o?"slate":"stone",disabled:r&&p,onClick:()=>{if(!c||p)return;const f=[...a.positions];f[s]=c,i({positions:f})},onMouseEnter:()=>{l({hoverActorID:n.ID})},onMouseLeave:()=>{l({hoverActorID:void 0})},children:[p&&t.jsx(lt,{}),n.name]})}const Ps=it("flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-sm has-[>[data-slot=button-group]]:gap-2",{variants:{orientation:{horizontal:"[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none",vertical:"flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none"}},defaultVariants:{orientation:"horizontal"}});function Dn({className:e,orientation:n,...r}){return t.jsx("div",{role:"group","data-slot":"button-group","data-orientation":n,className:g(Ps({orientation:n}),e),...r})}function Ts({state:e,action:n,context:r,index:o,onIndexChange:s}){const a=n.targets.max(e,r),i=Oe(r)===a,l=Array.from({length:a});return t.jsx(Dn,{className:g("rounded-sm ring ring-black border border-ring/50 bg-muted",{"border-ring":i}),children:l.map((c,d)=>t.jsx(B,{className:"rounded-sm",variant:d===o?"default":r.positions[d]?"secondary":"ghost",size:"icon-sm",onClick:()=>s(d),children:r.positions[d]?t.jsx(lt,{}):t.jsx(Qo,{className:"opacity-20"})},d))})}function Oe(e){return e.positions.filter(n=>!!n).length+e.targetIDs.filter(n=>!!n).length}function ks({action:e,context:n,onContextChange:r,state:o}){const s=H(),[a,i]=u.useState(0),l=e.targets.max(o,n),c=e.targets.get(o,n),d=new Set(c.map(f=>f.target.playerID));function p(){i(f=>(f+1)%l)}return u.useEffect(()=>{i(0)},[n.sourceID,e.ID]),t.jsxs(t.Fragment,{children:[t.jsx(Ts,{state:o,action:e,context:n,index:a,onIndexChange:i}),d.size>1&&c.length>4?t.jsx("div",{className:"flex flex-col w-full justify-around gap-2",children:t.jsx("div",{className:"flex flex-col gap-1",children:t.jsxs("div",{className:"flex flex-wrap gap-2 w-full justify-center",children:[c.filter(f=>f.target.playerID!==n.playerID).map(({target:f,type:x})=>t.jsx(Ye,{state:o,action:e,target:f,type:x,allied:f.playerID===s,index:a,context:n,onContextChange:r,next:p},f.ID)),c.filter(f=>f.target.playerID===n.playerID).map(({target:f,type:x})=>t.jsx(Ye,{state:o,action:e,target:f,type:x,allied:f.playerID===s,index:a,context:n,onContextChange:r,next:p},f.ID))]})})}):t.jsx("div",{className:"flex justify-center flex-wrap gap-2 w-full",children:e.targets.get(o,n).map(({target:f,type:x})=>t.jsx(Ye,{state:o,action:e,target:f,type:x,allied:f.playerID===s,index:a,context:n,onContextChange:r,next:p},f.ID))})]})}function Os({action:e,state:n,context:r,onContextChange:o}){const s=H(),a=e.targets.get(n,r);return new Set(a.map(l=>l.target.playerID)).size>1&&a.length>4?t.jsx("div",{className:"flex flex-col w-full justify-around pt-4 gap-2",children:t.jsx("div",{className:"flex flex-col gap-1",children:t.jsxs("div",{className:"flex flex-wrap gap-2 w-full justify-center",children:[a.filter(l=>l.target.playerID!==r.playerID).map(({target:l,type:c})=>t.jsx(We,{state:n,action:e,target:l,type:c,allied:l.playerID===s,context:r,onContextChange:o},l.ID)),a.filter(l=>l.target.playerID===r.playerID).map(({target:l,type:c})=>t.jsx(We,{state:n,action:e,target:l,type:c,allied:l.playerID===s,context:r,onContextChange:o},l.ID))]})})}):t.jsx("div",{className:"flex justify-center flex-wrap gap-2 w-full",children:a.map(({target:l,type:c})=>t.jsx(We,{state:n,action:e,target:l,type:c,allied:l.playerID===s,context:r,onContextChange:o},l.ID))})}function Cn({playerID:e,action:n,sourceID:r,context:o,contextTitle:s,onContextChange:a,onContextConfirm:i,...l}){const c=y(m=>m.state);u.useEffect(()=>{a(ue({playerID:e,sourceID:r}))},[r,n.ID]);const d=n.targets.max(c,o),p=n.targets.unique?Math.min(d,n.targets.get(c,o).length):d,f=n.targets.validate(c,o),x=Oe(o),h=d===x;return t.jsxs(Gt,{...l,className:"bg-transparent border-none ring-0 shadow-none gap-6",children:[t.jsxs("div",{className:"gap-0 text-center text-shadow-lg rounded-xs bg-background border ring ring-black py-2 self-center px-6 w-fit",style:{boxShadow:"0px 4px 16px rgba(0,0,0,0.8)"},children:[t.jsx(Qe,{className:"text-xl inline",children:s||t.jsxs(t.Fragment,{children:["Select Targets for ",n.name]})}),t.jsx(no,{className:"text-xs",children:d>0?t.jsxs("span",{children:[x," of ",p," Targets selected."]}):t.jsx("span",{children:"No selection required."})})]}),t.jsx(ct,{className:"px-8",children:t.jsxs("div",{className:"flex flex-col items-center justify-center gap-4",children:[!n.targets.unique&&t.jsx(ks,{action:n,state:c,context:o,onContextChange:a}),n.targets.unique&&t.jsx(Os,{action:n,state:c,context:o,onContextChange:a})]})}),t.jsx(Bt,{className:"justify-end items-center gap-4",children:t.jsxs(B,{disabled:!f,className:g({"!opacity-0":!f}),variant:h?"default":"secondary",onClick:()=>i(o),children:["Confirm ",p>1&&f&&`(${x}/${p})`,t.jsx(Ht,{})]})})]})}function Le({playerID:e,source:n,actions:r,activeActionID:o,contextTitle:s,onActiveActionIDChange:a,onActionConfirm:i,children:l}){const[c,d]=u.useState(ue({playerID:e})),p=r.find(f=>f.ID===o);return t.jsxs(L.div,{className:"w-192 flex flex-col gap-4",initial:{scale:1,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:[l,t.jsxs("div",{className:g("flex flex-col gap-2 items-center"),children:[t.jsx(pt,{className:"flex-1 max-h-100 hidden",children:t.jsx("div",{className:"flex flex-col gap-1 px-px",children:r.map(f=>t.jsx(Rs,{action:f,context:c,active:f.ID===o,onActiveChange:()=>{a(f.ID)}},f.ID))})}),p&&t.jsx("div",{className:"flex-1",children:t.jsx(Cn,{playerID:e,action:p,sourceID:n?.ID,context:c,contextTitle:s,onContextChange:d,onContextConfirm:f=>{i(p,f)}})})]})]})}function Ls(){const{state:e,resolvePrompt:n}=y(s=>s),r=H(),o=e.promptQueue[0];if(o&&o.context.playerID===r){const s=o.action,a=o.context,i=Y(e,a.sourceID);return t.jsx(Le,{playerID:a.playerID,source:i,actions:[s],activeActionID:s.ID,contextTitle:"Choose Next Fighters",onActiveActionIDChange:()=>{},onActionConfirm:(l,c)=>{n(c)}},o.ID)}return t.jsx("div",{className:"w-172"})}function Fs({action:e,context:n,active:r,disabled:o,onClick:s,className:a,...i}){const l=y(x=>x.state),c=st(l,n.sourceID),d=F(x=>x.set),p=u.useRef(null),f=$t[e.ID];return u.useLayoutEffect(()=>{r&&d({activeActionRef:p})},[r]),t.jsx(L.button,{ref:p,disabled:o,onMouseDown:s,className:g("cursor-default user-select-none flex flex-col justify-start text-left !w-55 h-71 bg-neutral-950 border-2 border-neutral-700 ring ring-black p-0 rounded-sm",{"hover:z-30 hover:shadow-[0px_16px_32px_16px_rgba(0,_0,_0,_0.2)]":!o},{"z-20 bg-neutral-900 border-neutral-700":r},"disabled:opacity-50",a),...i,children:f?t.jsx(zt,{active:r,showImage:!0,renderer:f,cooldown:c?.cooldowns[e.ID]}):t.jsx("span",{className:"title text-xl p-2",children:e.name})})}function $s({context:e,actions:n,activeActionID:r,onActiveActionIDChange:o}){const s=y(l=>l.state),a=n.length,i=0;return t.jsx(L.div,{initial:{y:"200%"},animate:{y:"0"},exit:{y:"200%"},transition:{type:"spring",damping:25,stiffness:220},className:"flex absolute left-0 right-0 justify-center -space-x-22 -mb-30 -z-0",children:n.map((l,c)=>{const d=c-(a-1)/2,p=i*(1-Math.cos(d*(Math.PI/180))),f=l.ID===r,x=!Me(l,s,e);return t.jsx(Fs,{context:e,action:l,active:l.ID===r,disabled:x,onClick:()=>o(l.ID),style:{transformOrigin:"bottom center"},animate:{y:p,translateY:f?-20:0,zIndex:f?99:c,rotate:d,scale:f?1.1:1,boxShadow:`0px 12px ${f?16:8}px black`},transition:{duration:.2,ease:"easeOut"},whileHover:x?{}:{scale:1.1,y:p,rotate:0,zIndex:100,translateY:-40}},l.ID)})})}function zs(){const{state:e,pushAction:n}=y(d=>d),{activeActionID:r,activeContext:o,setActiveContext:s,set:a}=F(d=>d),i=Y(e,o.sourceID);if(!i)return null;const l=i.actions.concat(ro),c=l.find(d=>d.ID===r);return t.jsxs("div",{className:"h-full flex flex-col justify-end gap-10",children:[t.jsxs("h1",{className:"title text-center text-4xl text-muted-foreground py-4 hidden",children:["What will ",i.name," do?"]}),c&&t.jsx("div",{className:"flex-1 flex flex-col items-center justify-center mb-48",children:t.jsx(Cn,{className:"min-w-120",playerID:i.playerID,action:c,sourceID:i.ID,context:o,onContextChange:s,onContextConfirm:d=>{n(c,d),a({activeActionID:void 0})}})}),t.jsx(te,{children:t.jsx($s,{context:o,actions:l,activeActionID:r,onActiveActionIDChange:d=>a({activeActionID:d})},i.ID)})]})}function Gs({current:e}){const{state:n,resolvePrompt:r}=y(d=>d),o=H(),s=n.promptQueue[0],a=Y(n,s?.context.sourceID),i=Y(n,e?.context.sourceID),l=s&&s.context.playerID===o,c=!l&&e&&i;return t.jsxs(te,{mode:"wait",children:[l&&t.jsx(Bs,{action:s.action,context:s.context,source:a,onActionConfirm:d=>r(d)},s.ID),c&&t.jsx(Hs,{action:e.action,context:e.context,source:i},e.ID)]})}function Bs({context:e,source:n,action:r,onActionConfirm:o}){return t.jsx(Le,{playerID:e.playerID,source:n,actions:[r],activeActionID:r.ID,contextTitle:"Choose Next Fighters",onActiveActionIDChange:()=>{},onActionConfirm:(s,a)=>{o(a)}})}function Hs({action:e,source:n}){return t.jsxs(L.div,{className:"w-full text-center self-center justify-self-center m-auto z-30 py-20",transition:{duration:.4},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:{background:"radial-gradient(ellipse at center,rgba(0, 0, 0, 0.73) 0%, rgba(0, 0, 0, 0.55) 5%, rgba(0, 0, 0, 0) 40%)"},children:[t.jsxs("div",{className:"text-center text-muted-foreground",children:[t.jsx("span",{className:"title text-xl text-white",children:n.name})," uses"]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute w-80 h-full top-0 left-46 z-0"}),t.jsx("h1",{className:"text-7xl font-black text-center z-10 relative text-shadow-lg title",children:e.name})]})]})}function Vs(){const{state:e,resolvePrompt:n}=y(s=>s),r=H(),o=e.promptQueue[0];if(o&&o.context.playerID===r){const s=o.action,a=o.context,i=Y(e,a.sourceID);return t.jsx(Le,{playerID:a.playerID,source:i,actions:[s],activeActionID:s.ID,contextTitle:"Choose Next Fighters",onActiveActionIDChange:()=>{},onActionConfirm:(l,c)=>{n(c)}},o.ID)}return t.jsx("div",{className:"w-172"})}function Us(){const{state:e,resolvePrompt:n}=y(s=>s),r=H(),o=e.promptQueue[0];if(o&&o.context.playerID===r){const s=o.action,a=o.context,i=Y(e,a.sourceID);return t.jsx(Le,{playerID:a.playerID,source:i,actions:[s],activeActionID:s.ID,contextTitle:"Choose Starting Fighters",onActiveActionIDChange:()=>{},onActionConfirm:(l,c)=>{n(c)}},o.ID)}return null}function Ks(){const{state:e,deleteCombat:n}=y(i=>i),r=H(),o=e.players.find(i=>i.ID===r),s=e.players.find(i=>i.ID!==r),a=oo(e,o);return t.jsxs(Gt,{className:"w-90 m-auto",transition:{duration:.4},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[t.jsx(so,{className:"text-center",children:a?t.jsx(Qe,{children:"You Lose."}):t.jsx(Qe,{children:"Victory!"})}),!a&&t.jsxs(ct,{children:[t.jsx("p",{children:"Rewards:"}),t.jsxs("span",{className:"inline-flex items-center",children:[s.credits," ",t.jsx(Ze,{})]}),t.jsx("ul",{children:s.items.map(i=>t.jsx("li",{children:i.name},i.ID))})]}),t.jsx(Bt,{className:"justify-end",children:!a&&t.jsxs(B,{onClick:()=>{n()},children:["Continue",t.jsx(Ht,{})]})})]})}function Ws(e,n){switch(e){case"action":return 1500;case"trigger":return n==="main"?500:100;default:return 100}}function xt(){const e=y(s=>s.next),n=y(s=>s.state),r=ao(n),o=n.combat.phase;u.useEffect(()=>{const s=setInterval(()=>{e()},Ws(r,o));return()=>clearInterval(s)},[r,o])}function Ys(){switch(y(n=>n.state.combat?.phase)){case"start":return t.jsx(Xs,{});case"planning":return t.jsx(qs,{});case"main":return t.jsx(Qs,{});case"end":case"pre":return t.jsx(Zs,{});default:return null}}function Xs(){return xt(),null}function qs(){const e=y(o=>o.state),n=F(o=>o.resetActive),r=e.actionQueue.map(o=>o.ID).length;return u.useEffect(()=>{n(e)},[r]),null}function Qs(){return xt(),null}function Zs(){return xt(),null}function Js({current:e}){const r=y(o=>o.state).combat.phase;return r?t.jsxs(t.Fragment,{children:[t.jsx(Ys,{}),t.jsxs(Vt,{children:[r==="start"&&t.jsx(Ls,{}),r==="planning"&&t.jsx(zs,{}),r==="main"&&t.jsx(Gs,{current:e}),r==="end"&&t.jsx(Vs,{}),r==="pre"&&t.jsx(Us,{}),r==="post"&&t.jsx(Ks,{})]})]}):null}function ea({start:e,end:n,source:r,target:o,...s}){let a;const i=n.x-e.x,l=n.y-e.y,c=Math.sqrt(i*i+l*l),d=r==="ally"&&o==="ally";let p=d?c/4:c/3*(o==="ally"?-1:1);if(c===0)return null;if(d){const f=-l/(c/2),x=i/(c/2),h=e.x+f*p,m=e.y+x*p-20,v=n.x+f*p,j=n.y+x*p;a=`M ${e.x},${e.y} C ${h},${m} ${v},${j} ${n.x},${n.y}`}else a=`M ${e.x},${e.y} C ${e.x},${e.y-p} ${n.x},${n.y+p} ${n.x},${n.y}`;return t.jsx("g",{children:t.jsx("path",{d:a,strokeWidth:"2",fill:"none",strokeDasharray:"5, 5",...s,children:t.jsx("animate",{attributeName:"stroke-dashoffset",from:"1000",to:"0",dur:"15s",repeatCount:"indefinite"})})})}function ta({sourceActor:e,sourceRef:n,state:r,targetID:o}){const s=H(),a=r.actors.find(C=>C.ID===o),i=r.players.find(C=>C.ID===a.playerID),c=F(C=>C.activeRefs)[i.ID],d=Object.values(c).find((C,_)=>_===i.activeActorIDs.indexOf(o));if(!d||!d.current||!n||!n.current)return console.log("missing ref",o,c),null;const p=d.current.getBoundingClientRect();if(!p)return console.log("no target position"),null;const f=Y(r,o);if(!f)return console.log("no target actor"),null;const x=e.playerID===s,h=f.playerID===s,m=n.current.getBoundingClientRect(),v=m.x+m.width/2,j=x?m.y+4:m.y+m.height*1,I=p.x+p.width/2,D=h?p.y+8:p.y+p.height*1-4;return t.jsxs("svg",{className:g("absolute inset-0 pointer-events-none h-screen w-screen",{"z-10":e.playerID===f.playerID}),children:[t.jsx("defs",{children:t.jsx("filter",{id:"shadow",children:t.jsx("feDropShadow",{dx:"3",dy:"3",stdDeviation:"1","flood-color":"black","flood-opacity":"0.9"})})}),t.jsx(ea,{start:{x:v,y:j},end:{x:I,y:D},stroke:x?"var(--color-ally)":"var(--color-enemy)",source:x?"ally":"enemy",target:h?"ally":"enemy",filter:"url(#shadow)"})]})}function Nn({current:e,sourceRef:n}){const r=F(c=>c.activeRefs),o=y(c=>c.state),s=o.players.find(c=>c.ID===e.context.playerID),a=r[e.context.playerID],i=Ut(o,e.context);if(n=n??Object.values(a).find((c,d)=>d===s.activeActorIDs.indexOf(e.context.sourceID)),!n)return null;const l=Y(o,i.sourceID);return l?t.jsx(t.Fragment,{children:i.targetIDs.map((c,d)=>c&&t.jsx(ta,{sourceActor:l,sourceRef:n,state:o,targetID:c},i.sourceID+c+d))}):null}function na(){const e=F(c=>c),n=y(c=>c.state),{actors:r,combat:o}=n;if(!e.activeContext)return null;const s=Ut(n,e.activeContext),a=r.find(c=>c.ID===s.sourceID),i=a?.actions.find(c=>c.ID===e.activeActionID),l=new Set(s.targetIDs.concat(e.hoverActorID).filter(c=>!!c));return!o||o.phase!=="planning"||!i||!a?null:t.jsx(Nn,{sourceRef:e.activeActionRef,current:{ID:"staging",action:i,context:{...s,targetIDs:Array.from(l)}}})}function ra({sourceID:e,textOnly:n}){const r=y(s=>s.state),o=st(r,e);return o?n?t.jsxs("span",{className:"pr-2 float-left",children:[io(o),":"]}):t.jsxs("div",{className:g("size-10 float-left mr-3 relative mb-4"),children:[t.jsx("img",{src:o.image,className:"actor-portrait min-w-18 min-h-18 absolute -top-1 -left-4"}),t.jsx("div",{className:"absolute -bottom-3 title text-md rounded-xs flex justify-center left-0 right-0 h-4 leading-3 text-center bg-black border ring ring-black",style:{textShadow:"1px 1px 1px black"},children:o.name})]}):t.jsx("span",{className:"pr-2 float-left",children:"???:"})}function Sn({className:e,message:n,textOnly:r,...o}){const{context:s}=n;return t.jsxs("span",{className:g({"text-muted-foreground":n.type==="narration","text-foreground":n.type==="dialogue"},e),...o,children:[!!s.sourceID&&t.jsx(ra,{sourceID:s.sourceID,textOnly:r}),n.text]})}const oa=ue({playerID:co.getState().playerID});function sa({className:e,...n}){const r=y(c=>c.state),o=r.messageLog,s=Je(r),i=r.encounter.nodes.find(c=>c.ID===s.activeNodeID)?.messages(r,oa).map(c=>c.ID)??[],l=u.useRef(null);return Ur(()=>{l.current&&l.current.scrollIntoView({behavior:"auto"})},[o.length]),t.jsx(pt,{className:g("max-h-50 px-3 pt-4",e),...n,children:t.jsxs("ul",{className:"text-xs text-muted-foreground pt-2",children:[o.filter(c=>!i.includes(c.ID)).map((c,d)=>t.jsx("li",{className:"hover:bg-muted/50",style:{opacity:c.depth>0?.7:1,paddingLeft:c.depth*16},children:t.jsx(Sn,{message:c,textOnly:!0})},d+c.ID)),t.jsx("div",{ref:l})]})})}var Xe="rovingFocusGroup.onEntryFocus",aa={bubbles:!1,cancelable:!0},ge="RovingFocusGroup",[et,Rn,ia]=Kt(ge),[ca,Fe]=le(ge,[ia]),[la,ua]=ca(ge),_n=u.forwardRef((e,n)=>t.jsx(et.Provider,{scope:e.__scopeRovingFocusGroup,children:t.jsx(et.Slot,{scope:e.__scopeRovingFocusGroup,children:t.jsx(da,{...e,ref:n})})}));_n.displayName=ge;var da=u.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:r,orientation:o,loop:s=!1,dir:a,currentTabStopId:i,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:d,preventScrollOnEntryFocus:p=!1,...f}=e,x=u.useRef(null),h=P(n,x),m=Ae(a),[v,j]=Ee({prop:i,defaultProp:l??null,onChange:c,caller:ge}),[I,D]=u.useState(!1),C=K(d),_=Rn(r),k=u.useRef(!1),[E,S]=u.useState(0);return u.useEffect(()=>{const R=x.current;if(R)return R.addEventListener(Xe,C),()=>R.removeEventListener(Xe,C)},[C]),t.jsx(la,{scope:r,orientation:o,dir:m,loop:s,currentTabStopId:v,onItemFocus:u.useCallback(R=>j(R),[j]),onItemShiftTab:u.useCallback(()=>D(!0),[]),onFocusableItemAdd:u.useCallback(()=>S(R=>R+1),[]),onFocusableItemRemove:u.useCallback(()=>S(R=>R-1),[]),children:t.jsx(M.div,{tabIndex:I||E===0?-1:0,"data-orientation":o,...f,ref:h,style:{outline:"none",...e.style},onMouseDown:b(e.onMouseDown,()=>{k.current=!0}),onFocus:b(e.onFocus,R=>{const N=!k.current;if(R.target===R.currentTarget&&N&&!I){const A=new CustomEvent(Xe,aa);if(R.currentTarget.dispatchEvent(A),!A.defaultPrevented){const O=_().filter(q=>q.focusable),oe=O.find(q=>q.active),ye=O.find(q=>q.id===v),Ve=[oe,ye,...O].filter(Boolean).map(q=>q.ref.current);En(Ve,p)}}k.current=!1}),onBlur:b(e.onBlur,()=>D(!1))})})}),An="RovingFocusGroupItem",Mn=u.forwardRef((e,n)=>{const{__scopeRovingFocusGroup:r,focusable:o=!0,active:s=!1,tabStopId:a,children:i,...l}=e,c=J(),d=a||c,p=ua(An,r),f=p.currentTabStopId===d,x=Rn(r),{onFocusableItemAdd:h,onFocusableItemRemove:m,currentTabStopId:v}=p;return u.useEffect(()=>{if(o)return h(),()=>m()},[o,h,m]),t.jsx(et.ItemSlot,{scope:r,id:d,focusable:o,active:s,children:t.jsx(M.span,{tabIndex:f?0:-1,"data-orientation":p.orientation,...l,ref:n,onMouseDown:b(e.onMouseDown,j=>{o?p.onItemFocus(d):j.preventDefault()}),onFocus:b(e.onFocus,()=>p.onItemFocus(d)),onKeyDown:b(e.onKeyDown,j=>{if(j.key==="Tab"&&j.shiftKey){p.onItemShiftTab();return}if(j.target!==j.currentTarget)return;const I=xa(j,p.orientation,p.dir);if(I!==void 0){if(j.metaKey||j.ctrlKey||j.altKey||j.shiftKey)return;j.preventDefault();let C=x().filter(_=>_.focusable).map(_=>_.ref.current);if(I==="last")C.reverse();else if(I==="prev"||I==="next"){I==="prev"&&C.reverse();const _=C.indexOf(j.currentTarget);C=p.loop?ha(C,_+1):C.slice(_+1)}setTimeout(()=>En(C))}}),children:typeof i=="function"?i({isCurrentTabStop:f,hasTabStop:v!=null}):i})})});Mn.displayName=An;var fa={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function pa(e,n){return n!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function xa(e,n,r){const o=pa(e.key,r);if(!(n==="vertical"&&["ArrowLeft","ArrowRight"].includes(o))&&!(n==="horizontal"&&["ArrowUp","ArrowDown"].includes(o)))return fa[o]}function En(e,n=!1){const r=document.activeElement;for(const o of e)if(o===r||(o.focus({preventScroll:n}),document.activeElement!==r))return}function ha(e,n){return e.map((r,o)=>e[(n+o)%e.length])}var Pn=_n,Tn=Mn,tt=["Enter"," "],ma=["ArrowDown","PageUp","Home"],kn=["ArrowUp","PageDown","End"],ga=[...ma,...kn],va={ltr:[...tt,"ArrowRight"],rtl:[...tt,"ArrowLeft"]},ba={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ve="Menu",[he,ya,ja]=Kt(ve),[ne,On]=le(ve,[ja,Wt,Fe]),$e=Wt(),Ln=Fe(),[wa,re]=ne(ve),[Ia,be]=ne(ve),Fn=e=>{const{__scopeMenu:n,open:r=!1,children:o,dir:s,onOpenChange:a,modal:i=!0}=e,l=$e(n),[c,d]=u.useState(null),p=u.useRef(!1),f=K(a),x=Ae(s);return u.useEffect(()=>{const h=()=>{p.current=!0,document.addEventListener("pointerdown",m,{capture:!0,once:!0}),document.addEventListener("pointermove",m,{capture:!0,once:!0})},m=()=>p.current=!1;return document.addEventListener("keydown",h,{capture:!0}),()=>{document.removeEventListener("keydown",h,{capture:!0}),document.removeEventListener("pointerdown",m,{capture:!0}),document.removeEventListener("pointermove",m,{capture:!0})}},[]),t.jsx(lo,{...l,children:t.jsx(wa,{scope:n,open:r,onOpenChange:f,content:c,onContentChange:d,children:t.jsx(Ia,{scope:n,onClose:u.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:p,dir:x,modal:i,children:o})})})};Fn.displayName=ve;var Da="MenuAnchor",ht=u.forwardRef((e,n)=>{const{__scopeMenu:r,...o}=e,s=$e(r);return t.jsx(uo,{...s,...o,ref:n})});ht.displayName=Da;var mt="MenuPortal",[Ca,$n]=ne(mt,{forceMount:void 0}),zn=e=>{const{__scopeMenu:n,forceMount:r,children:o,container:s}=e,a=re(mt,n);return t.jsx(Ca,{scope:n,forceMount:r,children:t.jsx(G,{present:r||a.open,children:t.jsx(Yt,{asChild:!0,container:s,children:o})})})};zn.displayName=mt;var z="MenuContent",[Na,gt]=ne(z),Gn=u.forwardRef((e,n)=>{const r=$n(z,e.__scopeMenu),{forceMount:o=r.forceMount,...s}=e,a=re(z,e.__scopeMenu),i=be(z,e.__scopeMenu);return t.jsx(he.Provider,{scope:e.__scopeMenu,children:t.jsx(G,{present:o||a.open,children:t.jsx(he.Slot,{scope:e.__scopeMenu,children:i.modal?t.jsx(Sa,{...s,ref:n}):t.jsx(Ra,{...s,ref:n})})})})}),Sa=u.forwardRef((e,n)=>{const r=re(z,e.__scopeMenu),o=u.useRef(null),s=P(n,o);return u.useEffect(()=>{const a=o.current;if(a)return Xt(a)},[]),t.jsx(vt,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:b(e.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),Ra=u.forwardRef((e,n)=>{const r=re(z,e.__scopeMenu);return t.jsx(vt,{...e,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),_a=Zt("MenuContent.ScrollLock"),vt=u.forwardRef((e,n)=>{const{__scopeMenu:r,loop:o=!1,trapFocus:s,onOpenAutoFocus:a,onCloseAutoFocus:i,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:f,onInteractOutside:x,onDismiss:h,disableOutsideScroll:m,...v}=e,j=re(z,r),I=be(z,r),D=$e(r),C=Ln(r),_=ya(r),[k,E]=u.useState(null),S=u.useRef(null),R=P(n,S,j.onContentChange),N=u.useRef(0),A=u.useRef(""),O=u.useRef(0),oe=u.useRef(null),ye=u.useRef("right"),je=u.useRef(0),Ve=m?Qt:u.Fragment,q=m?{as:_a,allowPinchZoom:!0}:void 0,Vr=w=>{const ae=A.current+w,Z=_().filter($=>!$.disabled),de=document.activeElement,Ue=Z.find($=>$.ref.current===de)?.textValue,Ke=Z.map($=>$.textValue),Nt=Ga(Ke,ae,Ue),fe=Z.find($=>$.textValue===Nt)?.ref.current;(function $(St){A.current=St,window.clearTimeout(N.current),St!==""&&(N.current=window.setTimeout(()=>$(""),1e3))})(ae),fe&&setTimeout(()=>fe.focus())};u.useEffect(()=>()=>window.clearTimeout(N.current),[]),qt();const se=u.useCallback(w=>ye.current===oe.current?.side&&Ha(w,oe.current?.area),[]);return t.jsx(Na,{scope:r,searchRef:A,onItemEnter:u.useCallback(w=>{se(w)&&w.preventDefault()},[se]),onItemLeave:u.useCallback(w=>{se(w)||(S.current?.focus(),E(null))},[se]),onTriggerLeave:u.useCallback(w=>{se(w)&&w.preventDefault()},[se]),pointerGraceTimerRef:O,onPointerGraceIntentChange:u.useCallback(w=>{oe.current=w},[]),children:t.jsx(Ve,{...q,children:t.jsx(Jt,{asChild:!0,trapped:s,onMountAutoFocus:b(a,w=>{w.preventDefault(),S.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:t.jsx(en,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:p,onFocusOutside:f,onInteractOutside:x,onDismiss:h,children:t.jsx(Pn,{asChild:!0,...C,dir:I.dir,orientation:"vertical",loop:o,currentTabStopId:k,onCurrentTabStopIdChange:E,onEntryFocus:b(c,w=>{I.isUsingKeyboardRef.current||w.preventDefault()}),preventScrollOnEntryFocus:!0,children:t.jsx(po,{role:"menu","aria-orientation":"vertical","data-state":rr(j.open),"data-radix-menu-content":"",dir:I.dir,...D,...v,ref:R,style:{outline:"none",...v.style},onKeyDown:b(v.onKeyDown,w=>{const Z=w.target.closest("[data-radix-menu-content]")===w.currentTarget,de=w.ctrlKey||w.altKey||w.metaKey,Ue=w.key.length===1;Z&&(w.key==="Tab"&&w.preventDefault(),!de&&Ue&&Vr(w.key));const Ke=S.current;if(w.target!==Ke||!ga.includes(w.key))return;w.preventDefault();const fe=_().filter($=>!$.disabled).map($=>$.ref.current);kn.includes(w.key)&&fe.reverse(),$a(fe)}),onBlur:b(e.onBlur,w=>{w.currentTarget.contains(w.target)||(window.clearTimeout(N.current),A.current="")}),onPointerMove:b(e.onPointerMove,me(w=>{const ae=w.target,Z=je.current!==w.clientX;if(w.currentTarget.contains(ae)&&Z){const de=w.clientX>je.current?"right":"left";ye.current=de,je.current=w.clientX}}))})})})})})})});Gn.displayName=z;var Aa="MenuGroup",bt=u.forwardRef((e,n)=>{const{__scopeMenu:r,...o}=e;return t.jsx(M.div,{role:"group",...o,ref:n})});bt.displayName=Aa;var Ma="MenuLabel",Bn=u.forwardRef((e,n)=>{const{__scopeMenu:r,...o}=e;return t.jsx(M.div,{...o,ref:n})});Bn.displayName=Ma;var Se="MenuItem",Pt="menu.itemSelect",ze=u.forwardRef((e,n)=>{const{disabled:r=!1,onSelect:o,...s}=e,a=u.useRef(null),i=be(Se,e.__scopeMenu),l=gt(Se,e.__scopeMenu),c=P(n,a),d=u.useRef(!1),p=()=>{const f=a.current;if(!r&&f){const x=new CustomEvent(Pt,{bubbles:!0,cancelable:!0});f.addEventListener(Pt,h=>o?.(h),{once:!0}),fo(f,x),x.defaultPrevented?d.current=!1:i.onClose()}};return t.jsx(Hn,{...s,ref:c,disabled:r,onClick:b(e.onClick,p),onPointerDown:f=>{e.onPointerDown?.(f),d.current=!0},onPointerUp:b(e.onPointerUp,f=>{d.current||f.currentTarget?.click()}),onKeyDown:b(e.onKeyDown,f=>{const x=l.searchRef.current!=="";r||x&&f.key===" "||tt.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});ze.displayName=Se;var Hn=u.forwardRef((e,n)=>{const{__scopeMenu:r,disabled:o=!1,textValue:s,...a}=e,i=gt(Se,r),l=Ln(r),c=u.useRef(null),d=P(n,c),[p,f]=u.useState(!1),[x,h]=u.useState("");return u.useEffect(()=>{const m=c.current;m&&h((m.textContent??"").trim())},[a.children]),t.jsx(he.ItemSlot,{scope:r,disabled:o,textValue:s??x,children:t.jsx(Tn,{asChild:!0,...l,focusable:!o,children:t.jsx(M.div,{role:"menuitem","data-highlighted":p?"":void 0,"aria-disabled":o||void 0,"data-disabled":o?"":void 0,...a,ref:d,onPointerMove:b(e.onPointerMove,me(m=>{o?i.onItemLeave(m):(i.onItemEnter(m),m.defaultPrevented||m.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:b(e.onPointerLeave,me(m=>i.onItemLeave(m))),onFocus:b(e.onFocus,()=>f(!0)),onBlur:b(e.onBlur,()=>f(!1))})})})}),Ea="MenuCheckboxItem",Vn=u.forwardRef((e,n)=>{const{checked:r=!1,onCheckedChange:o,...s}=e;return t.jsx(Xn,{scope:e.__scopeMenu,checked:r,children:t.jsx(ze,{role:"menuitemcheckbox","aria-checked":Re(r)?"mixed":r,...s,ref:n,"data-state":jt(r),onSelect:b(s.onSelect,()=>o?.(Re(r)?!0:!r),{checkForDefaultPrevented:!1})})})});Vn.displayName=Ea;var Un="MenuRadioGroup",[Pa,Ta]=ne(Un,{value:void 0,onValueChange:()=>{}}),Kn=u.forwardRef((e,n)=>{const{value:r,onValueChange:o,...s}=e,a=K(o);return t.jsx(Pa,{scope:e.__scopeMenu,value:r,onValueChange:a,children:t.jsx(bt,{...s,ref:n})})});Kn.displayName=Un;var Wn="MenuRadioItem",Yn=u.forwardRef((e,n)=>{const{value:r,...o}=e,s=Ta(Wn,e.__scopeMenu),a=r===s.value;return t.jsx(Xn,{scope:e.__scopeMenu,checked:a,children:t.jsx(ze,{role:"menuitemradio","aria-checked":a,...o,ref:n,"data-state":jt(a),onSelect:b(o.onSelect,()=>s.onValueChange?.(r),{checkForDefaultPrevented:!1})})})});Yn.displayName=Wn;var yt="MenuItemIndicator",[Xn,ka]=ne(yt,{checked:!1}),qn=u.forwardRef((e,n)=>{const{__scopeMenu:r,forceMount:o,...s}=e,a=ka(yt,r);return t.jsx(G,{present:o||Re(a.checked)||a.checked===!0,children:t.jsx(M.span,{...s,ref:n,"data-state":jt(a.checked)})})});qn.displayName=yt;var Oa="MenuSeparator",Qn=u.forwardRef((e,n)=>{const{__scopeMenu:r,...o}=e;return t.jsx(M.div,{role:"separator","aria-orientation":"horizontal",...o,ref:n})});Qn.displayName=Oa;var La="MenuArrow",Zn=u.forwardRef((e,n)=>{const{__scopeMenu:r,...o}=e,s=$e(r);return t.jsx(xo,{...s,...o,ref:n})});Zn.displayName=La;var Fa="MenuSub",[Yc,Jn]=ne(Fa),xe="MenuSubTrigger",er=u.forwardRef((e,n)=>{const r=re(xe,e.__scopeMenu),o=be(xe,e.__scopeMenu),s=Jn(xe,e.__scopeMenu),a=gt(xe,e.__scopeMenu),i=u.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=a,d={__scopeMenu:e.__scopeMenu},p=u.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return u.useEffect(()=>p,[p]),u.useEffect(()=>{const f=l.current;return()=>{window.clearTimeout(f),c(null)}},[l,c]),t.jsx(ht,{asChild:!0,...d,children:t.jsx(Hn,{id:s.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":s.contentId,"data-state":rr(r.open),...e,ref:tn(n,s.onTriggerChange),onClick:f=>{e.onClick?.(f),!(e.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:b(e.onPointerMove,me(f=>{a.onItemEnter(f),!f.defaultPrevented&&!e.disabled&&!r.open&&!i.current&&(a.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{r.onOpenChange(!0),p()},100))})),onPointerLeave:b(e.onPointerLeave,me(f=>{p();const x=r.content?.getBoundingClientRect();if(x){const h=r.content?.dataset.side,m=h==="right",v=m?-5:5,j=x[m?"left":"right"],I=x[m?"right":"left"];a.onPointerGraceIntentChange({area:[{x:f.clientX+v,y:f.clientY},{x:j,y:x.top},{x:I,y:x.top},{x:I,y:x.bottom},{x:j,y:x.bottom}],side:h}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.onPointerGraceIntentChange(null),300)}else{if(a.onTriggerLeave(f),f.defaultPrevented)return;a.onPointerGraceIntentChange(null)}})),onKeyDown:b(e.onKeyDown,f=>{const x=a.searchRef.current!=="";e.disabled||x&&f.key===" "||va[o.dir].includes(f.key)&&(r.onOpenChange(!0),r.content?.focus(),f.preventDefault())})})})});er.displayName=xe;var tr="MenuSubContent",nr=u.forwardRef((e,n)=>{const r=$n(z,e.__scopeMenu),{forceMount:o=r.forceMount,...s}=e,a=re(z,e.__scopeMenu),i=be(z,e.__scopeMenu),l=Jn(tr,e.__scopeMenu),c=u.useRef(null),d=P(n,c);return t.jsx(he.Provider,{scope:e.__scopeMenu,children:t.jsx(G,{present:o||a.open,children:t.jsx(he.Slot,{scope:e.__scopeMenu,children:t.jsx(vt,{id:l.contentId,"aria-labelledby":l.triggerId,...s,ref:d,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:p=>{i.isUsingKeyboardRef.current&&c.current?.focus(),p.preventDefault()},onCloseAutoFocus:p=>p.preventDefault(),onFocusOutside:b(e.onFocusOutside,p=>{p.target!==l.trigger&&a.onOpenChange(!1)}),onEscapeKeyDown:b(e.onEscapeKeyDown,p=>{i.onClose(),p.preventDefault()}),onKeyDown:b(e.onKeyDown,p=>{const f=p.currentTarget.contains(p.target),x=ba[i.dir].includes(p.key);f&&x&&(a.onOpenChange(!1),l.trigger?.focus(),p.preventDefault())})})})})})});nr.displayName=tr;function rr(e){return e?"open":"closed"}function Re(e){return e==="indeterminate"}function jt(e){return Re(e)?"indeterminate":e?"checked":"unchecked"}function $a(e){const n=document.activeElement;for(const r of e)if(r===n||(r.focus(),document.activeElement!==n))return}function za(e,n){return e.map((r,o)=>e[(n+o)%e.length])}function Ga(e,n,r){const s=n.length>1&&Array.from(n).every(d=>d===n[0])?n[0]:n,a=r?e.indexOf(r):-1;let i=za(e,Math.max(a,0));s.length===1&&(i=i.filter(d=>d!==r));const c=i.find(d=>d.toLowerCase().startsWith(s.toLowerCase()));return c!==r?c:void 0}function Ba(e,n){const{x:r,y:o}=e;let s=!1;for(let a=0,i=n.length-1;a<n.length;i=a++){const l=n[a],c=n[i],d=l.x,p=l.y,f=c.x,x=c.y;p>o!=x>o&&r<(f-d)*(o-p)/(x-p)+d&&(s=!s)}return s}function Ha(e,n){if(!n)return!1;const r={x:e.clientX,y:e.clientY};return Ba(r,n)}function me(e){return n=>n.pointerType==="mouse"?e(n):void 0}var Va=Fn,Ua=ht,Ka=zn,Wa=Gn,Ya=bt,Xa=Bn,qa=ze,Qa=Vn,Za=Kn,Ja=Yn,ei=qn,ti=Qn,ni=Zn,ri=er,oi=nr,Ge="DropdownMenu",[si]=le(Ge,[On]),T=On(),[ai,or]=si(Ge),sr=e=>{const{__scopeDropdownMenu:n,children:r,dir:o,open:s,defaultOpen:a,onOpenChange:i,modal:l=!0}=e,c=T(n),d=u.useRef(null),[p,f]=Ee({prop:s,defaultProp:a??!1,onChange:i,caller:Ge});return t.jsx(ai,{scope:n,triggerId:J(),triggerRef:d,contentId:J(),open:p,onOpenChange:f,onOpenToggle:u.useCallback(()=>f(x=>!x),[f]),modal:l,children:t.jsx(Va,{...c,open:p,onOpenChange:f,dir:o,modal:l,children:r})})};sr.displayName=Ge;var ar="DropdownMenuTrigger",ir=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,disabled:o=!1,...s}=e,a=or(ar,r),i=T(r);return t.jsx(Ua,{asChild:!0,...i,children:t.jsx(M.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":o?"":void 0,disabled:o,...s,ref:tn(n,a.triggerRef),onPointerDown:b(e.onPointerDown,l=>{!o&&l.button===0&&l.ctrlKey===!1&&(a.onOpenToggle(),a.open||l.preventDefault())}),onKeyDown:b(e.onKeyDown,l=>{o||(["Enter"," "].includes(l.key)&&a.onOpenToggle(),l.key==="ArrowDown"&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});ir.displayName=ar;var ii="DropdownMenuPortal",cr=e=>{const{__scopeDropdownMenu:n,...r}=e,o=T(n);return t.jsx(Ka,{...o,...r})};cr.displayName=ii;var lr="DropdownMenuContent",ur=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=or(lr,r),a=T(r),i=u.useRef(!1);return t.jsx(Wa,{id:s.contentId,"aria-labelledby":s.triggerId,...a,...o,ref:n,onCloseAutoFocus:b(e.onCloseAutoFocus,l=>{i.current||s.triggerRef.current?.focus(),i.current=!1,l.preventDefault()}),onInteractOutside:b(e.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,p=c.button===2||d;(!s.modal||p)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});ur.displayName=lr;var ci="DropdownMenuGroup",dr=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(Ya,{...s,...o,ref:n})});dr.displayName=ci;var li="DropdownMenuLabel",ui=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(Xa,{...s,...o,ref:n})});ui.displayName=li;var di="DropdownMenuItem",fr=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(qa,{...s,...o,ref:n})});fr.displayName=di;var fi="DropdownMenuCheckboxItem",pi=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(Qa,{...s,...o,ref:n})});pi.displayName=fi;var xi="DropdownMenuRadioGroup",hi=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(Za,{...s,...o,ref:n})});hi.displayName=xi;var mi="DropdownMenuRadioItem",gi=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(Ja,{...s,...o,ref:n})});gi.displayName=mi;var vi="DropdownMenuItemIndicator",bi=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(ei,{...s,...o,ref:n})});bi.displayName=vi;var yi="DropdownMenuSeparator",ji=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(ti,{...s,...o,ref:n})});ji.displayName=yi;var wi="DropdownMenuArrow",Ii=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(ni,{...s,...o,ref:n})});Ii.displayName=wi;var Di="DropdownMenuSubTrigger",Ci=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(ri,{...s,...o,ref:n})});Ci.displayName=Di;var Ni="DropdownMenuSubContent",Si=u.forwardRef((e,n)=>{const{__scopeDropdownMenu:r,...o}=e,s=T(r);return t.jsx(oi,{...s,...o,ref:n,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Si.displayName=Ni;var Ri=sr,_i=ir,Ai=cr,Mi=ur,Ei=dr,Pi=fr;function Ti({...e}){return t.jsx(Ri,{"data-slot":"dropdown-menu",...e})}function ki({...e}){return t.jsx(_i,{"data-slot":"dropdown-menu-trigger",...e})}function Oi({className:e,sideOffset:n=4,...r}){return t.jsx(Ai,{children:t.jsx(Mi,{"data-slot":"dropdown-menu-content",sideOffset:n,className:g("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-xs border p-1 shadow-md","ring ring-black",e),...r})})}function Li({...e}){return t.jsx(Ei,{"data-slot":"dropdown-menu-group",...e})}function Fi({className:e,inset:n,variant:r="default",...o}){return t.jsx(Pi,{"data-slot":"dropdown-menu-item","data-inset":n,"data-variant":r,className:g("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...o})}function nt({value:e,variant:n="secondary",size:r="xs",className:o,children:s,...a}){return t.jsxs(B,{variant:n,size:r,className:g("text-muted-foreground hover:bg-ring/50 hover:text-foreground/70 border border-white/5 ring ring-black/30",{"!opacity-100":!!e},o),...a,children:[s,!a.disabled&&t.jsx(ho,{})]})}function rt({placeholder:e,disabled:n,options:r,onValueChange:o,...s}){const a=H(),i=r.find(l=>l.ID===s.value);return u.useEffect(()=>{r.length===1&&!i&&!n&&o(r[0].ID)},[r.length,n]),t.jsxs(Ti,{children:[t.jsx(ki,{asChild:!0,children:t.jsx(nt,{className:g("data-[state=open]:text-foreground",{"text-foreground hover:text-foreground":i,"bg-slate-700 hover:bg-slate-700/80":i?.playerID===a,"bg-stone-700 hover:bg-stone-700/80":i&&i?.playerID!==a}),value:i?.ID,disabled:n||r.length===0,children:i?.name||e})}),t.jsx(Oi,{children:t.jsx(Li,{children:r.map(l=>t.jsxs(Fi,{className:g({"dark:hover:bg-slate-800 border border-transparent hover:border-slate-700":l.playerID===a,"dark:bg-slate-900 dark:border-slate-800":l.playerID===a&&l.ID===s.value,"dark:hover:bg-stone-800":l.playerID&&l.playerID!==a,"":l.playerID&&l.playerID!==a&&l.ID===s.value}),onSelect:()=>{l.ID===s.value?o(void 0):o(l.ID)},children:[l.ID===s.value&&t.jsx(Xo,{}),l.name]},l.ID))})})]})}function $i({className:e,disabled:n,...r}){return t.jsx(go,{className:g("h-8 border-none rounded-xs dark:bg-input/60",{"dark:hover:bg-input":!n},e),...r})}function zi({option:e,onConfirm:n}){const r=y(x=>x.state),[o,s]=u.useState(e.context),a=!Me(e.action,r,o),i=Pe(r),l=e.action.sources(r,o),c=e.action.targets.get(r,o),d=e.action.targets.max(r,o),p=e.action.targets.validate(r,o);function f(x){return c.map(h=>h.target).filter(h=>!o.targetIDs.includes(h.ID)||o.targetIDs[x]===h.ID)}return e.disable==="hide"&&a?null:t.jsxs($i,{className:g("group",{"opacity-50":a||i}),disabled:a||i,children:[e.icons&&t.jsx(pe,{className:g("pr-2 opacity-50 flex items-center gap-2"),children:e.icons}),l.length>0&&t.jsx(pe,{children:t.jsx(rt,{placeholder:"Source",disabled:a||i,options:l,value:o.sourceID,onValueChange:x=>s(h=>({...h,sourceID:x??""}))})}),t.jsx(pe,{className:g("pr-2",{"group-hover:text-foreground/70":!(a||i)}),children:e.text}),d>0&&c.length>0&&t.jsx(pe,{className:"gap-2",children:Array.from({length:d}).map((x,h)=>t.jsx(rt,{placeholder:"Select",disabled:a||i,options:f(h),value:o.targetIDs[h],onValueChange:m=>s(v=>({...v,targetIDs:[...v.targetIDs.slice(0,h),m,...v.targetIDs.slice(h+1)]}))},h))}),t.jsx("div",{className:"flex-1"}),p&&!(a||i)&&t.jsx(pe,{align:"inline-end",children:t.jsx(mo,{className:"cursor-pointer rounded-full opacity-70 hover:opacity-100",size:"icon-xs",variant:"default",onClick:()=>{n(o),s(e.context)},children:t.jsx(Wo,{})})})]})}function Gi({className:e,...n}){return t.jsx(Dn,{orientation:"vertical",className:g("flex flex-col gap-0 w-full border rounded-sm ring ring-black"),...n})}function Bi({messages:e}){return t.jsx(L.ul,{className:"space-y-2 border-t border-border/50 py-4 px-2 flex-1 overflow-y-auto",children:e.map((n,r)=>t.jsx(L.li,{className:"max-w-4/5 leading-1.5",initial:{opacity:0},animate:{opacity:1},transition:{delay:r/4},children:t.jsx(Sn,{className:"text-sm",message:n,textOnly:!1})},n.ID))})}function Hi({className:e,...n}){return t.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:t.jsx("table",{"data-slot":"table",className:g("w-full caption-bottom text-sm",e),...n})})}function Vi({className:e,...n}){return t.jsx("thead",{"data-slot":"table-header",className:g("[&_tr]:border-b",e),...n})}function Ui({className:e,...n}){return t.jsx("tbody",{"data-slot":"table-body",className:g("[&_tr:last-child]:border-0",e),...n})}function Tt({className:e,...n}){return t.jsx("tr",{"data-slot":"table-row",className:g("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...n})}function Ie({className:e,...n}){return t.jsx("th",{"data-slot":"table-head",className:g("text-foreground/40 h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...n})}function De({className:e,...n}){return t.jsx("td",{"data-slot":"table-cell",className:g("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...n})}function Ki({className:e,...n}){return t.jsx("caption",{"data-slot":"table-caption",className:g("text-muted-foreground mt-4 text-sm",e),...n})}function pr({items:e,actionHeader:n,actions:r}){const o=vo(e);return t.jsxs(Hi,{children:[t.jsx(Vi,{children:t.jsxs(Tt,{className:"pointer-events-none",children:[t.jsx(Ie,{}),t.jsx(Ie,{children:"Name"}),t.jsx(Ie,{children:"Description"}),t.jsx(Ie,{className:"flex items-center justify-end",children:n??t.jsx(Jo,{})})]})}),t.jsx(Ui,{children:Object.entries(o).map(([s,a])=>[e.find(i=>i.name===s),a]).map(([s,a])=>t.jsxs(Tt,{children:[t.jsx(De,{children:a}),t.jsx(De,{children:s.name}),t.jsx(De,{children:"The quick brown fox jumps over the lazy dog."}),t.jsx(De,{className:"flex justify-end gap-1",children:r(s)})]},s.ID))}),e.length===0&&t.jsx(Ki,{children:"No items available."})]})}function Wi(e){return{ID:bo(),name:"Purchase Item",priority:0,cooldown:()=>0,validate:(n,r)=>{const o=Je(n),s=n.players.find(i=>i.ID===r.playerID),a=_t(n,o.activeNodeID,e);return!s||!a?!1:s.credits>a.value},targets:{unique:!0,max:()=>0,get:()=>[],validate:()=>!0},sources:()=>[],resolve:(n,r)=>{const o=Je(n);return[yo(r,e),jo(r,[wo({text:Io(_t(n,o.activeNodeID,e)," purchased.")})])]}}}function Yi(){const{state:e,resolveActionItem:n}=y(l=>l),r=H(),o=e.players.find(l=>l.ID===r),s=ue({playerID:r}),a=Do(e),i=Pe(e);return!a||!o?null:t.jsxs(ct,{className:"flex flex-1 flex-col gap-2 justify-between z-0 overflow-hidden",children:[t.jsx(sa,{}),t.jsxs("div",{className:"flex flex-1 flex-col justify-between overflow-hidden gap-4",children:[t.jsx(Bi,{messages:a.messages(e,s)}),a.type==="shop"&&t.jsx(pr,{items:a.items,actionHeader:t.jsxs(t.Fragment,{children:["Buy (",o.credits," ",t.jsx(Ze,{}),")"]}),actions:l=>{const c=Wi(l.ID);return t.jsxs(B,{size:"xs",variant:"secondary",className:"cursor-pointer",disabled:i||!Me(c,e,s),onClick:()=>n(c,s),children:[l.value,t.jsx(Ze,{className:"opacity-40"})]})}}),t.jsx(Gi,{children:a.options(e,s).map((l,c)=>t.jsx(zi,{index:c+1,option:l,onConfirm:d=>{const p=Co(l,d);n(p.action,p.context)}},l.ID))})]})]})}function Xi(){const{state:e}=y(n=>n);if(!e.combat)return t.jsx(qi,{})}function qi(){const e=y(o=>o.state),n=y(o=>o.next),r=Pe(e);return u.useEffect(()=>{if(!r)return;const o=setInterval(()=>{n()},100);return()=>clearInterval(o)},[r]),null}const Qi="/bmt-cmbt/assets/Devastated%20Landscape1-kF47amtk.png";function Zi(){const{state:e}=y(a=>a),o=!(e.combat?.phase==="planning")&&Pe(e),s=Object.values(e.pastEncounters).filter(a=>a.ID!==e.encounter.ID);return u.useEffect(()=>{},[e]),t.jsxs(t.Fragment,{children:[t.jsx(Xi,{}),t.jsx(Vt,{children:t.jsx(te,{mode:"wait",onExitComplete:()=>{},children:t.jsxs(L.div,{className:"flex justify-center relative",transition:{duration:.4},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[t.jsx(No,{className:"absolute top-4 left-0",children:e.encounter.name}),t.jsxs(So,{className:"gap-0 relative overflow-hidden mt-8",style:{imageRendering:"pixelated",backgroundImage:`url(${Qi})`,backgroundSize:"cover",backgroundPosition:"bottom"},children:[t.jsx("div",{className:"absolute inset-0 z-0",style:{background:"linear-gradient(0deg,rgba(0, 0, 0, 0.95) 33%, rgba(0, 0, 0, 0.99) 100%)"}}),t.jsx("div",{className:"flex items-start justify-between",children:t.jsx(Ro,{className:"absolute top-2 right-2 z-30",children:s.length>0&&t.jsx(B,{variant:"ghost",disabled:o,children:t.jsx("span",{className:"text-muted-foreground",children:"Travel"})})})}),t.jsx(Yi,{})]})]},e.encounter.ID)})})]})}function Ji({className:e,...n}){return t.jsx("div",{className:g("relative h-6 bg-black/60 ring ring-black",e),style:{borderStyle:"inset"},...n})}function ec({children:e,value:n,...r}){const[o,s]=Rt.useState(n);return Rt.useEffect(()=>{const a=setTimeout(()=>s(n),700);return()=>clearTimeout(a)},[n]),t.jsxs(Ji,{...r,children:[t.jsx(L.div,{className:g("bg-red-800/80 absolute top-0 h-full border-white/10 z-10 ring ring-black",{border:n>0}),initial:{width:`${n}%`},animate:{width:`${n}%`}}),t.jsx(L.div,{className:g("bg-white/80 absolute top-0 h-full border-white/20 z-0 ring ring-black",{border:n>0}),initial:{width:`${o}%`},animate:{width:`${o}%`}}),t.jsx("div",{className:"absolute inset-0 flex flex-row justify-end inset",children:e})]})}function xr({showHealthNumbers:e,health:n,maxHealth:r,children:o}){const s=r===0?0:n*100/r;return t.jsx(ec,{value:s,children:e&&t.jsx("div",{className:"absolute top-0.5 right-1 z-10 leading-4 title text-xl text-foreground text-shadow-md",children:o||t.jsxs(t.Fragment,{children:[Math.max(n,0),"/",r]})})})}function tc({actor:e,...n}){const r=y(a=>a.state),o=y(a=>a.filterAction),s=r.actionQueue.find(a=>a.context.sourceID===e.ID);return s?t.jsx(B,{size:"icon-xs",variant:"destructive",onClick:()=>o(s.context.sourceID),...n,children:t.jsx(os,{className:"size-4"})}):null}const nc=it("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function W({className:e,variant:n,asChild:r=!1,...o}){const s=r?_o:"span";return t.jsx(s,{"data-slot":"badge",className:g(nc({variant:n}),e),...o})}function hr({count:e,effectID:n,...r}){const o=Mo[n];return t.jsx(Ao,{effectID:n,side:"bottom",asChild:!0,...r,children:t.jsxs(W,{variant:"outline",className:"bg-background border-input text-muted-foreground p-1 [&>svg]:size-4 ring ring-black rounded-xs",children:[o?t.jsx(o.Icon,{}):t.jsx(Eo,{}),e>1?`(${e})`:""]})})}const rc=it("flex disabled:pointer-events-none outline-none p-1 px-2 rounded-sm transition-all border border-transparent",{variants:{variant:{ally:"rounded-tl-xl! bg-slate-700 hover:bg-slate-700/80 text-foreground border-slate-600! ring ring-black","ally-active":"bg-slate-300 text-slate-950 border border-white ring ring-black",enemy:"bg-transparent","enemy-active":"bg-stone-300 text-stone-950 ring ring-black",targeted:"bg-yellow-600/90 text-white ring ring-black"},defaultVariants:{variant:"ally"}}});function mr({className:e,variant:n,...r}){return t.jsx(L.button,{className:rc({variant:n,className:e}),style:{boxShadow:n==="ally"||n==="ally-active"||n==="targeted"?"8px 0px 16px rgba(0,0,0,0.4)":void 0},...r})}function oc({actorID:e,active:n,index:r,targeted:o,disabled:s,status:a,onClick:i,...l}){const c=y(D=>D.state),{hoverActorID:d,setActiveRefs:p}=F(D=>({hoverActorID:D.hoverActorID,setActiveRefs:D.setActiveRefs})),f=u.useRef(null),[x,h]=u.useState(0),m=Y(c,e),[v,j]=nn(m),I=m.state.alive?v:0;return s=s||m.state.stunned===1,o=o||d===e,u.useLayoutEffect(()=>{f.current!==null&&p(m.playerID,r,f)},[m.playerID,r,f]),t.jsxs(L.div,{initial:{y:"100%",opacity:0},animate:{y:"0%",opacity:1},exit:{y:"100%",opacity:0},className:"group flex flex-col justify-end w-64 absolute bottom-0","data-state":x>0?"open":"closed",...l,children:[t.jsx("div",{className:"flex transition-all justify-between h-6 translate-y-2 group-hover:-translate-y-1.5 group-data-[state=open]:-translate-y-1.5 z-10",children:t.jsx("div",{className:"flex -space-x-3 group-hover:space-x-1 group-data-[state=open]:space-x-1 transition-all flex-wrap",children:t.jsx(te,{children:Object.entries(m.applied).map(([D,C])=>t.jsx(L.div,{layout:!0,initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},className:"z-30",children:t.jsx(hr,{effectID:D,count:C,side:"top",onOpenChange:_=>{h(k=>k+(_?1:-1))}})},D))})})}),c.combat?.phase==="planning"&&t.jsx(tc,{actor:m,className:"absolute top-8 right-2 opacity-100 z-10"}),t.jsxs(mr,{variant:o?"targeted":n?"ally-active":"ally",disabled:s,onClick:()=>i(m),className:g("flex pl-10 relative",{"opacity-50":s&&!n}),children:[t.jsx("div",{className:"absolute -left-8 -top-3 size-25 overflow-hidden z-0",ref:f,children:t.jsx("img",{src:Po[m.image],className:"actor-portrait"})}),t.jsx(W,{className:"absolute -left-2 -bottom-2 bg-slate-900 border-slate-700 rounded-xs ring ring-black title text-xl h-6",variant:"outline",children:t.jsx("div",{className:"-mt-1.5",children:"Lv. 1"})}),t.jsx("div",{className:"flex-1 z-10",children:t.jsxs(rn,{className:"gap-0",children:[t.jsx(on,{className:"text-xl title pl-2",style:{textShadow:n?void 0:"1px 1px 1px black"},children:m.name}),t.jsx(xr,{showHealthNumbers:!0,health:I,maxHealth:j,className:"-mt-0.5 h-6",children:v<=0&&m.state.alive&&t.jsx("span",{className:"text-destructive-foreground uppercase",children:"Death's Door"})}),t.jsx("span",{className:"text-xs h-4",children:"resource bars here"})]})})]})]})}function sc({actorID:e,active:n,index:r,targeted:o,...s}){const a=y(v=>v.state),{hoverActorID:i,setActiveRefs:l}=F(v=>({hoverActorID:v.hoverActorID,setActiveRefs:v.setActiveRefs})),c=u.useRef(null);o=o||i===e;const d=Y(a,e),[p,f]=nn(d),x=d.state.alive?p:0,[h,m]=u.useState(0);return u.useLayoutEffect(()=>{c.current!==null&&l(d.playerID,r,c)},[d.playerID,r,c]),t.jsxs(L.div,{ref:c,initial:{y:"-100%",opacity:0},animate:{y:"0%",opacity:1},exit:{y:"-100%",opacity:0},className:"group flex flex-col w-48 h-14 absolute top-0","data-state":h>0?"open":"closed",...s,children:[t.jsx(mr,{variant:o?"targeted":n?"enemy-active":"enemy",className:"h-14 py-1 px-2 pointer-events-none border border-stone-950 rounded-xs",children:t.jsxs(rn,{className:"gap-0",children:[t.jsx(on,{className:"text-base title",style:{textShadow:n?"-1px 1px 1px rgba(255,255,255,0.8)":"1px 1px 1px black"},children:d.name}),t.jsx(xr,{showHealthNumbers:!1,health:x,maxHealth:f})]})}),t.jsx("div",{className:"flex transition-all justify-between h-6 -translate-y-2 group-hover:translate-y-1 group-data-[state=open]:translate-y-1 z-10",children:t.jsx("div",{className:"flex -space-x-3 group-hover:space-x-1 group-data-[state=open]:space-x-1 transition-all flex-wrap",children:t.jsx(te,{children:Object.entries(d.applied).map(([v,j])=>t.jsx(L.div,{layout:!0,initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},children:t.jsx(hr,{effectID:v,count:j,onOpenChange:I=>{m(D=>D+(I?1:-1))}})},v))})})})]})}function ac({encounter:e,current:n}){const r=y(c=>c.state),o=r.actors.filter(c=>c.playerID===e?.ID),s=o.filter(c=>c.state.alive),a=y(c=>c.state.combat?.phase),i=a==="planning",l=!!a&&a!=="pre"&&a!=="post";return t.jsxs("div",{className:"w-full flex flex-row justify-end items-start h-20 max-w-[1440px] px-4 gap-2",children:[!!a&&t.jsxs("div",{className:"flex flex-col gap-0 items-end mt-3",children:[t.jsx("div",{className:"grid grid-cols-3 gap-1 text-stone-300/40",children:o.map(c=>c.state.alive?t.jsx(sn,{},c.ID):t.jsx(an,{},c.ID))}),s.length>0&&t.jsxs("div",{className:"text-lg text-muted-foreground/50 title",children:[s.length," enemies left"]})]}),e?.activeActorIDs.map((c,d)=>t.jsxs("div",{className:"relative h-20 w-48",children:[t.jsx("div",{className:g("rounded bg-background opacity-40 z-0 transition-all","h-14 w-full mb-6 flex items-center justify-center border border-foreground/10 border-dashed text-stone-300/30",{"opacity-0":!!c})}),t.jsx(te,{children:c&&t.jsx(sc,{actorID:c,active:l&&!i&&r.promptQueue.length===0&&n?.context.sourceID===c,index:d,targeted:un(r,n?.context,c,cn(e.ID,d))},c)})]},d))]})}function ic({player:e,current:n}){const r=y(c=>c.state),{activeContext:o,set:s}=F(c=>c),a=r.combat?.phase,i=a==="planning",l=!!a&&a!=="pre"&&a!=="post";return t.jsx("div",{className:"flex items-end justify-end gap-8 overflow-y-clip pb-2",children:e.activeActorIDs.map((c,d)=>t.jsxs("div",{className:"relative w-64 h-32 flex flex-col justify-end",children:[t.jsx("div",{className:g("rounded-xs h-19 mt-8 w-64 transition-all"," bg-background/60 border border-background/80",{"opacity-0":!!c})}),t.jsx(te,{children:c&&t.jsx(oc,{actorID:c,index:d,status:i?"select action":"...",active:l&&(i&&o.sourceID===c||!i&&n?.context.sourceID===c),targeted:un(r,n?.context,c,cn(e.ID,d)),disabled:!i||!!r.actionQueue.find(p=>p.context.sourceID===c),onClick:p=>{s({activeActionID:To(p,r)?.ID,activeContext:ue({playerID:p.playerID,sourceID:p.ID})})}},c)})]},d))})}function cc({className:e,...n}){const r=y(s=>s.state.combatLog),o=u.useRef(null);return u.useEffect(()=>{o.current&&o.current.scrollIntoView({behavior:"smooth"})},[r.length]),t.jsx(pt,{className:g("h-100 text-sm",e),...n,children:t.jsxs("ul",{className:"text-muted-foreground",children:[r.map((s,a)=>t.jsx("li",{style:{opacity:s.depth>0?.7:1,paddingLeft:s.depth*16},children:s.text},a)),t.jsx("div",{ref:o})]})})}var Be="Tabs",[lc]=le(Be,[Fe]),gr=Fe(),[uc,wt]=lc(Be),vr=u.forwardRef((e,n)=>{const{__scopeTabs:r,value:o,onValueChange:s,defaultValue:a,orientation:i="horizontal",dir:l,activationMode:c="automatic",...d}=e,p=Ae(l),[f,x]=Ee({prop:o,onChange:s,defaultProp:a??"",caller:Be});return t.jsx(uc,{scope:r,baseId:J(),value:f,onValueChange:x,orientation:i,dir:p,activationMode:c,children:t.jsx(M.div,{dir:p,"data-orientation":i,...d,ref:n})})});vr.displayName=Be;var br="TabsList",yr=u.forwardRef((e,n)=>{const{__scopeTabs:r,loop:o=!0,...s}=e,a=wt(br,r),i=gr(r);return t.jsx(Pn,{asChild:!0,...i,orientation:a.orientation,dir:a.dir,loop:o,children:t.jsx(M.div,{role:"tablist","aria-orientation":a.orientation,...s,ref:n})})});yr.displayName=br;var jr="TabsTrigger",wr=u.forwardRef((e,n)=>{const{__scopeTabs:r,value:o,disabled:s=!1,...a}=e,i=wt(jr,r),l=gr(r),c=Cr(i.baseId,o),d=Nr(i.baseId,o),p=o===i.value;return t.jsx(Tn,{asChild:!0,...l,focusable:!s,active:p,children:t.jsx(M.button,{type:"button",role:"tab","aria-selected":p,"aria-controls":d,"data-state":p?"active":"inactive","data-disabled":s?"":void 0,disabled:s,id:c,...a,ref:n,onMouseDown:b(e.onMouseDown,f=>{!s&&f.button===0&&f.ctrlKey===!1?i.onValueChange(o):f.preventDefault()}),onKeyDown:b(e.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&i.onValueChange(o)}),onFocus:b(e.onFocus,()=>{const f=i.activationMode!=="manual";!p&&!s&&f&&i.onValueChange(o)})})})});wr.displayName=jr;var Ir="TabsContent",Dr=u.forwardRef((e,n)=>{const{__scopeTabs:r,value:o,forceMount:s,children:a,...i}=e,l=wt(Ir,r),c=Cr(l.baseId,o),d=Nr(l.baseId,o),p=o===l.value,f=u.useRef(p);return u.useEffect(()=>{const x=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(x)},[]),t.jsx(G,{present:s||p,children:({present:x})=>t.jsx(M.div,{"data-state":p?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":c,hidden:!x,id:d,tabIndex:0,...i,ref:n,style:{...e.style,animationDuration:f.current?"0s":void 0},children:x&&a})})});Dr.displayName=Ir;function Cr(e,n){return`${e}-trigger-${n}`}function Nr(e,n){return`${e}-content-${n}`}var dc=vr,fc=yr,pc=wr,xc=Dr;function hc({className:e,...n}){return t.jsx(dc,{"data-slot":"tabs",className:g("flex flex-col gap-2",e),...n})}function mc({className:e,...n}){return t.jsx(fc,{"data-slot":"tabs-list",className:g("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",e),...n})}function kt({className:e,...n}){return t.jsx(pc,{"data-slot":"tabs-trigger",className:g("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-foreground/20 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...n})}function Ot({className:e,...n}){return t.jsx(xc,{"data-slot":"tabs-content",className:g("flex-1 outline-none",e),...n})}function gc(e){return ln({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12 10C14.2091 10 16 8.20914 16 6 16 3.79086 14.2091 2 12 2 9.79086 2 8 3.79086 8 6 8 8.20914 9.79086 10 12 10ZM5.5 13C6.88071 13 8 11.8807 8 10.5 8 9.11929 6.88071 8 5.5 8 4.11929 8 3 9.11929 3 10.5 3 11.8807 4.11929 13 5.5 13ZM21 10.5C21 11.8807 19.8807 13 18.5 13 17.1193 13 16 11.8807 16 10.5 16 9.11929 17.1193 8 18.5 8 19.8807 8 21 9.11929 21 10.5ZM12 11C14.7614 11 17 13.2386 17 16V22H7V16C7 13.2386 9.23858 11 12 11ZM5 15.9999C5 15.307 5.10067 14.6376 5.28818 14.0056L5.11864 14.0204C3.36503 14.2104 2 15.6958 2 17.4999V21.9999H5V15.9999ZM22 21.9999V17.4999C22 15.6378 20.5459 14.1153 18.7118 14.0056 18.8993 14.6376 19 15.307 19 15.9999V21.9999H22Z"},child:[]}]})(e)}function vc(e){return ln({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 0a2 2 0 0 0-2 2H3.5a2 2 0 0 0-2 2v1a2 2 0 0 0 2 2h4v.5a.5.5 0 0 0 1 0V7h4a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H10a2 2 0 0 0-2-2m1 2a1 1 0 0 0-2 0zm-4 9v2h6v-2h-1v.5a.5.5 0 0 1-1 0V11z"},child:[]},{tag:"path",attr:{d:"M14 7.599A3 3 0 0 1 12.5 8H9.415a1.5 1.5 0 0 1-2.83 0H3.5A3 3 0 0 1 2 7.599V14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM4 10.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5z"},child:[]}]})(e)}var He="Dialog",[Sr]=le(He),[bc,U]=Sr(He),ot=e=>{const{__scopeDialog:n,children:r,open:o,defaultOpen:s,onOpenChange:a,modal:i=!0}=e,l=u.useRef(null),c=u.useRef(null),[d,p]=Ee({prop:o,defaultProp:s??!1,onChange:a,caller:He});return t.jsx(bc,{scope:n,triggerRef:l,contentRef:c,contentId:J(),titleId:J(),descriptionId:J(),open:d,onOpenChange:p,onOpenToggle:u.useCallback(()=>p(f=>!f),[p]),modal:i,children:r})};ot.displayName=He;var Rr="DialogTrigger",_r=u.forwardRef((e,n)=>{const{__scopeDialog:r,...o}=e,s=U(Rr,r),a=P(n,s.triggerRef);return t.jsx(M.button,{type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":Ct(s.open),...o,ref:a,onClick:b(e.onClick,s.onOpenToggle)})});_r.displayName=Rr;var It="DialogPortal",[yc,Ar]=Sr(It,{forceMount:void 0}),Mr=e=>{const{__scopeDialog:n,forceMount:r,children:o,container:s}=e,a=U(It,n);return t.jsx(yc,{scope:n,forceMount:r,children:u.Children.map(o,i=>t.jsx(G,{present:r||a.open,children:t.jsx(Yt,{asChild:!0,container:s,children:i})}))})};Mr.displayName=It;var _e="DialogOverlay",Er=u.forwardRef((e,n)=>{const r=Ar(_e,e.__scopeDialog),{forceMount:o=r.forceMount,...s}=e,a=U(_e,e.__scopeDialog);return a.modal?t.jsx(G,{present:o||a.open,children:t.jsx(wc,{...s,ref:n})}):null});Er.displayName=_e;var jc=Zt("DialogOverlay.RemoveScroll"),wc=u.forwardRef((e,n)=>{const{__scopeDialog:r,...o}=e,s=U(_e,r);return t.jsx(Qt,{as:jc,allowPinchZoom:!0,shards:[s.contentRef],children:t.jsx(M.div,{"data-state":Ct(s.open),...o,ref:n,style:{pointerEvents:"auto",...o.style}})})}),ee="DialogContent",Pr=u.forwardRef((e,n)=>{const r=Ar(ee,e.__scopeDialog),{forceMount:o=r.forceMount,...s}=e,a=U(ee,e.__scopeDialog);return t.jsx(G,{present:o||a.open,children:a.modal?t.jsx(Ic,{...s,ref:n}):t.jsx(Dc,{...s,ref:n})})});Pr.displayName=ee;var Ic=u.forwardRef((e,n)=>{const r=U(ee,e.__scopeDialog),o=u.useRef(null),s=P(n,r.contentRef,o);return u.useEffect(()=>{const a=o.current;if(a)return Xt(a)},[]),t.jsx(Tr,{...e,ref:s,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:b(e.onCloseAutoFocus,a=>{a.preventDefault(),r.triggerRef.current?.focus()}),onPointerDownOutside:b(e.onPointerDownOutside,a=>{const i=a.detail.originalEvent,l=i.button===0&&i.ctrlKey===!0;(i.button===2||l)&&a.preventDefault()}),onFocusOutside:b(e.onFocusOutside,a=>a.preventDefault())})}),Dc=u.forwardRef((e,n)=>{const r=U(ee,e.__scopeDialog),o=u.useRef(!1),s=u.useRef(!1);return t.jsx(Tr,{...e,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{e.onCloseAutoFocus?.(a),a.defaultPrevented||(o.current||r.triggerRef.current?.focus(),a.preventDefault()),o.current=!1,s.current=!1},onInteractOutside:a=>{e.onInteractOutside?.(a),a.defaultPrevented||(o.current=!0,a.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const i=a.target;r.triggerRef.current?.contains(i)&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&s.current&&a.preventDefault()}})}),Tr=u.forwardRef((e,n)=>{const{__scopeDialog:r,trapFocus:o,onOpenAutoFocus:s,onCloseAutoFocus:a,...i}=e,l=U(ee,r),c=u.useRef(null),d=P(n,c);return qt(),t.jsxs(t.Fragment,{children:[t.jsx(Jt,{asChild:!0,loop:!0,trapped:o,onMountAutoFocus:s,onUnmountAutoFocus:a,children:t.jsx(en,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":Ct(l.open),...i,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),t.jsxs(t.Fragment,{children:[t.jsx(Nc,{titleId:l.titleId}),t.jsx(Rc,{contentRef:c,descriptionId:l.descriptionId})]})]})}),Dt="DialogTitle",kr=u.forwardRef((e,n)=>{const{__scopeDialog:r,...o}=e,s=U(Dt,r);return t.jsx(M.h2,{id:s.titleId,...o,ref:n})});kr.displayName=Dt;var Or="DialogDescription",Cc=u.forwardRef((e,n)=>{const{__scopeDialog:r,...o}=e,s=U(Or,r);return t.jsx(M.p,{id:s.descriptionId,...o,ref:n})});Cc.displayName=Or;var Lr="DialogClose",Fr=u.forwardRef((e,n)=>{const{__scopeDialog:r,...o}=e,s=U(Lr,r);return t.jsx(M.button,{type:"button",...o,ref:n,onClick:b(e.onClick,()=>s.onOpenChange(!1))})});Fr.displayName=Lr;function Ct(e){return e?"open":"closed"}var $r="DialogTitleWarning",[Xc,zr]=ko($r,{contentName:ee,titleName:Dt,docsSlug:"dialog"}),Nc=({titleId:e})=>{const n=zr($r),r=`\`${n.contentName}\` requires a \`${n.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${n.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${n.docsSlug}`;return u.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},Sc="DialogDescriptionWarning",Rc=({contentRef:e,descriptionId:n})=>{const o=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${zr(Sc).contentName}}.`;return u.useEffect(()=>{const s=e.current?.getAttribute("aria-describedby");n&&s&&(document.getElementById(n)||console.warn(o))},[o,e,n]),null},_c=_r,Ac=Mr,Mc=Er,Ec=Pr,Pc=kr,Tc=Fr;function Lt({...e}){return t.jsx(_c,{"data-slot":"dialog-trigger",...e})}function kc({...e}){return t.jsx(Ac,{"data-slot":"dialog-portal",...e})}function Oc({className:e,...n}){return t.jsx(Mc,{"data-slot":"dialog-overlay",className:g("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...n})}function Gr({className:e,children:n,showCloseButton:r=!0,...o}){return t.jsxs(kc,{"data-slot":"dialog-portal",children:[t.jsx(Oc,{}),t.jsxs(Ec,{"data-slot":"dialog-content",className:g("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-xs border p-6 shadow-lg duration-200 sm:max-w-lg","ring ring-black",e),...o,children:[n,r&&t.jsxs(Tc,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[t.jsx(as,{}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Br({className:e,...n}){return t.jsx("div",{"data-slot":"dialog-header",className:g("flex flex-col gap-2 text-center sm:text-left",e),...n})}function Hr({className:e,...n}){return t.jsx(Pc,{"data-slot":"dialog-title",className:g("text-2xl leading-none font-semibold title",e),...n})}function Lc({actor:e}){return t.jsx(Gr,{children:t.jsx(Br,{children:t.jsx(Hr,{children:e.name})})})}function Fc({onOpenChange:e}){const n=y(i=>i.state),r=y(i=>i.resolveActionItem),o=H(),s=n.players.find(i=>i.ID===o),a=ue({playerID:o});return s?t.jsxs(Gr,{className:"w-180 !max-w-180",children:[t.jsx(Br,{children:t.jsx(Hr,{children:"Items"})}),t.jsx(pr,{items:s.items,actionHeader:t.jsx(t.Fragment,{children:"Equip/Use"}),actions:i=>t.jsxs(t.Fragment,{children:[i.use&&t.jsx(nt,{children:"Use"}),i.consumable&&!n.combat&&t.jsx(rt,{disabled:!1,placeholder:"Use",options:i.consumable.targets.get(n,a).map(l=>l.target),value:void 0,onValueChange:l=>{e?.(!1),r(i.consumable,{...a,sourceID:l??"",targetIDs:[l]})}}),i.actions&&t.jsx(nt,{children:"Equip"})]})})]}):null}const $c=[Fo,$o,zo];function zc({player:e,current:n}){const{state:r}=y(c=>c),{activePlayerTab:o,set:s}=F(c=>c),a=r.actors.filter(c=>c.playerID===e.ID),[i,l]=u.useState(!1);return t.jsxs("div",{className:"flex justify-start gap-6 mb-3 w-full max-w-[1440px]",children:[t.jsxs("div",{children:[t.jsx(ic,{player:e,current:n}),t.jsxs("div",{className:"flex items-center justify-center text-center title text-lg h-5 leading-5 text-muted-foreground gap-6 px-3 mt-1",children:[t.jsx(ie,{className:"flex-1"}),"Active Party",t.jsx(ie,{className:"flex-1"})]})]}),t.jsxs(hc,{orientation:"vertical",className:"flex-row items-center rounded-xs gap-1",value:o,onValueChange:c=>s({activePlayerTab:c}),children:[t.jsxs(mc,{className:"flex flex-col items-center justify-around bg-transparent h-full gap-2 z-10",children:[t.jsx(kt,{value:"combat-log",className:"bg-muted rounded-sm ring border !border-foreground/10 ring-black hover:bg-ring dark:data-[state=active]:bg-ring",children:t.jsx(Oo,{})}),t.jsx(kt,{value:"party",className:"bg-muted rounded-sm ring border !border-foreground/10 ring-black hover:bg-ring dark:data-[state=active]:bg-ring",children:t.jsx(gc,{})}),t.jsx("div",{className:"flex-1"}),t.jsxs(ot,{open:i,onOpenChange:l,children:[t.jsx(Lt,{className:"px-2 py-1.5 bg-muted text-muted-foreground rounded-sm ring border !border-foreground/10 ring-black hover:bg-ring/50",children:t.jsx(vc,{})}),t.jsx(Fc,{open:i,onOpenChange:l})]})]}),t.jsxs("div",{className:"relative h-32 w-62 xl:w-80",children:[t.jsx(Ot,{value:"combat-log",className:"h-full",children:t.jsx(cc,{className:"h-full w-full rounded-xs p-2 bg-black/90 border ring ring-black text-xs"})}),t.jsx(Ot,{value:"party",className:"h-full",children:t.jsxs("div",{className:"grid grid-cols-2 grid-rows-3 h-full gap-1",children:[a.map(c=>{const d=Lo(r,c.ID),p=at(r,c.ID),f=$c[p?.index??-1]??sn;return t.jsxs(ot,{children:[t.jsx(Lt,{asChild:!0,children:t.jsxs(B,{className:g("!rounded-sm justify-baseline","opacity-100 hover:opacity-90 h-full"),variant:c.state.alive?"slate":"destructive",children:[d?t.jsx(f,{}):c.state.alive?t.jsx(Go,{}):t.jsx(an,{}),t.jsxs("div",{className:"text-left",children:[t.jsx("div",{className:"-mb-1 font-semibold",children:c.name}),t.jsx("div",{className:"-mt-1 text-foreground/40 text-xs",children:c.class?.name??"N/A"})]})]})}),t.jsx(Lc,{actor:c})]},c.ID)}),Array.from({length:6-a.length}).map((c,d)=>t.jsx("div",{className:"h-full w-full bg-black/20"},d))]})})]})]})]})}const Gc=["pre","start","planning","main","end","post"];function Bc(){const e=y(o=>o.state),n=y(o=>o.nextPhase),r=Bo();return t.jsxs(t.Fragment,{children:[t.jsxs(W,{variant:"secondary",children:["Turn ",e.combat?.turn]}),t.jsx(ie,{orientation:"vertical"}),Gc.filter(o=>o!=="pre"&&o!=="post").map(o=>t.jsx(W,{variant:o===r?"secondary":"outline",className:g({"text-muted-foreground":o!==r}),children:o},o)),r==="planning"&&t.jsxs(t.Fragment,{children:[t.jsx(ie,{orientation:"vertical"}),t.jsx(W,{children:e.actionQueue.length})]}),t.jsx(ie,{orientation:"vertical"}),t.jsx(W,{onClick:()=>n(),children:t.jsx(Ho,{})})]})}function Hc({className:e,...n}){return t.jsx(ts,{role:"status","aria-label":"Loading",className:g("size-4 animate-spin",e),...n})}function Vc(){const e=y(n=>n.state);return t.jsxs("div",{className:"flex items-center justify-start gap-2 p-1 px-3 w-full",children:[t.jsxs(W,{variant:"outline",children:["Effects: ",e.effects.length]}),t.jsx(W,{variant:e.combat?"outline":"secondary",className:g({"text-muted-foreground":e.combat}),children:"Dialog"}),t.jsx(W,{variant:e.combat?"secondary":"outline",className:g({"text-muted-foreground":!e.combat}),children:"Combat"}),e.combat&&t.jsxs(t.Fragment,{children:[t.jsx(ie,{orientation:"vertical"}),t.jsx(Bc,{})]}),Vo(e)==="running"&&t.jsx(Hc,{}),t.jsx("div",{className:"flex-1"}),t.jsx(W,{variant:"outline",asChild:!0,children:t.jsx(Kr,{to:"/crew",children:"edit party"})})]})}function qc(){const e=y(i=>i.state.players),n=y(i=>i.state.combat),r=Uo(),o=H(),s=e.find(i=>i.ID===o),a=e.find(i=>i.ID!==o);return t.jsxs("div",{className:"h-screen w-screen flex flex-col items-center overflow-hidden relative",style:{background:"radial-gradient(ellipse at center, transparent 75%, rgba(0, 0, 0, 1) 100%)"},children:[t.jsx(Vc,{}),t.jsxs("div",{className:"flex-1 flex flex-col justify-between relative z-10",children:[t.jsx(ac,{encounter:a,current:r}),n&&t.jsx(Js,{current:r}),!n&&t.jsx(Zi,{}),t.jsx(zc,{player:s,current:r})]}),r&&n?.phase==="main"&&t.jsx(Nn,{current:r}),t.jsx(na,{})]})}export{qc as component};
