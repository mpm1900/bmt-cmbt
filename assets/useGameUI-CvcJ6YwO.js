import{R as _}from"./index-01PtJaBK.js";const f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));function de(e,t=0){return(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase()}let T;const ge=new Uint8Array(16);function me(){if(!T){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");T=crypto.getRandomValues.bind(crypto)}return T(ge)}const De=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),L={randomUUID:De};function Ie(e,t,n){e=e||{};const r=e.random??e.rng?.()??me();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,de(r)}function u(e,t,n){return L.randomUUID&&!e?L.randomUUID():Ie(e)}function A(e){const t=Math.random()*100;return[t<=e,t]}function R(e,t){return{...e,state:{...e.state,...t}}}function J(e,t){return{...e,stats:{...e.stats,...t}}}function Q(e){return{type:"power",success:!1,evade:!1,critical:!1,criticalModifier:1,element:"physical",...e}}function X(e){return{success:!1,successRoll:0,successThreshold:0,critical:!1,criticalRoll:0,criticalThreshold:0,...e}}function E(e,t,n){return{...e,success:t.success,evade:n.success,critical:t.success&&t.critical}}function P(e,t,n){const r=e+n.stats.accuracy,o=A(r),i=t+0,c=A(i);return X({success:o[0],successRoll:o[1],successThreshold:r,critical:c[0],criticalRoll:c[1],criticalThreshold:i})}function O(e){const t=A(e.stats.evasion);return X({success:t[0],successRoll:t[1],successThreshold:e.stats.evasion})}function ye(e,t,n){if(n.type==="raw")return n.raw;if(n.type==="power"){const r=e.stats[n.offenseStat],o=t.stats[n.defenseStat],i=r/o,c=n.success?1:0,a=n.critical?n.criticalModifier:1,s=n.evade?0:1;return Math.round(n.power*i*c*a*s)}return 0}function ve(e,t,n){return R(e,{damage:t,alive:n})}function he(e,t){if(e.modified)return console.error("already modified",e,t),[e,[]];const n=new Set;return e=t.flatMap(o=>{const{effect:i,context:c}=o;return i.modifiers(c).map(s=>({ID:u(),effect:i,modifier:s,context:c}))}).sort((o,i)=>o.effect.priority-i.effect.priority).reduce((o,i)=>{const{modifier:c,context:a,effect:s}=i;return c.filter&&!c.filter(o,a)?o:(n.add(s.ID),c.apply(o,a))},{...e}),e.modified=!0,[e,Array.from(n)]}function be(e){const{accuracy:t,body:n,evasion:r,health:o,intelligence:i,reflexes:c,...a}=e.stats,s=c,l=0,p=n;return{...a,accuracy:t+s,body:n,evasion:r+l,health:o+p,intelligence:i,reflexes:c}}const k={ID:u(),delay:0,duration:void 0,priority:0,modifiers:()=>[{ID:u(),filter:(e,t)=>e.ID===t.sourceID,apply:e=>J(e,{body:e.stats.body+10})}],triggers:()=>[]};function Z(e,t){return e.players.find(o=>o.ID===t.playerID)?.activeActorIDs[t.index]??void 0}function _e(e,t){const n=e.actors.find(i=>i.ID===t),r=e.players.find(i=>i.ID===n?.playerID),o=r?.activeActorIDs.indexOf(t);return r?.ID&&o!==void 0&&o!==-1?{ID:u(),playerID:r.ID,index:o}:void 0}function Rt(e,t){return e?.playerID===t?.playerID&&e?.index===t?.index}function Ae(e){return[...e.effects,...e.combat?.effects??[]].flatMap(({effect:n,context:r})=>n.triggers(r))}function x(e,t){return e.actors.find(n=>n.ID===t)}function Se(e,t){const[n,r]=he(e,t);return[{...n,stats:be(n)},r]}function g(e,t){const n=x(e,t);if(!n)return;const r=[...e.effects,...e.combat?.effects??[]];return Se(n,r)[0]}function I(e,t,n){const r=g(e,t);if(r)return n(r)}function Qe(e,t,n){const r=Z(e,t);return r?I(e,r,n):void 0}function h(e,t){return{ID:u(),type:t,target:e}}function D(e,t){return e.players.some(n=>n.activeActorIDs.includes(t))}function xe(e,t,n){return e&&e.validate(t,n)}function we(e,t){return e?.actions.find(n=>xe(n,t,d({sourceID:e.ID})))}function Ce(e,t){const n=t.positions.map(r=>Z(e,r));return{playerID:t.playerID,sourceID:t.sourceID,targetIDs:n.filter(r=>r!==void 0).concat(t.targetIDs)}}function Me(e,t){return[...e,...t]}function b(e,t){return[...t,...e]}function w(e){const[t,...n]=e;return n}function Te(e,t){return e.sort(t)}const q={ID:u(),name:"Activate Actor",validate:()=>!0,targets:{unique:!0,max:()=>1,get:(e,t)=>e.actors.filter(n=>!D(e,n.ID)&&n.playerID===t.playerID&&n.state.alive).map(n=>h(n,"targetID")),validate:(e,t)=>t.targetIDs.length===1},ai:{compute:(e,t)=>I(e,t.targetIDs[0],n=>1e3-n.state.damage)??0,generateContexts:(e,t,n)=>n.targets.get(e,t).map(o=>({...t,targetIDs:[o.target.ID]}))},resolve:(e,t)=>[ce(t.playerID,t.sourceID,t),t.targetIDs.map(n=>Ye(t.playerID,n,t))]};function Re(e){return{...q,targets:{...q.targets,max:()=>e,validate:(t,n)=>n.targetIDs.length===e}}}function Ee(e,t,n){return e.validate(t,n)?e.resolve(t,n).flatMap(r=>r):(console.error("resolver validation failed",e,t,n),[])}function Pe(e){e=Fe(e);const t=e.actionQueue[0];e=y(e,[`${I(e,t.context.sourceID,i=>i.name)} uses ${t.action.name}.`]);const n=j(e,t.context,t.action),r=b(e.mutationQueue,n),o=w(e.actionQueue);return{...e,actionQueue:o,mutationQueue:r}}function Oe(e){if(!e.triggerQueue[0])return e;const t=Ee(e.triggerQueue[0].trigger,e,e.triggerQueue[0].context),n=w(e.triggerQueue),r=b(e.mutationQueue,t);return{...e,mutationQueue:r,triggerQueue:n}}function Ue(e){if(!e.mutationQueue[0])return e;const{delta:t,context:n}=e.mutationQueue[0];if(t.filter&&!t.filter(e,n))return e;e=e.mutationQueue[0].delta.apply(e,e.mutationQueue[0].context);const r=w(e.mutationQueue);return{...e,mutationQueue:r}}function Ne(e){switch(e){case"pre":return"start";case"start":return"planning";case"planning":return"main";case"main":return"end";case"end":return"start";default:return"pre"}}function U(e){if(!e.combat)return e;const t=Ne(e.combat.phase);if(e=ie(e,t),t==="start"&&(e=v(e,d({}),"onTurnStart")),t==="planning"){const n=e.players.find(r=>r.ID==="__ai__");n.activeActorIDs.forEach(r=>{if(!r)return;const o=x(e,r)?.actions.filter(a=>a.ai)??[],i=d({playerID:n.ID,sourceID:r}),c=o.map(a=>{const s=a.ai.generateContexts(e,i,a).map(l=>[l,a.ai.compute(e,l)]).sort((l,p)=>p[1]-l[1]);return[a,s[0][0],s[0][1]]});console.log(c),c[0]&&(e=ne(e,c[0][1],c[0][0]))})}return t==="end"&&(e=v(e,d({}),"onTurnEnd")),e}function je(e){if(!e.promptQueue[0])return e;const{action:t,context:n}=e.promptQueue[0];if(n.playerID!=="__ai__"||!t.ai)return e;const r=t.ai.generateContexts(e,n,t).map(o=>[o,t.ai.compute(e,o)]).sort((o,i)=>i[1]-o[1]);return e=re(e,r[0][0]),e}function ee(e){if(e.triggerQueue.length>0)return Oe(e);if(e.mutationQueue.length>0)return Ue(e);if(e.promptQueue.length>0)return je(e);const t=We(e);return e=t[0],t[1]?e.actionQueue.length>0?Pe(e):e.combat?U(e):e:e}function te(e){return e.mutationQueue.length>0||e.triggerQueue.length>0||e.actionQueue.length>0&&e.promptQueue.length===0}function Et(e){return e.combat?.phase==="planning"?"pending":te(e)?"running":e.promptQueue.length>0?"pending":"idle"}function Le(e){for(;te(e);)e=ee(e);return e}function d(e){return{playerID:"",sourceID:"",targetIDs:[],positions:[],...e}}function ke(e){return{...e,duration:e.duration===void 0?void 0:e.duration-1}}function qe(e){return{...e,effect:ke(e.effect)}}function y(e,t){return{...e,combatLog:[...e.combatLog,...t]}}function ne(e,t,n){const r=b(e.actionQueue,[{ID:u(),action:n,context:t}]);return{...e,actionQueue:r}}function He(e,t,n){if(e.actionQueue.find(i=>i.context.sourceID===t.sourceID))return e;e=ne(e,t,n);const o=e.players.reduce((i,c)=>i+c.activeActorIDs.filter(Boolean).length,0);return e.actionQueue.length===o&&(e=U(e)),e}function $e(e,t,n){const r=b(e.promptQueue,[{ID:u(),action:n,context:t}]);return{...e,promptQueue:r}}function re(e,t){if(!e.promptQueue[0])return e;const n=j(e,t,e.promptQueue[0].action),r=b(e.mutationQueue,n),o=w(e.promptQueue);return{...e,promptQueue:o,mutationQueue:r}}function v(e,t,n){const o=Ae(e).filter(c=>c.type===n&&c.validate(e,t)).map(c=>({ID:u(),trigger:c,context:t})),i=Me(e.triggerQueue,o);return{...e,triggerQueue:i}}function Fe(e){const t=Te(e.actionQueue,(n,r)=>{const o=I(e,n.context.sourceID,c=>c.stats.speed)??0;return(I(e,r.context.sourceID,c=>c.stats.speed)??0)-o});return{...e,actionQueue:t}}function Ve(e,t){const n=e.actionQueue.filter(r=>r.context.sourceID!==t);return console.log("filtering action queue",t),console.log(e.actionQueue),console.log(n),{...e,actionQueue:n}}function N(e,t,n){return{...e,actors:e.actors.map(r=>!r.state.alive||n.filter&&!n.filter(r,t)?r:n.apply(r,t))}}function oe(e,t,n){return{...e,players:e.players.map(r=>n.filter&&!n.filter(r,t)?r:n.apply(r,t))}}function Ge(e,t,n){let r=0;e=N(e,t,{filter:a=>t.targetIDs.includes(a.ID),apply:a=>{const s=g(e,t.sourceID),l=g(e,a.ID);if(!s||!l)return a;const p=ye(s,l,n);r+=p;const m=a.state.damage+p;return ve(a,m,m<s.stats.health?1:0)}});const o=t.targetIDs[0],i=x(e,o),c=D(e,o)&&!i?.state.alive;return r>0&&(e=v(e,t,"onDamage"),e=y(e,[`${i?.name} took ${r} damage.`])),c&&(e=v(e,t,"onDeath")),e}function ie(e,t){return e.combat?{...e,combat:{...e.combat,phase:t}}:e}function We(e){let t=!0;return e.players.forEach(n=>{const r=e.actors.filter(o=>o.playerID===n.ID&&!n.activeActorIDs.includes(o.ID)&&o.state.alive);if(n.activeActorIDs.some(o=>o===null)&&r.length>0){const o=Math.min(r.length,n.activeActorIDs.filter(i=>i===null).length);e=$e(e,d({playerID:n.ID}),Re(o)),t=!1}n.activeActorIDs.every(o=>o===null)&&r.length===0&&(e=ie(e,"post"),t=!1)}),[e,t]}function ze(e,t,n){const r=j(e,t,n.action),o=b(e.mutationQueue,r);return{...e,mutationQueue:o}}function j(e,t,n){if(!n.validate(e,t)){console.error("resolver validation failed",n,e,t);const o=n;return o.name?[C(t,()=>`${o.name} failed.`)]:[]}const r=Ce(e,t);return n.resolve(e,r).flatMap(o=>o)}function Ke(e,t){const n={apply:(r,o)=>N(r,o,{filter:i=>i.ID===o.sourceID,apply:i=>R(i,t(i.state))})};return{ID:u(),delta:n,context:e}}function C(e,t){const n={apply:(r,o)=>y(r,[t(r,o)])};return{ID:u(),delta:n,context:e}}function Be(e,t,n){return{ID:u(),context:t,delta:{apply:r=>N(r,t,{filter:o=>o.ID===e,apply:n})}}}function Ye(e,t,n){return{ID:u(),context:n,delta:{apply:r=>{const o=r.players.find(a=>a.ID===e),i=o.activeActorIDs.indexOf(null),c=o.activeActorIDs.indexOf(t);return i===-1?(console.error("NO SPACE"),r):c!==-1?(console.error("ALREADY ACTIVE"),r):(r=oe(r,n,{filter:a=>a.ID===e,apply:a=>({...a,activeActorIDs:a.activeActorIDs.map((s,l)=>l===i?t:s)})}),r=y(r,[`${x(r,t)?.name} joined the battle.`]),r=v(r,n,"onActorActivate"),r)}}}}function ce(e,t,n){return{ID:u(),context:n,delta:{apply:r=>{const i=r.players.find(c=>c.ID===e).activeActorIDs.indexOf(t);return i===-1?(t&&console.error("ACTOR NOT FOUND",t,e,n),r):(r=oe(r,n,{filter:c=>c.ID===e,apply:c=>({...c,activeActorIDs:c.activeActorIDs.map((a,s)=>s===i?null:a)})}),r=Ve(r,t),r=v(r,n,"onActorDeactivate"),r)}}}}function Je(){return{ID:u(),context:d({}),delta:{apply:(e,t)=>({...e,effects:e.effects.map(n=>qe(n)).filter(n=>n.effect.duration!==0)})}}}function ue(e,t){return{ID:u(),context:t,delta:{apply:(n,r)=>({...n,effects:[...n.effects,{ID:u(),effect:e,context:r}]})}}}function M(e,t,n){return{ID:u(),context:e,delta:{apply:(r,o)=>(r=t.reduce((i,c,a)=>{const s=n[a]??o,l=g(i,s.sourceID);if(c.type==="power"&&l){if(!c.success)i=y(i,[`${l.name}'s attack missed.`]);else if(c.evade){const p=g(i,s.targetIDs[0]);i=y(i,[`${p?.name} evaded the attack.`])}}return i=Ge(i,s,c),i},r),r)}}}function Xe(e){return{ID:u(),context:e,delta:{apply:(t,n)=>t.combat?{...t,combat:{...t.combat,turn:t.combat.turn+1}}:t}}}function Ze(e,t){return{ID:u(),context:d({}),delta:{apply:(n,r)=>(console.log("starting combat",n.actors.concat(t)),{...n,combat:e,actors:n.actors.concat(t)})}}}const et={ID:u(),delay:0,duration:1,priority:0,modifiers:k.modifiers,triggers:e=>[{ID:u(),type:"onDamage",validate:(t,n)=>n.targetIDs.includes(e.sourceID),resolve:(t,n)=>[ue(k,e)]}]},H=e=>{let t;const n=new Set,r=(l,p)=>{const m=typeof l=="function"?l(t):l;if(!Object.is(m,t)){const fe=t;t=p??(typeof m!="object"||m===null)?m:Object.assign({},t,m),n.forEach(pe=>pe(t,fe))}},o=()=>t,a={setState:r,getState:o,getInitialState:()=>s,subscribe:l=>(n.add(l),()=>n.delete(l))},s=t=e(r,o,a);return a},ae=(e=>e?H(e):H),tt=e=>e;function se(e,t=tt){const n=_.useSyncExternalStore(e.subscribe,_.useCallback(()=>t(e.getState()),[e,t]),_.useCallback(()=>t(e.getInitialState()),[e,t]));return _.useDebugValue(n),n}const $=e=>Symbol.iterator in e,F=e=>"entries"in e,V=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),r=t instanceof Map?t:new Map(t.entries());if(n.size!==r.size)return!1;for(const[o,i]of n)if(!r.has(o)||!Object.is(i,r.get(o)))return!1;return!0},nt=(e,t)=>{const n=e[Symbol.iterator](),r=t[Symbol.iterator]();let o=n.next(),i=r.next();for(;!o.done&&!i.done;){if(!Object.is(o.value,i.value))return!1;o=n.next(),i=r.next()}return!!o.done&&!!i.done};function rt(e,t){return Object.is(e,t)?!0:typeof e!="object"||e===null||typeof t!="object"||t===null||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?!1:$(e)&&$(t)?F(e)&&F(t)?V(e,t):nt(e,t):V({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})}function le(e){const t=_.useRef(void 0);return n=>{const r=e(n);return rt(t.current,r)?t.current:t.current=r}}const ot=Q({offenseStat:"intelligence",defenseStat:"intelligence",element:"psy",power:30,criticalModifier:1.5}),it={ID:u(),name:"Brain Blast",validate:()=>!0,targets:{unique:!0,max:()=>2,get:(e,t)=>e.actors.filter(n=>n.ID!==t.sourceID&&D(e,n.ID)).map(n=>h(n,"position")),validate:(e,t)=>0<t.positions.length&&t.positions.length<=2},resolve:(e,t)=>[t.targetIDs.map(n=>{const r=P(100,0,g(e,t.sourceID)),o=O(g(e,n)),i=E(ot,r,o),c={...t,targetIDs:[n]};return M(c,[i],[c])})]},ct={ID:u(),name:"Dragon Dance",validate:()=>!0,targets:{unique:!0,max:()=>0,get:()=>[],validate:()=>!0},resolve:(e,t)=>[ue({ID:u(),delay:0,duration:void 0,priority:0,triggers:()=>[],modifiers:()=>[{ID:u(),filter:(n,r)=>n.ID===r.sourceID,apply:n=>J(n,{body:n.stats.body*1.5})}]},{playerID:t.playerID,sourceID:t.sourceID,targetIDs:[t.sourceID]})]},G=2,W=50,ut=Q({offenseStat:"intelligence",defenseStat:"intelligence",element:"fire",power:50,criticalModifier:1.5}),at={ID:u(),name:"Fireball",validate:(e,t)=>!!I(e,t.sourceID,n=>n.state.mana>=W),targets:{unique:!0,get:(e,t)=>e.actors.filter(n=>n.ID!==t.sourceID&&D(e,n.ID)).map(n=>h(n,"position")),max:()=>G,validate:(e,t)=>0<t.positions.length&&t.positions.length<=G},ai:{generateContexts:(e,t,n)=>n.targets.get(e,t).map(r=>{const o=_e(e,r.target.ID);return{...t,sourceID:t.sourceID,positions:o?[o]:[]}}),compute:(e,t)=>Qe(e,t.positions[0],n=>n.stats.health-n.state.damage)??0},resolve:(e,t)=>{const n=g(e,t.sourceID),r=P(100,0,n);return[Ke(t,o=>({mana:o.mana-W})),M(t,t.targetIDs.map(o=>{const i=g(e,o),c=O(i);return E(ut,r,c)}),t.targetIDs.map(o=>({...t,targetIDs:[o]})))]}},st={ID:u(),name:"Heal",validate:()=>!0,targets:{unique:!0,max:()=>1,get:(e,t)=>e.actors.map(n=>h(n,"position")),validate:(e,t)=>t.positions.length===1},resolve(e,t){return[Be(t.targetIDs[0],t,n=>R(n,{damage:Math.max(n.state.damage-20,0)}))]}},lt={ID:u(),name:"Hot Shots",validate:()=>!0,targets:{unique:!1,max:()=>1,get:(e,t)=>e.actors.filter(n=>n.ID!==t.sourceID&&D(e,n.ID)).map(n=>h(n,"position")),validate:(e,t)=>t.positions.length===1},resolve:(e,t)=>{const n=[];let r=A(80);const o=[r[1]];for(;r[0];)n.push(M(t,[Q({offenseStat:"reflexes",defenseStat:"reflexes",element:"fire",power:20})],[t])),r=A(80),o.push(r[1]);return n}},ft=Q({offenseStat:"reflexes",defenseStat:"reflexes",element:"physical",power:8,criticalModifier:1.5}),pt=50,z=8,dt={ID:u(),name:"Magic Missile",validate:()=>!0,targets:{unique:!1,max:()=>z,get:(e,t)=>e.actors.filter(n=>n.ID!==t.sourceID&&D(e,n.ID)).map(n=>h(n,"position")),validate:(e,t)=>t.positions.filter(n=>!!n).length===z},resolve:(e,t)=>[t.targetIDs.map(n=>{const r=P(pt,0,g(e,t.sourceID)),o=O(g(e,n)),i=E(ft,r,o),c={...t,targetIDs:[n]};return M(c,[i],[c])})]},gt=[at,dt,it,st,ct,lt];function S(e,t,n){return{ID:u(),playerID:t,parentID:void 0,name:e,modified:!1,actions:gt,stats:n,state:{mana:100,damage:0,alive:1}}}const mt={ID:u(),delay:0,duration:void 0,priority:0,modifiers:()=>[],triggers:()=>[{ID:u(),type:"onDeath",validate:()=>!0,resolve:(e,t)=>t.targetIDs.flatMap(n=>{const r=e.actors.find(o=>o.ID===n);return[C(t,()=>`${r.name} died.`),ce(r.playerID,n,t)]})}]},Dt={ID:u(),delay:0,duration:void 0,priority:0,modifiers:()=>[],triggers:()=>[{ID:u(),type:"onTurnStart",validate:()=>!0,resolve:(e,t)=>[Xe(t),C(t,n=>`Turn ${n.combat?.turn} started`)]}]},It={ID:u(),delay:0,duration:void 0,priority:0,modifiers:()=>[],triggers:()=>[{ID:u(),type:"onTurnEnd",validate:()=>!0,resolve:(e,t)=>[Je(),C(t,n=>`Turn ${n.combat?.turn} ended`)]}]},Pt=["pre","start","planning","main","end","post"];function yt(){return{turn:0,phase:"pre",effects:[{ID:u(),effect:mt,context:d({})},{ID:u(),effect:Dt,context:d({})},{ID:u(),effect:It,context:d({})}]}}function vt(e){return{ID:u(),name:"",targets:{get:()=>[],max:()=>0,validate:()=>!0,unique:!1},validate:()=>!0,resolve:e}}const ht=S("Criminal","__ai__",{accuracy:0,body:100,evasion:0,health:0,intelligence:100,reflexes:100,speed:100}),K={ID:u(),status:"pre",pre:()=>[],messages:()=>[{ID:u(),type:"",actorID:"",text:"Welcome to the game! This is a test dialog message. What would you like to do first?"}],options:(e,t)=>[{ID:u(),text:"Start Combat",icons:"",context:t,action:vt(()=>[Ze(yt(),[ht])])}],post:()=>[]},bt={ID:u(),nodes:[K],activeNodeID:K.ID},B=S("Max","__player__",{accuracy:0,body:100,evasion:0,health:0,reflexes:100,intelligence:100,speed:100}),_t=S("Katie","__player__",{accuracy:0,body:100,evasion:0,health:0,reflexes:100,intelligence:180,speed:70}),At=S("Hank","__player__",{accuracy:0,body:180,evasion:100,health:0,intelligence:100,reflexes:150,speed:150}),St=S("Milo","__player__",{accuracy:0,body:100,evasion:0,health:0,intelligence:100,reflexes:100,speed:100}),Y={ID:"__player__",activeActorIDs:[null,null,null]},Qt={ID:"__ai__",activeActorIDs:[null,null,null]},xt={players:[Qt,Y],combat:void 0,dialog:bt,actors:[B,_t,At,St],effects:[{ID:u(),effect:et,context:d({playerID:Y.ID,sourceID:B.ID})}],actionQueue:[],promptQueue:[],triggerQueue:[],mutationQueue:[],combatLog:["Combat started"],messageLog:[]},wt=ae(e=>({state:xt,pushAction:(t,n)=>{e(({state:r})=>({state:He(r,n,t)}))},resolvePrompt:t=>{e(({state:n})=>(n=re(n,t),{state:n}))},next:()=>{e(({state:t})=>({state:ee(t)}))},flush:()=>{e(({state:t})=>({state:Le(t)}))},nextPhase:()=>{e(({state:t})=>({state:{...U(t),promptQueue:[]}}))},resolveDialogOption:t=>{e(({state:n})=>(n=ze(n,t.context,t),{state:n}))},deleteCombat:()=>{e(({state:t})=>({state:{...t,combat:void 0,actors:t.actors.filter(n=>n.playerID!=="__ai__"&&n.state.alive)}}))}}));function Ct(e){return se(wt,le(e))}function Ot(){return Ct(e=>e.state.combat?.phase)}const Mt=ae((e,t)=>({playerID:"__player__",view:"dialog",activeActorID:void 0,activeActionID:void 0,stagingContext:void 0,set:n=>e(n),resetActive:n=>{const o=t().playerID,i=n.actors.find(c=>c&&c.playerID===o&&D(n,c.ID)&&!n.actionQueue.find(a=>a.context.sourceID===c.ID));i&&e({activeActorID:i.ID,activeActionID:we(i,n)?.ID,stagingContext:void 0})}}));function Ut(e){return se(Mt,le(e))}export{Pt as C,at as F,q as S,Ut as a,g as b,ut as c,G as d,dt as e,z as f,_e as g,pt as h,ft as i,d as j,Ot as k,Se as l,Et as m,we as n,Rt as p,Ct as u,he as w};
