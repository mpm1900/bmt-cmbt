import{R as A}from"./index-BPX-Jba8.js";const f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));function De(e,t=0){return(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase()}let R;const me=new Uint8Array(16);function Ie(){if(!R){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");R=crypto.getRandomValues.bind(crypto)}return R(me)}const ye=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),q={randomUUID:ye};function ve(e,t,n){e=e||{};const r=e.random??e.rng?.()??Ie();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,De(r)}function u(e,t,n){return q.randomUUID&&!e?q.randomUUID():ve(e)}function _(e){const t=Math.random()*100;return[t<=e,t]}function P(e,t){return{...e,state:{...e.state,...t}}}function Z(e,t){return{...e,stats:{...e.stats,...t}}}function x(e){return{type:"power",success:!1,evade:!1,critical:!1,criticalModifier:1,element:"physical",...e}}function ee(e){return{success:!1,successRoll:0,successThreshold:0,critical:!1,criticalRoll:0,criticalThreshold:0,...e}}function O(e,t,n){return{...e,success:t.success,evade:n.success,critical:t.success&&t.critical}}function U(e,t,n){const r=e+n.stats.accuracy,o=_(r),i=t+0,c=_(i);return ee({success:o[0],successRoll:o[1],successThreshold:r,critical:c[0],criticalRoll:c[1],criticalThreshold:i})}function N(e){const t=_(e.stats.evasion);return ee({success:t[0],successRoll:t[1],successThreshold:e.stats.evasion})}function he(e,t,n){if(n.type==="raw")return n.raw;if(n.type==="power"){const r=e.stats[n.offenseStat],o=t.stats[n.defenseStat],i=r/o,c=n.success?1:0,a=n.critical?n.criticalModifier:1,s=n.evade?0:1;return Math.round(n.power*i*c*a*s)}return 0}function be(e,t,n){return P(e,{damage:t,alive:n})}function Ae(e,t){if(e.modified)return console.error("already modified",e,t),[e,[]];const n=new Set;return e=t.flatMap(o=>{const{effect:i,context:c}=o;return i.modifiers(c).map(s=>({ID:u(),effect:i,modifier:s,context:c}))}).sort((o,i)=>o.effect.priority-i.effect.priority).reduce((o,i)=>{const{modifier:c,context:a,effect:s}=i;return c.filter&&!c.filter(o,a)?o:(n.add(s.ID),c.apply(o,a))},{...e}),e.modified=!0,[e,Array.from(n)]}function _e(e){const{accuracy:t,body:n,evasion:r,health:o,intelligence:i,reflexes:c,...a}=e.stats,s=c,l=0,d=n;return{...a,accuracy:t+s,body:n,evasion:r+l,health:o+d,intelligence:i,reflexes:c}}const H={ID:u(),delay:0,duration:void 0,priority:0,modifiers:()=>[{ID:u(),filter:(e,t)=>e.ID===t.sourceID,apply:e=>Z(e,{body:e.stats.body+10})}],triggers:()=>[]};function te(e,t){return e.players.find(o=>o.ID===t.playerID)?.activeActorIDs[t.index]??void 0}function Se(e,t){const n=e.actors.find(i=>i.ID===t),r=e.players.find(i=>i.ID===n?.playerID),o=r?.activeActorIDs.indexOf(t);return r?.ID&&o!==void 0&&o!==-1?{ID:u(),playerID:r.ID,index:o}:void 0}function Ut(e,t){return e?.playerID===t?.playerID&&e?.index===t?.index}function Qe(e){return[...e.effects,...e.combat?.effects??[]].flatMap(({effect:n,context:r})=>n.triggers(r))}function w(e,t){return e.actors.find(n=>n.ID===t)}function xe(e,t){const[n,r]=Ae(e,t);return[{...n,stats:_e(n)},r]}function g(e,t){const n=w(e,t);if(!n)return;const r=[...e.effects,...e.combat?.effects??[]];return xe(n,r)[0]}function I(e,t,n){const r=g(e,t);if(r)return n(r)}function we(e,t,n){const r=te(e,t);return r?I(e,r,n):void 0}function h(e,t){return{ID:u(),type:t,target:e}}function m(e,t){return e.players.some(n=>n.activeActorIDs.includes(t))}function Q(e,t,n){return e.actors.filter(r=>t.playerID===r.playerID&&!m(e,r.ID)&&r.state.alive&&!0)}function Ce(e,t,n){return e.actors.filter(r=>t.playerID===r.playerID&&m(e,r.ID)&&r.state.alive&&(n?n(r):!0))}function Me(e,t,n){return e&&e.validate(t,n)}function Te(e,t){return e?.actions.find(n=>Me(n,t,p({sourceID:e.ID})))}function Re(e,t){return e.players.find(n=>n.ID===t)?.activeActorIDs||[]}function Ee(e,t){return Re(e,t).some(r=>r===null)}function Pe(e,t){const n=t.positions.map(r=>te(e,r));return{playerID:t.playerID,sourceID:t.sourceID,targetIDs:n.filter(r=>r!==void 0).concat(t.targetIDs)}}function Oe(e,t){return[...e,...t]}function b(e,t){return[...t,...e]}function C(e){const[t,...n]=e;return n}function Ue(e,t){return e.sort(t)}const E={ID:u(),name:"Activate Actor",validate:(e,t)=>{const n=Q(e,t);return Ee(e,t.playerID)&&n.length>0},targets:{unique:!0,max:()=>1,get:(e,t)=>Q(e,t).map(n=>h(n,"targetID")),validate:(e,t)=>t.targetIDs.length===1},ai:{compute:(e,t)=>I(e,t.targetIDs[0],n=>1e3-n.state.damage)??0,generateContexts:(e,t,n)=>n.targets.get(e,t).map(o=>({...t,targetIDs:[o.target.ID]}))},resolve:(e,t)=>[ae(t.playerID,t.sourceID,t),t.targetIDs.map(n=>tt(t.playerID,n,t))]};function Ne(e){return{...E,targets:{...E.targets,max:()=>e,validate:(t,n)=>n.targetIDs.length===e}}}function je(e,t,n){return e.validate(t,n)?e.resolve(t,n).flatMap(r=>r):(console.error("resolver validation failed",e,t,n),[])}function Le(e){e=Ke(e);const t=e.actionQueue[0];e=y(e,[`${I(e,t.context.sourceID,i=>i.name)} uses ${t.action.name}.`]);const n=k(e,t.context,t.action),r=b(e.mutationQueue,n),o=C(e.actionQueue);return{...e,actionQueue:o,mutationQueue:r}}function ke(e){if(!e.triggerQueue[0])return e;const t=je(e.triggerQueue[0].trigger,e,e.triggerQueue[0].context),n=C(e.triggerQueue),r=b(e.mutationQueue,t);return{...e,mutationQueue:r,triggerQueue:n}}function qe(e){if(!e.mutationQueue[0])return e;const{delta:t,context:n}=e.mutationQueue[0];if(t.filter&&!t.filter(e,n))return e;e=e.mutationQueue[0].delta.apply(e,e.mutationQueue[0].context);const r=C(e.mutationQueue);return{...e,mutationQueue:r}}function He(e){switch(e){case"pre":return"start";case"start":return"planning";case"planning":return"main";case"main":return"end";case"end":return"start";default:return"pre"}}function j(e){if(!e.combat)return e;const t=He(e.combat.phase);if(e=ue(e,t),t==="start"&&(e=v(e,p({}),"onTurnStart")),t==="planning"){const n=e.players.find(r=>r.ID==="__ai__");n.activeActorIDs.forEach(r=>{if(!r)return;const o=w(e,r)?.actions.filter(a=>a.ai)??[],i=p({playerID:n.ID,sourceID:r}),c=o.map(a=>{const s=a.ai.generateContexts(e,i,a).map(l=>[l,a.ai.compute(e,l)]).sort((l,d)=>d[1]-l[1]);return[a,s[0][0],s[0][1]]});console.log(c),c[0]&&(e=oe(e,c[0][1],c[0][0]))})}return t==="end"&&(e=v(e,p({}),"onTurnEnd")),e}function $e(e){if(!e.promptQueue[0])return e;const{action:t,context:n}=e.promptQueue[0];if(n.playerID!=="__ai__"||!t.ai)return e;const r=t.ai.generateContexts(e,n,t).map(o=>[o,t.ai.compute(e,o)]).sort((o,i)=>i[1]-o[1]);return e=ie(e,r[0][0]),e}function ne(e){if(e.triggerQueue.length>0)return ke(e);if(e.mutationQueue.length>0)return qe(e);if(e.promptQueue.length>0)return $e(e);const t=Je(e);return e=t[0],t[1]?e.actionQueue.length>0?Le(e):e.combat?j(e):e:e}function re(e){return e.mutationQueue.length>0||e.triggerQueue.length>0||e.actionQueue.length>0&&e.promptQueue.length===0}function Nt(e){return e.combat?.phase==="planning"?"pending":re(e)?"running":e.promptQueue.length>0?"pending":"idle"}function Fe(e){for(;re(e);)e=ne(e);return e}function p(e){return{playerID:"",sourceID:"",targetIDs:[],positions:[],...e}}function Ve(e){return{...e,duration:e.duration===void 0?void 0:e.duration-1}}function Ge(e){return{...e,effect:Ve(e.effect)}}function y(e,t){return{...e,combatLog:[...e.combatLog,...t]}}function oe(e,t,n){const r=b(e.actionQueue,[{ID:u(),action:n,context:t}]);return{...e,actionQueue:r}}function We(e,t,n){if(e.actionQueue.find(i=>i.context.sourceID===t.sourceID))return e;e=oe(e,t,n);const o=e.players.reduce((i,c)=>i+c.activeActorIDs.filter(Boolean).length,0);return e.actionQueue.length===o&&(e=j(e)),e}function ze(e,t,n){const r=b(e.promptQueue,[{ID:u(),action:n,context:t}]);return{...e,promptQueue:r}}function ie(e,t){if(!e.promptQueue[0])return e;const n=k(e,t,e.promptQueue[0].action),r=b(e.mutationQueue,n),o=C(e.promptQueue);return{...e,promptQueue:o,mutationQueue:r}}function v(e,t,n){const o=Qe(e).filter(c=>c.type===n&&c.validate(e,t)).map(c=>({ID:u(),trigger:c,context:t})),i=Oe(e.triggerQueue,o);return{...e,triggerQueue:i}}function Ke(e){const t=Ue(e.actionQueue,(n,r)=>{const o=I(e,n.context.sourceID,c=>c.stats.speed)??0;return(I(e,r.context.sourceID,c=>c.stats.speed)??0)-o});return{...e,actionQueue:t}}function Be(e,t){const n=e.actionQueue.filter(r=>r.context.sourceID!==t);return console.log("filtering action queue",t),console.log(e.actionQueue),console.log(n),{...e,actionQueue:n}}function L(e,t,n){return{...e,actors:e.actors.map(r=>!r.state.alive||n.filter&&!n.filter(r,t)?r:n.apply(r,t))}}function ce(e,t,n){return{...e,players:e.players.map(r=>n.filter&&!n.filter(r,t)?r:n.apply(r,t))}}function Ye(e,t,n){let r=0;e=L(e,t,{filter:a=>t.targetIDs.includes(a.ID),apply:a=>{const s=g(e,t.sourceID),l=g(e,a.ID);if(!s||!l)return a;const d=he(s,l,n);r+=d;const D=a.state.damage+d;return be(a,D,D<l.stats.health?1:0)}});const o=t.targetIDs[0],i=w(e,o),c=m(e,o)&&!i?.state.alive;return r>0&&(e=v(e,t,"onDamage"),e=y(e,[`${i?.name} took ${r} damage.`])),c&&(e=v(e,t,"onDeath")),e}function ue(e,t){return e.combat?{...e,combat:{...e.combat,phase:t}}:e}function Je(e){let t=!0;return e.players.forEach(n=>{const r=Q(e,p({playerID:n.ID}));if(n.activeActorIDs.some(o=>o===null)&&r.length>0){const o=Math.min(r.length,n.activeActorIDs.filter(i=>i===null).length);e=ze(e,p({playerID:n.ID}),Ne(o)),t=!1}n.activeActorIDs.every(o=>o===null)&&r.length===0&&(e=ue(e,"post"),t=!1)}),[e,t]}function Xe(e,t,n){const r=k(e,t,n.action),o=b(e.mutationQueue,r);return{...e,mutationQueue:o}}function k(e,t,n){if(!n.validate(e,t)){console.error("resolver validation failed",n,e,t);const o=n;return o.name?[M(t,()=>`${o.name} failed.`)]:[]}const r=Pe(e,t);return n.resolve(e,r).flatMap(o=>o)}function Ze(e,t){const n={apply:(r,o)=>L(r,o,{filter:i=>i.ID===o.sourceID,apply:i=>P(i,t(i.state))})};return{ID:u(),delta:n,context:e}}function M(e,t){const n={apply:(r,o)=>y(r,[t(r,o)])};return{ID:u(),delta:n,context:e}}function et(e,t,n){return{ID:u(),context:t,delta:{apply:r=>L(r,t,{filter:o=>o.ID===e,apply:n})}}}function tt(e,t,n){return{ID:u(),context:n,delta:{apply:r=>{const o=r.players.find(a=>a.ID===e),i=o.activeActorIDs.indexOf(null),c=o.activeActorIDs.indexOf(t);return i===-1?(console.error("NO SPACE"),r):c!==-1?(console.error("ALREADY ACTIVE"),r):(r=ce(r,n,{filter:a=>a.ID===e,apply:a=>({...a,activeActorIDs:a.activeActorIDs.map((s,l)=>l===i?t:s)})}),r=y(r,[`${w(r,t)?.name} joined the battle.`]),r=v(r,n,"onActorActivate"),r)}}}}function ae(e,t,n){return{ID:u(),context:n,delta:{apply:r=>{const i=r.players.find(c=>c.ID===e).activeActorIDs.indexOf(t);return i===-1?(t&&console.error("ACTOR NOT FOUND",t,e,n),r):(r=ce(r,n,{filter:c=>c.ID===e,apply:c=>({...c,activeActorIDs:c.activeActorIDs.map((a,s)=>s===i?null:a)})}),r=Be(r,t),r=v(r,n,"onActorDeactivate"),r)}}}}function nt(){return{ID:u(),context:p({}),delta:{apply:(e,t)=>({...e,effects:e.effects.map(n=>Ge(n)).filter(n=>n.effect.duration!==0)})}}}function se(e,t){return{ID:u(),context:t,delta:{apply:(n,r)=>({...n,effects:[...n.effects,{ID:u(),effect:e,context:r}]})}}}function T(e,t,n){return{ID:u(),context:e,delta:{apply:(r,o)=>(r=t.reduce((i,c,a)=>{const s=n[a]??o,l=g(i,s.sourceID);if(c.type==="power"&&l){if(!c.success)i=y(i,[`${l.name}'s attack missed.`]);else if(c.evade){const d=g(i,s.targetIDs[0]);i=y(i,[`${d?.name} evaded the attack.`])}}return i=Ye(i,s,c),i},r),r)}}}function rt(e){return{ID:u(),context:e,delta:{apply:(t,n)=>t.combat?{...t,combat:{...t.combat,turn:t.combat.turn+1}}:t}}}function ot(e,t){return{ID:u(),context:p({}),delta:{apply:(n,r)=>({...n,actors:n.actors.concat(t),combat:e,combatLog:["Combat started."]})}}}const it={ID:u(),delay:0,duration:1,priority:0,modifiers:H.modifiers,triggers:e=>[{ID:u(),type:"onDamage",validate:(t,n)=>n.targetIDs.includes(e.sourceID),resolve:(t,n)=>[se(H,e)]}]},$=e=>{let t;const n=new Set,r=(l,d)=>{const D=typeof l=="function"?l(t):l;if(!Object.is(D,t)){const de=t;t=d??(typeof D!="object"||D===null)?D:Object.assign({},t,D),n.forEach(ge=>ge(t,de))}},o=()=>t,a={setState:r,getState:o,getInitialState:()=>s,subscribe:l=>(n.add(l),()=>n.delete(l))},s=t=e(r,o,a);return a},le=(e=>e?$(e):$),ct=e=>e;function fe(e,t=ct){const n=A.useSyncExternalStore(e.subscribe,A.useCallback(()=>t(e.getState()),[e,t]),A.useCallback(()=>t(e.getInitialState()),[e,t]));return A.useDebugValue(n),n}const F=e=>Symbol.iterator in e,V=e=>"entries"in e,G=(e,t)=>{const n=e instanceof Map?e:new Map(e.entries()),r=t instanceof Map?t:new Map(t.entries());if(n.size!==r.size)return!1;for(const[o,i]of n)if(!r.has(o)||!Object.is(i,r.get(o)))return!1;return!0},ut=(e,t)=>{const n=e[Symbol.iterator](),r=t[Symbol.iterator]();let o=n.next(),i=r.next();for(;!o.done&&!i.done;){if(!Object.is(o.value,i.value))return!1;o=n.next(),i=r.next()}return!!o.done&&!!i.done};function at(e,t){return Object.is(e,t)?!0:typeof e!="object"||e===null||typeof t!="object"||t===null||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?!1:F(e)&&F(t)?V(e)&&V(t)?G(e,t):ut(e,t):G({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})}function pe(e){const t=A.useRef(void 0);return n=>{const r=e(n);return at(t.current,r)?t.current:t.current=r}}const st=x({offenseStat:"intelligence",defenseStat:"intelligence",element:"psy",power:30,criticalModifier:1.5}),lt={ID:u(),name:"Brain Blast",validate:()=>!0,targets:{unique:!0,max:()=>2,get:(e,t)=>e.actors.filter(n=>n.ID!==t.sourceID&&m(e,n.ID)).map(n=>h(n,"position")),validate:(e,t)=>0<t.positions.length&&t.positions.length<=2},resolve:(e,t)=>[t.targetIDs.map(n=>{const r=U(100,0,g(e,t.sourceID)),o=N(g(e,n)),i=O(st,r,o),c={...t,targetIDs:[n]};return T(c,[i],[c])})]},ft={ID:u(),name:"Dragon Dance",validate:()=>!0,targets:{unique:!0,max:()=>0,get:()=>[],validate:()=>!0},resolve:(e,t)=>[se({ID:u(),delay:0,duration:void 0,priority:0,triggers:()=>[],modifiers:()=>[{ID:u(),filter:(n,r)=>n.ID===r.sourceID,apply:n=>Z(n,{body:n.stats.body*1.5})}]},{playerID:t.playerID,sourceID:t.sourceID,targetIDs:[t.sourceID]})]},W=2,z=50,pt=x({offenseStat:"intelligence",defenseStat:"intelligence",element:"fire",power:50,criticalModifier:1.5}),dt={ID:u(),name:"Fireball",validate:(e,t)=>!!I(e,t.sourceID,n=>n.state.mana>=z),targets:{unique:!0,get:(e,t)=>e.actors.filter(n=>n.ID!==t.sourceID&&m(e,n.ID)).map(n=>h(n,"position")),max:()=>W,validate:(e,t)=>0<t.positions.length&&t.positions.length<=W},ai:{generateContexts:(e,t,n)=>n.targets.get(e,t).map(r=>{const o=Se(e,r.target.ID);return{...t,sourceID:t.sourceID,positions:o?[o]:[]}}),compute:(e,t)=>we(e,t.positions[0],n=>n.stats.health-n.state.damage)??0},resolve:(e,t)=>{const n=g(e,t.sourceID),r=U(100,0,n);return[Ze(t,o=>({mana:o.mana-z})),T(t,t.targetIDs.map(o=>{const i=g(e,o),c=N(i);return O(pt,r,c)}),t.targetIDs.map(o=>({...t,targetIDs:[o]})))]}},gt={ID:u(),name:"Heal",validate:()=>!0,targets:{unique:!0,max:()=>1,get:(e,t)=>e.actors.map(n=>h(n,"position")),validate:(e,t)=>t.positions.length===1},resolve(e,t){return[et(t.targetIDs[0],t,n=>P(n,{damage:Math.max(n.state.damage-20,0)}))]}},Dt={ID:u(),name:"Hot Shots",validate:()=>!0,targets:{unique:!1,max:()=>1,get:(e,t)=>e.actors.filter(n=>n.ID!==t.sourceID&&m(e,n.ID)).map(n=>h(n,"position")),validate:(e,t)=>t.positions.length===1},resolve:(e,t)=>{const n=[];let r=_(80);const o=[r[1]];for(;r[0];)n.push(T(t,[x({offenseStat:"reflexes",defenseStat:"reflexes",element:"fire",power:20})],[t])),r=_(80),o.push(r[1]);return n}},mt=x({offenseStat:"reflexes",defenseStat:"reflexes",element:"physical",power:8,criticalModifier:1.5}),It=50,K=8,yt={ID:u(),name:"Magic Missile",validate:()=>!0,targets:{unique:!1,max:()=>K,get:(e,t)=>e.actors.filter(n=>n.ID!==t.sourceID&&m(e,n.ID)).map(n=>h(n,"position")),validate:(e,t)=>t.positions.filter(n=>!!n).length===K},resolve:(e,t)=>[t.targetIDs.map(n=>{const r=U(It,0,g(e,t.sourceID)),o=N(g(e,n)),i=O(mt,r,o),c={...t,targetIDs:[n]};return T(c,[i],[c])})]},vt=[dt,yt,lt,gt,ft,Dt];function S(e,t,n){return{ID:u(),playerID:t,parentID:void 0,name:e,modified:!1,actions:vt,stats:n,state:{mana:100,damage:0,alive:1}}}const ht={ID:u(),delay:0,duration:void 0,priority:0,modifiers:()=>[],triggers:()=>[{ID:u(),type:"onDeath",validate:()=>!0,resolve:(e,t)=>t.targetIDs.flatMap(n=>{const r=e.actors.find(o=>o.ID===n);return[M(t,()=>`${r.name} died.`),ae(r.playerID,n,t)]})}]},bt={ID:u(),delay:0,duration:void 0,priority:0,modifiers:()=>[],triggers:()=>[{ID:u(),type:"onTurnStart",validate:()=>!0,resolve:(e,t)=>[rt(t),M(t,n=>`Turn ${n.combat?.turn} started`)]}]},At={ID:u(),delay:0,duration:void 0,priority:0,modifiers:()=>[],triggers:()=>[{ID:u(),type:"onTurnEnd",validate:()=>!0,resolve:(e,t)=>[nt(),M(t,n=>`Turn ${n.combat?.turn} ended`)]}]},jt=["pre","start","planning","main","end","post"];function _t(){return{turn:0,phase:"pre",effects:[{ID:u(),effect:ht,context:p({})},{ID:u(),effect:bt,context:p({})},{ID:u(),effect:At,context:p({})}]}}function St(e,t=()=>!0){return{ID:u(),name:"",targets:{get:()=>[],max:()=>0,validate:()=>!0,unique:!1},validate:t,resolve:e}}const B=()=>S("Criminal","__ai__",{accuracy:0,body:100,evasion:0,health:0,intelligence:100,reflexes:100,speed:100}),Y={ID:u(),status:"pre",pre:()=>[],messages:()=>[{ID:u(),type:"",actorID:"",text:"Welcome to the game! This is a test dialog message. What would you like to do first?"}],options:(e,t)=>[{ID:u(),type:"static",text:"Start Combat",icons:"",context:t,action:St(()=>[ot(_t(),[B(),B()])])},{ID:u(),type:"dynamic",text:"Activate Actor",icons:"",context:t,action:E,options:Q(e,t).map(n=>({ID:n.ID,text:n.name,playerID:n.playerID,sourceID:"",targetIDs:[n.ID],positions:[]}))}],post:()=>[]},Qt={ID:u(),nodes:[Y],activeNodeID:Y.ID},J=S("Max","__player__",{accuracy:0,body:100,evasion:0,health:0,reflexes:100,intelligence:100,speed:100}),xt=S("Katie","__player__",{accuracy:0,body:100,evasion:0,health:0,reflexes:100,intelligence:180,speed:70}),wt=S("Hank","__player__",{accuracy:0,body:180,evasion:100,health:0,intelligence:100,reflexes:150,speed:150}),Ct=S("Milo","__player__",{accuracy:0,body:100,evasion:0,health:0,intelligence:100,reflexes:100,speed:100}),X={ID:"__player__",activeActorIDs:[null,null,null]},Mt={ID:"__ai__",activeActorIDs:[null,null,null]},Tt={players:[Mt,X],combat:void 0,dialog:Qt,actors:[J,xt,wt,Ct],effects:[{ID:u(),effect:it,context:p({playerID:X.ID,sourceID:J.ID})}],actionQueue:[],promptQueue:[],triggerQueue:[],mutationQueue:[],combatLog:["Combat started"],messageLog:[]},Rt=le(e=>({state:Tt,pushAction:(t,n)=>{e(({state:r})=>({state:We(r,n,t)}))},resolvePrompt:t=>{e(({state:n})=>(n=ie(n,t),{state:n}))},next:()=>{e(({state:t})=>({state:ne(t)}))},flush:()=>{e(({state:t})=>({state:Fe(t)}))},nextPhase:()=>{e(({state:t})=>({state:{...j(t),promptQueue:[]}}))},resolveDialogOption:t=>{e(({state:n})=>(n=Xe(n,t.context,t),{state:n}))},deleteCombat:()=>{e(({state:t})=>({state:{...t,combat:void 0,actors:t.actors.filter(n=>n.playerID!=="__ai__"&&n.state.alive)}}))}}));function Et(e){return fe(Rt,pe(e))}function Lt(){return Et(e=>e.state.combat?.phase)}const Pt=le((e,t)=>({playerID:"__player__",view:"dialog",activeActorID:void 0,activeActionID:void 0,stagingContext:void 0,set:n=>e(n),resetActive:n=>{const o=t().playerID,i=Ce(n,p({playerID:o}),c=>!n.actionQueue.find(a=>a.context.sourceID===c.ID))[0];i&&e({activeActorID:i.ID,activeActionID:Te(i,n)?.ID,stagingContext:void 0})}}));function kt(e){return fe(Pt,pe(e))}export{jt as C,dt as F,E as S,kt as a,g as b,pt as c,W as d,yt as e,K as f,Se as g,It as h,mt as i,p as j,Lt as k,xe as l,Nt as m,Te as n,Ut as p,Et as u,Ae as w};
